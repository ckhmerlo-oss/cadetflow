{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/constants.ts"],"sourcesContent":["export const CADET_RANKS = [\r\n  'c/PVT', 'c/PV2', 'c/PFC', 'c/CPL', 'c/SGT', 'c/SSG', 'c/SFC', 'c/MSG', 'c/1SG', 'c/SGM', 'c/CSM', \r\n  'c/2LT', 'c/1LT', 'c/CPT', 'c/MAJ', 'c/LTC', 'c/COL'\r\n];\r\n\r\nexport const FALL_SPORTS = [\r\n  'None', 'JV Football','Varsity Football', 'JV Soccer', 'Varsity Soccer', 'Cross Country', 'Swimming (Off Season)', 'PG Lacross', 'PG Basketball', 'PG Football', 'PT'\r\n];\r\n\r\nexport const WINTER_SPORTS = [\r\n  'None', 'JV Basketball', 'Varsity Basketball', 'Wrestling', 'Swimming', 'Indoor Track', 'PG Lacrosse', 'PG Basketball', 'PT' \r\n];\r\n\r\nexport const SPRING_SPORTS = [\r\n  'None', 'Baseball', 'Varsity Lacrosse', 'Track & Field', 'Tennis', 'Golf', 'PG Basketball', 'PG Lacrosse', \r\n];\r\n\r\nexport const CONDUCT_STATUSES = [\r\n  'Exemplary',\r\n  'Commendable',\r\n  'Satisfactory',\r\n  'Deficient',\r\n  'Unsatisfactory'\r\n];\r\n\r\nexport const PROBATION_STATUSES = [\r\n  'None',\r\n  'Academic',\r\n  'Disciplinary',\r\n  'Honor',\r\n  'Physical'\r\n];\r\n\r\nexport const GRADE_LEVELS = [\r\n  '7th', '8th', '9th', '10th', '11th', '12th', 'PG'\r\n];\r\n\r\n// Roles authorized to EDIT profiles\r\nexport const EDIT_AUTHORIZED_ROLES = [\r\n  'S1', \r\n  'Command Sergeant Major', \r\n  'TAC Officer', \r\n  'Deputy Commandant', \r\n  'Commandant', \r\n  'Admin'\r\n];\r\n\r\n// Roles authorized to manage Star Tours\r\nexport const STAR_TOUR_AUTHORIZED_ROLES = [\r\n  'Commandant', \r\n  'Deputy Commandant', \r\n  'Admin'\r\n];"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAO,MAAM,cAAc;IACzB;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAC1F;IAAS;IAAS;IAAS;IAAS;IAAS;CAC9C;AAEM,MAAM,cAAc;IACzB;IAAQ;IAAc;IAAoB;IAAa;IAAkB;IAAiB;IAAyB;IAAc;IAAiB;IAAe;CAClK;AAEM,MAAM,gBAAgB;IAC3B;IAAQ;IAAiB;IAAsB;IAAa;IAAY;IAAgB;IAAe;IAAiB;CACzH;AAEM,MAAM,gBAAgB;IAC3B;IAAQ;IAAY;IAAoB;IAAiB;IAAU;IAAQ;IAAiB;CAC7F;AAEM,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,qBAAqB;IAChC;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,eAAe;IAC1B;IAAO;IAAO;IAAO;IAAQ;IAAQ;IAAQ;CAC9C;AAGM,MAAM,wBAAwB;IACnC;IACA;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,6BAA6B;IACxC;IACA;IACA;CACD","debugId":null}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/%5Bid%5D/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\nimport { STAR_TOUR_AUTHORIZED_ROLES } from '../constants'\r\n\r\nexport async function updateCadetProfile(cadetId: string, formData: FormData) {\r\n  const supabase = createClient()\r\n  \r\n  // 1. Auth Check\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return { error: 'Unauthorized' }\r\n\r\n  // 2. Fetch Editor Permissions\r\n  const { data: editor } = await supabase\r\n    .from('profiles')\r\n    .select(`\r\n      id, \r\n      company_id, \r\n      role:role_id (\r\n        role_name, \r\n        default_role_level, \r\n        can_manage_all_rosters, \r\n        can_manage_own_company_roster\r\n      )\r\n    `)\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (!editor || !editor.role) return { error: 'Unauthorized' }\r\n\r\n  const editorRole = editor.role as any\r\n  const editorLevel = editorRole.default_role_level || 0\r\n  const canManageAll = editorRole.can_manage_all_rosters\r\n  const canManageOwn = editorRole.can_manage_own_company_roster\r\n  \r\n  // 3. Fetch Target Details\r\n  const { data: target } = await supabase\r\n    .from('profiles')\r\n    .select('company_id, role:role_id(default_role_level)')\r\n    .eq('id', cadetId)\r\n    .single()\r\n\r\n  if (!target) return { error: 'Target profile not found.' }\r\n  \r\n  const targetLevel = (target.role as any)?.default_role_level || 0\r\n\r\n  // 4. HIERARCHY RULE: Cannot edit someone of equal or higher rank\r\n  if (targetLevel >= editorLevel) {\r\n    return { error: `Permission Denied: You cannot edit a user of rank level ${targetLevel} (your level is ${editorLevel}).` }\r\n  }\r\n\r\n  // 5. SCOPE RULE: Check if editor has jurisdiction\r\n  let hasPermission = false\r\n  if (canManageAll) {\r\n    hasPermission = true\r\n  } else if (canManageOwn) {\r\n    if (editor.company_id === target.company_id) {\r\n      hasPermission = true\r\n    } else {\r\n      return { error: \"Permission Denied: You can only edit profiles within your own company.\" }\r\n    }\r\n  }\r\n\r\n  if (!hasPermission) {\r\n    return { error: 'You do not have permission to edit this profile.' }\r\n  }\r\n\r\n  // 6. Prepare Updates\r\n  const updates: { [key: string]: any } = {\r\n    cadet_rank: formData.get('cadet_rank')?.toString() || null,\r\n    room_number: formData.get('room_number')?.toString() || null,\r\n    grade_level: formData.get('grade_level')?.toString() || null,\r\n    years_attended: parseInt(formData.get('years_attended')?.toString() || '0'),\r\n    probation_status: formData.get('probation_status')?.toString() || null,\r\n    sport_fall: formData.get('sport_fall')?.toString() || null,\r\n    sport_winter: formData.get('sport_winter')?.toString() || null,\r\n    sport_spring: formData.get('sport_spring')?.toString() || null,\r\n  }\r\n\r\n  // 7. SENSITIVE FIELD CHECK: Star Tours\r\n  // Only specific high-level roles can modify this field\r\n  const canManageStarTours = STAR_TOUR_AUTHORIZED_ROLES.includes(editorRole.role_name);\r\n  if (canManageStarTours) {\r\n    // Only read the checkbox if they are authorized\r\n    if (formData.has('has_star_tours')) {\r\n        updates.has_star_tours = formData.get('has_star_tours') === 'on'\r\n    }\r\n  }\r\n\r\n  const { error } = await supabase.from('profiles').update(updates).eq('id', cadetId)\r\n\r\n  if (error) {\r\n    console.error('Profile update error:', error.message)\r\n    return { error: `Update failed: ${error.message}` }\r\n  }\r\n\r\n  revalidatePath(`/profile/${cadetId}`)\r\n  revalidatePath(`/reports/daily`)\r\n  return { success: true }\r\n}\r\n\r\nexport async function submitTourAdjustment(cadetId: string, amount: number, reason: string) {\r\n  const supabase = createClient()\r\n  \r\n  // 1. Auth Check\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return { error: 'Unauthorized' }\r\n\r\n  // 2. Permission Check (Commandant Staff / Level 90+)\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select('role:role_id (default_role_level)')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  const roleLevel = (profile?.role as any)?.default_role_level || 0\r\n  if (roleLevel < 90) {\r\n    return { error: 'Permission Denied: Only Commandant Staff can manually adjust tour balances.' }\r\n  }\r\n\r\n  if (amount === 0) return { error: 'Adjustment amount cannot be zero.' }\r\n  if (!reason) return { error: 'A reason is required for adjustments.' }\r\n\r\n  // 3. Insert Ledger Entry\r\n  const { error } = await supabase.from('tour_ledger').insert({\r\n    cadet_id: cadetId,\r\n    staff_id: user.id,\r\n    amount: amount,\r\n    action: 'adjustment',\r\n    comment: reason\r\n  })\r\n\r\n  if (error) {\r\n    console.error('Adjustment Error:', error)\r\n    return { error: error.message }\r\n  }\r\n\r\n  // 4. Revalidate\r\n  revalidatePath(`/profile/${cadetId}`)\r\n  revalidatePath(`/ledger/${cadetId}`)\r\n  \r\n  return { success: true }\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/.next-internal/server/app/profile/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {submitTourAdjustment as '70b9149166bb73a786dd21695a604390b8789189f9'} from 'ACTIONS_MODULE0'\nexport {updateCadetProfile as '60522fa0c1ab889549cd43ee3a6e075bf758d786b7'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}}]
}