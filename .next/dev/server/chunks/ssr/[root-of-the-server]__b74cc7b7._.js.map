{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/roles/components/ChainVisualizer.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/manage/roles/components/ChainVisualizer.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/manage/roles/components/ChainVisualizer.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAmT,GAChV,iFACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/roles/components/ChainVisualizer.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/manage/roles/components/ChainVisualizer.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/manage/roles/components/ChainVisualizer.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA+R,GAC5T,6DACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/roles/page.tsx"],"sourcesContent":["// app/manage/roles/page.tsx\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { redirect } from 'next/navigation'\r\nimport ChainVisualizer from './components/ChainVisualizer'\r\n\r\n// Define the required types for safety\r\ntype Company = { id: string; company_name: string }\r\ntype UserProfile = {\r\n    company_id: string | null;\r\n    role: {\r\n        can_manage_all_rosters: boolean;\r\n        can_manage_own_company_roster: boolean;\r\n        default_role_level: number;\r\n    } | null;\r\n}\r\n\r\nexport default async function RolesConfigurationPage() {\r\n  const supabase = createClient()\r\n\r\n  // 1. Get User & Permissions\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return redirect('/login')\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select(`\r\n        company_id, \r\n        role:role_id (can_manage_all_rosters, can_manage_own_company_roster, default_role_level)\r\n    `)\r\n    .eq('id', user.id)\r\n    .single<UserProfile>()\r\n    \r\n  const userPermissions = profile?.role || { can_manage_all_rosters: false, can_manage_own_company_roster: false, default_role_level: 0 }\r\n  const userCompanyId = profile?.company_id\r\n\r\n  // 2. Authorization Check (Staff/High Level Required to configure the chain)\r\n  // This prevents non-managers from even loading the page\r\n  if (userPermissions.default_role_level < 50) {\r\n      return <div className=\"max-w-7xl mx-auto p-8 text-red-500\">Permission Denied: You must be Staff (Level 50+) or higher to configure the Chain of Command.</div>\r\n  }\r\n\r\n  // 3. Fetch all potential companies (excluding non-cadet units)\r\n  const { data: allCompanies } = await supabase\r\n    .from('companies')\r\n    .select('id, company_name')\r\n    // Exclude Commandant Department and Faculty, as requested\r\n    .not('company_name', 'in', '(\"Commandant Department\", \"Faculty\")') \r\n    .order('company_name')\r\n\r\n  // 4. Apply Management Filters\r\n  const filteredCompanies = (allCompanies || [])\r\n    .filter(company => {\r\n        // Condition A: If user can manage all, show all companies\r\n        if (userPermissions.can_manage_all_rosters) {\r\n            return true;\r\n        }\r\n        \r\n        // Condition B: If user can manage their own company, show only their company\r\n        if (userPermissions.can_manage_own_company_roster && userCompanyId) {\r\n            return company.id === userCompanyId;\r\n        }\r\n        \r\n        // If neither condition is met, exclude the company\r\n        return false;\r\n    }) as Company[]\r\n\r\n  return (\r\n    <div className=\"max-w-[95vw] mx-auto p-6\">\r\n      <div className=\"mb-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Chain of Command Configuration</h1>\r\n        <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\r\n          Select a company to visualize and edit its specific approval flow.\r\n        </p>\r\n      </div>\r\n      \r\n      {filteredCompanies.length === 0 ? (\r\n          <div className=\"p-8 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-800 rounded-lg\">\r\n              <h2 className=\"text-lg font-medium text-yellow-800 dark:text-yellow-200\">No Companies Available</h2>\r\n              <p className=\"text-sm text-yellow-700 dark:text-yellow-300\">\r\n                  Your current role does not grant permission to configure any company's approval chain.\r\n              </p>\r\n          </div>\r\n      ) : (\r\n          // Pass the filtered list of companies to the client\r\n          <ChainVisualizer initialCompanies={filteredCompanies} />\r\n      )}\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"AAAA,4BAA4B;;;;;;AAC5B;AACA;AAAA;AACA;;;;;AAae,eAAe;IAC5B,MAAM,WAAW,IAAA,2IAAY;IAE7B,4BAA4B;IAC5B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IACtD,IAAI,CAAC,MAAM,OAAO,IAAA,iMAAQ,EAAC;IAE3B,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;IAGT,CAAC,EACA,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;IAET,MAAM,kBAAkB,SAAS,QAAQ;QAAE,wBAAwB;QAAO,+BAA+B;QAAO,oBAAoB;IAAE;IACtI,MAAM,gBAAgB,SAAS;IAE/B,4EAA4E;IAC5E,wDAAwD;IACxD,IAAI,gBAAgB,kBAAkB,GAAG,IAAI;QACzC,qBAAO,8OAAC;YAAI,WAAU;sBAAqC;;;;;;IAC/D;IAEA,+DAA+D;IAC/D,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,aACL,MAAM,CAAC,mBACR,0DAA0D;KACzD,GAAG,CAAC,gBAAgB,MAAM,wCAC1B,KAAK,CAAC;IAET,8BAA8B;IAC9B,MAAM,oBAAoB,CAAC,gBAAgB,EAAE,EAC1C,MAAM,CAAC,CAAA;QACJ,0DAA0D;QAC1D,IAAI,gBAAgB,sBAAsB,EAAE;YACxC,OAAO;QACX;QAEA,6EAA6E;QAC7E,IAAI,gBAAgB,6BAA6B,IAAI,eAAe;YAChE,OAAO,QAAQ,EAAE,KAAK;QAC1B;QAEA,mDAAmD;QACnD,OAAO;IACX;IAEF,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAAmD;;;;;;kCACjE,8OAAC;wBAAE,WAAU;kCAAwC;;;;;;;;;;;;YAKtD,kBAAkB,MAAM,KAAK,kBAC1B,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAA2D;;;;;;kCACzE,8OAAC;wBAAE,WAAU;kCAA+C;;;;;;;;;;;uBAKhE,oDAAoD;0BACpD,8OAAC,mKAAe;gBAAC,kBAAkB;;;;;;;;;;;;AAI7C","debugId":null}}]
}