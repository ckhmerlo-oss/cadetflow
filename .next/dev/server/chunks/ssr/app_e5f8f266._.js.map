{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/CloseButton.tsx"],"sourcesContent":["// in app/components/CloseButton.tsx\r\n'use client'\r\n\r\nimport { useRouter } from 'next/navigation'\r\n\r\nexport default function CloseButton() {\r\n  const router = useRouter()\r\n\r\n  return (\r\n    <button\r\n      onClick={() => router.push('/')} // Always returns to the dashboard\r\n      className=\"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors\"\r\n      aria-label=\"Close and go to dashboard\"\r\n    >\r\n      {/* Heroicon: XMarkIcon (24x24) */}\r\n      <svg \r\n        xmlns=\"http://www.w3.org/2000/svg\" \r\n        fill=\"none\" \r\n        viewBox=\"0 0 24 24\" \r\n        strokeWidth={1.5} \r\n        stroke=\"currentColor\" \r\n        className=\"w-7 h-7\"\r\n      >\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M6 18L18 6M6 6l12 12\" />\r\n      </svg>\r\n    </button>\r\n  )\r\n}"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;AAGpC;AAFA;;;AAIe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IAExB,qBACE,8OAAC;QACC,SAAS,IAAM,OAAO,IAAI,CAAC;QAC3B,WAAU;QACV,cAAW;kBAGX,cAAA,8OAAC;YACC,OAAM;YACN,MAAK;YACL,SAAQ;YACR,aAAa;YACb,QAAO;YACP,WAAU;sBAEV,cAAA,8OAAC;gBAAK,eAAc;gBAAQ,gBAAe;gBAAQ,GAAE;;;;;;;;;;;;;;;;AAI7D","debugId":null}},
    {"offset": {"line": 51, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/submit/page.tsx"],"sourcesContent":["// in app/submit/page.tsx\r\n'use client' \r\n\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport { useRouter } from 'next/navigation'\r\nimport { useState, useEffect } from 'react'\r\nimport CloseButton from '@/app/components/CloseButton'\r\n\r\ntype CadetProfile = {\r\n  id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n}\r\n\r\n// *** NEW: Type for the offense_types table ***\r\ntype OffenseType = {\r\n  id: string;\r\n  offense_group: string;\r\n  offense_name: string;\r\n  demerits: number;\r\n}\r\n\r\nexport default function SubmitReport() {\r\n  const supabase = createClient()\r\n  const router = useRouter()\r\n  \r\n  // State for your form fields\r\n  const [subjectCadetId, setSubjectCadetId] = useState('')\r\n  const [offenseTypeId, setOffenseTypeId] = useState('') // *** NEW ***\r\n  const [notes, setNotes] = useState('') // *** NEW ***\r\n  const [dateOfOffense, setDateOfOffense] = useState(new Date().toISOString().split('T')[0])\r\n\r\n  // Data for dropdowns\r\n  const [cadets, setCadets] = useState<CadetProfile[]>([])\r\n  const [offenses, setOffenses] = useState<OffenseType[]>([])\r\n  \r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // 1. Fetch cadets AND offense types for the dropdowns\r\n  useEffect(() => {\r\n    async function getFormData() {\r\n      // Fetch cadets\r\n      const { data: cadetsData, error: cadetsError } = await supabase.rpc('get_subordinates')\r\n      if (cadetsError) {\r\n        setError('Could not fetch cadets: ' + cadetsError.message)\r\n      } else if (cadetsData) {\r\n        cadetsData.sort((a, b) => a.last_name.localeCompare(b.last_name))\r\n        setCadets(cadetsData)\r\n      }\r\n\r\n      // Fetch all offense types\r\n      const { data: offensesData, error: offensesError } = await supabase\r\n        .from('offense_types')\r\n        .select('id, offense_group, offense_name, demerits')\r\n        .order('offense_group')\r\n        .order('offense_name')\r\n        \r\n      if (offensesError) {\r\n        setError('Could not fetch offense types: ' + offensesError.message)\r\n      } else if (offensesData) {\r\n        setOffenses(offensesData)\r\n      }\r\n    }\r\n    getFormData()\r\n  }, [supabase]) \r\n\r\n  // 2. Handle the form submission\r\n  async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\r\n    e.preventDefault() \r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    // 3. Call your REFACTORED 'create_new_report' SQL function\r\n    const { error: rpcError } = await supabase.rpc('create_new_report', {\r\n      p_subject_cadet_id: subjectCadetId,\r\n      p_offense_type_id: offenseTypeId, // *** CHANGED ***\r\n      p_notes: notes, // *** CHANGED ***\r\n      p_date_of_offense: dateOfOffense\r\n    })\r\n\r\n    setLoading(false)\r\n\r\n    if (rpcError) {\r\n      setError('Error submitting report: ' + rpcError.message)\r\n    } else {\r\n      router.push('/') \r\n      router.refresh() \r\n    }\r\n  }\r\n  \r\n  // Group offenses by their 'offense_group' for the <optgroup>\r\n  const groupedOffenses = offenses.reduce((acc, offense) => {\r\n    const group = offense.offense_group;\r\n    if (!acc[group]) {\r\n      acc[group] = [];\r\n    }\r\n    acc[group].push(offense);\r\n    return acc;\r\n  }, {} as Record<string, OffenseType[]>);\r\n\r\n  return (\r\n    <div className=\"relative max-w-2xl mx-auto p-4 sm:p-6 lg:p-8\">\r\n      <CloseButton />\r\n      <div className=\"bg-white p-6 rounded-lg shadow-md\">\r\n        \r\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n          <h2 className=\"text-2xl font-semibold text-gray-900\">\r\n            Submit New Report\r\n          </h2>\r\n\r\n          {/* Subject Cadet Field */}\r\n          <div>\r\n            <label htmlFor=\"cadet\" className=\"block text-sm font-medium text-gray-700\">\r\n              Subject Cadet\r\n            </label>\r\n            <select \r\n              id=\"cadet\"\r\n              value={subjectCadetId} \r\n              onChange={(e) => setSubjectCadetId(e.target.value)} \r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n            >\r\n              <option value=\"\">Select a cadet...</option>\r\n              {cadets.map((cadet) => (\r\n                <option key={cadet.id} value={cadet.id}>\r\n                  {cadet.last_name}, {cadet.first_name}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Date of Offense */}\r\n          <div>\r\n            <label htmlFor=\"date\" className=\"block text-sm font-medium text-gray-700\">\r\n              Date of Offense\r\n            </label>\r\n            <input \r\n              id=\"date\"\r\n              type=\"date\"\r\n              value={dateOfOffense} \r\n              onChange={(e) => setDateOfOffense(e.target.value)} \r\n              required \r\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n            />\r\n          </div>\r\n          \r\n          {/* *** NEW: Offense Type Dropdown *** */}\r\n          <div>\r\n            <label htmlFor=\"offense_type\" className=\"block text-sm font-medium text-gray-700\">\r\n              Offense\r\n            </label>\r\n            <select \r\n              id=\"offense_type\"\r\n              value={offenseTypeId} \r\n              onChange={(e) => setOffenseTypeId(e.target.value)} \r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n            >\r\n              <option value=\"\">Select an offense...</option>\r\n              {Object.entries(groupedOffenses).map(([groupName, groupOffenses]) => (\r\n                <optgroup label={groupName} key={groupName}>\r\n                  {groupOffenses.map((offense) => (\r\n                    <option key={offense.id} value={offense.id}>\r\n                      ({offense.demerits} demerits) {offense.offense_name}\r\n                    </option>\r\n                  ))}\r\n                </optgroup>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Notes Field */}\r\n          <div>\r\n            <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700\">\r\n              Notes (Optional)\r\n            </label>\r\n            <textarea \r\n              id=\"notes\"\r\n              value={notes} \r\n              onChange={(e) => setNotes(e.target.value)} \r\n              rows={4}\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n              placeholder=\"Provide specific details of the incident...\"\r\n            />\r\n          </div>\r\n\r\n          {/* Submit Button */}\r\n          <div>\r\n            <button \r\n              type=\"submit\" \r\n              disabled={loading}\r\n              className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400\"\r\n            >\r\n              {loading ? 'Submitting...' : 'Submit Report'}\r\n            </button>\r\n          </div>\r\n\r\n          {error && <p className=\"text-sm text-red-600\">{error}</p>}\r\n        </form>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}