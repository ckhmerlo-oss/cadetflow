{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/%5Bid%5D/ProfileClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/profile/[id]/ProfileClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/profile/[id]/ProfileClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/%5Bid%5D/ProfileClient.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/profile/[id]/ProfileClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/profile/[id]/ProfileClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/%5Bid%5D/page.tsx"],"sourcesContent":["import { createClient } from '@/utils/supabase/server'\r\nimport { notFound, redirect } from 'next/navigation'\r\nimport ProfileClient from './ProfileClient'\r\nimport { EDIT_AUTHORIZED_ROLES, STAR_TOUR_AUTHORIZED_ROLES } from '../constants'\r\n\r\ntype LedgerStats = {\r\n  term_demerits: number;\r\n  year_demerits: number;\r\n  total_tours_marched: number;\r\n  current_tour_balance: number;\r\n}\r\n\r\nfunction getCurrentSport(profile: any) {\r\n  const month = new Date().getMonth() \r\n  if (month >= 7 && month <= 10) return { season: 'Fall Sport', sport: profile.sport_fall }\r\n  else if (month === 11 || month <= 2) return { season: 'Winter Sport', sport: profile.sport_winter }\r\n  else return { season: 'Spring Sport', sport: profile.sport_spring }\r\n}\r\n\r\nfunction calculateConductStatus(termDemerits: number, yearDemerits: number): string {\r\n    if (termDemerits >= 43 || yearDemerits >= 211) return 'Unsatisfactory';\r\n    if (termDemerits >= 31 || yearDemerits >= 151) return 'Deficient';\r\n    if (termDemerits >= 19 || yearDemerits >= 91)  return 'Satisfactory';\r\n    if (termDemerits >= 7  || yearDemerits >= 31)  return 'Commendable';\r\n    return 'Exemplary';\r\n}\r\n\r\nexport default async function ProfilePage({ params }: { params: Promise<{ id: string }> }) {\r\n  const { id } = await params\r\n  const supabase = createClient()\r\n\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return redirect('/login')\r\n\r\n  const { data: viewerProfile } = await supabase\r\n    .from('profiles')\r\n    .select('id, company_id, role:role_id (role_name, default_role_level, can_manage_all_rosters, can_manage_own_company_roster)')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (!viewerProfile) return redirect('/login')\r\n\r\n  // Viewer Permissions\r\n  const viewerRole = viewerProfile.role as any\r\n  const viewerRoleLevel = viewerRole?.default_role_level || 0\r\n  const viewerRoleName = viewerRole?.role_name || ''\r\n  const canManageAll = viewerRole?.can_manage_all_rosters || false\r\n  const canManageOwn = viewerRole?.can_manage_own_company_roster || false\r\n  const viewerCompanyId = viewerProfile.company_id\r\n  \r\n  const [profileRes, statsRes] = await Promise.all([\r\n      supabase.from('profiles').select(`*, company:company_id (company_name), role:role_id (role_name, default_role_level)`).eq('id', id).single(),\r\n      supabase.rpc('get_cadet_ledger_stats', { p_cadet_id: id }).single()\r\n  ])\r\n\r\n  const profile = profileRes.data\r\n  const stats = statsRes.data as LedgerStats | null\r\n\r\n  if (profileRes.error || !profile) return notFound()\r\n\r\n  const targetRoleLevel = (profile.role as any)?.default_role_level || 0\r\n  const isSelf = user.id === id\r\n  const isAdmin = viewerRoleName === 'Admin'\r\n  \r\n  // 1. Rank Check\r\n  if (!isSelf && !isAdmin && (viewerRoleLevel < targetRoleLevel)) {\r\n     return <div className=\"max-w-md mx-auto mt-20 p-6 bg-white dark:bg-gray-800 rounded-lg shadow text-center border border-gray-200 dark:border-gray-700\"><h2 className=\"text-2xl font-bold text-red-600 mb-2\">Unauthorized</h2><p className=\"text-gray-600 dark:text-gray-300\">You do not have sufficient rank to view this profile.</p></div>\r\n  }\r\n\r\n  // 2. Company Isolation Check (NEW)\r\n  // If you have \"Manage Own\" but NOT \"Manage All\", you can only see profiles in your company\r\n  if (!isSelf && !isAdmin && !canManageAll && canManageOwn) {\r\n     if (viewerCompanyId !== profile.company_id) {\r\n         return <div className=\"max-w-md mx-auto mt-20 p-6 bg-white dark:bg-gray-800 rounded-lg shadow text-center border border-gray-200 dark:border-gray-700\"><h2 className=\"text-2xl font-bold text-red-600 mb-2\">Unauthorized</h2><p className=\"text-gray-600 dark:text-gray-300\">You can only view profiles within your own company.</p></div>\r\n     }\r\n  }\r\n\r\n  const canEdit = EDIT_AUTHORIZED_ROLES.includes(viewerRoleName) || viewerRoleName.includes('TAC') || isAdmin\r\n  const canManageStarTours = STAR_TOUR_AUTHORIZED_ROLES.includes(viewerRoleName)\r\n\r\n  const currentSportData = getCurrentSport(profile)\r\n  const calculatedConduct = calculateConductStatus(stats?.term_demerits || 0, stats?.year_demerits || 0)\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8\">\r\n       <ProfileClient \r\n            profile={profile}\r\n            stats={stats}\r\n            canEdit={canEdit}\r\n            canManageStarTours={canManageStarTours}\r\n            currentSportData={currentSportData}\r\n            calculatedConduct={calculatedConduct}\r\n       />\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}