{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/internal/font/google/inter_5972bc34.module.css [app-rsc] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"className\": \"inter_5972bc34-module__OU16Qa__className\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA","ignoreList":[0]}},
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["turbopack:///[next]/internal/font/google/inter_5972bc34.js"],"sourcesContent":["import cssModule from \"@vercel/turbopack-next/internal/font/google/cssmodule.module.css?{%22path%22:%22layout.tsx%22,%22import%22:%22Inter%22,%22arguments%22:[{%22subsets%22:[%22latin%22]}],%22variableName%22:%22inter%22}\";\nconst fontData = {\n    className: cssModule.className,\n    style: {\n        fontFamily: \"'Inter', 'Inter Fallback'\",\n        fontStyle: \"normal\",\n\n    },\n};\n\nif (cssModule.variable != null) {\n    fontData.variable = cssModule.variable;\n}\n\nexport default fontData;\n"],"names":[],"mappings":";;;;AAAA;;AACA,MAAM,WAAW;IACb,WAAW,gKAAS,CAAC,SAAS;IAC9B,OAAO;QACH,YAAY;QACZ,WAAW;IAEf;AACJ;AAEA,IAAI,gKAAS,CAAC,QAAQ,IAAI,MAAM;IAC5B,SAAS,QAAQ,GAAG,gKAAS,CAAC,QAAQ;AAC1C;uCAEe","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/utils/supabase/server.ts"],"sourcesContent":["// in utils/supabase/server.ts\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport function createClient() {\r\n  // Define cookieStore ONCE, at the top.\r\n  const cookieStore = cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        async get(name: string) {\r\n          return (await cookieStore).get(name)?.value\r\n        },\r\n        async set(name: string, value: string, options: CookieOptions) {\r\n          try {\r\n            (await cookieStore).set({ name, value, ...options })\r\n          } catch (error) {\r\n            // The `set` method was called from a Server Component.\r\n            // This can be ignored if you have middleware.\r\n          }\r\n        },\r\n        async remove(name: string, options: CookieOptions) {\r\n          try {\r\n            (await cookieStore).delete({ name, ...options })\r\n          } catch (error) {\r\n            // The `delete` method was called from a Server Component.\r\n            // This can be ignored if you have middleware.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}"],"names":[],"mappings":"AAAA,8BAA8B;;;;;AAC9B;AAAA;AACA;;;AAEO,SAAS;IACd,uCAAuC;IACvC,MAAM,cAAc,IAAA,0IAAO;IAE3B,OAAO,IAAA,+LAAkB,sUAGvB;QACE,SAAS;YACP,MAAM,KAAI,IAAY;gBACpB,OAAO,CAAC,MAAM,WAAW,EAAE,GAAG,CAAC,OAAO;YACxC;YACA,MAAM,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBAC3D,IAAI;oBACF,CAAC,MAAM,WAAW,EAAE,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBACpD,EAAE,OAAO,OAAO;gBACd,uDAAuD;gBACvD,8CAA8C;gBAChD;YACF;YACA,MAAM,QAAO,IAAY,EAAE,OAAsB;gBAC/C,IAAI;oBACF,CAAC,MAAM,WAAW,EAAE,MAAM,CAAC;wBAAE;wBAAM,GAAG,OAAO;oBAAC;gBAChD,EAAE,OAAO,OAAO;gBACd,0DAA0D;gBAC1D,8CAA8C;gBAChD;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/ThemeProvider.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ThemeProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/ThemeProvider.tsx <module evaluation>\",\n    \"ThemeProvider\",\n);\nexport const useTheme = registerClientReference(\n    function() { throw new Error(\"Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/ThemeProvider.tsx <module evaluation>\",\n    \"useTheme\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,kEACA;AAEG,MAAM,WAAW,IAAA,wQAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,kEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/ThemeProvider.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ThemeProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/ThemeProvider.tsx\",\n    \"ThemeProvider\",\n);\nexport const useTheme = registerClientReference(\n    function() { throw new Error(\"Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/ThemeProvider.tsx\",\n    \"useTheme\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;;;AACvE;;AACO,MAAM,gBAAgB,IAAA,wQAAuB,EAChD;IAAa,MAAM,IAAI,MAAM;AAA0O,GACvQ,8CACA;AAEG,MAAM,WAAW,IAAA,wQAAuB,EAC3C;IAAa,MAAM,IAAI,MAAM;AAAgO,GAC7P,8CACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/HeaderMenu.tsx"],"sourcesContent":["import { createClient } from '@/utils/supabase/server'\r\nimport Link from 'next/link'\r\nimport { redirect } from 'next/navigation'\r\n\r\n// --- Types ---\r\ntype ReportWithNames = {\r\n  id: string;\r\n  status: string;\r\n  created_at: string;\r\n  current_approver_group_id: string | null;\r\n  subject_cadet_id: string;\r\n  submitted_by: string;\r\n  subject: { first_name: string, last_name: string } | null;\r\n  submitter: { first_name: string, last_name: string } | null;\r\n  group: { group_name: string } | null;\r\n  offense_type: { offense_name: string } | null;\r\n  appeal_status: string | null;\r\n}\r\n\r\ntype CadetStats = {\r\n  term_demerits: number;\r\n  year_demerits: number;\r\n  total_tours_marched: number;\r\n  current_tour_balance: number;\r\n}\r\n\r\nexport default async function Dashboard() {\r\n  const supabase = createClient()\r\n\r\n  // 1. Get User & Profile\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return redirect('/login')\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select(`first_name, last_name, company_id, role:role_id (default_role_level, can_manage_all_rosters, approval_group:approval_group_id (group_name))`)\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (profile && profile.company_id === null && profile.first_name === 'New') return redirect('/onboarding')\r\n\r\n  // Handle Types safely\r\n  const role = profile?.role as any\r\n  const role_level = role?.default_role_level || 0\r\n  const canManageAll = role?.can_manage_all_rosters || false\r\n  const isFaculty = role_level >= 50 || false\r\n  const groupName = role?.approval_group?.group_name || 'Personal Dashboard'\r\n\r\n  if (role_level === 10) {\r\n    redirect(`/ledger/${user.id}`);\r\n  }\r\n\r\n  // 2. Fetch Data\r\n  const { data: rpcData, error } = await supabase.rpc('get_my_dashboard_reports')\r\n  if (error) console.error(\"Error fetching reports:\", error.message)\r\n  \r\n  const allInvolvedReports: ReportWithNames[] = rpcData || [];\r\n\r\n  let allPendingReports: ReportWithNames[] = [];\r\n  let cadetStats: CadetStats | null = null; \r\n  let allCompletedReports: ReportWithNames[] = []; \r\n\r\n  if (isFaculty) {\r\n    const { data: facultyData } = await supabase.rpc('get_all_pending_reports_for_faculty')\r\n    allPendingReports = facultyData?.map((item: any) => ({ ...item, subject: item.subject, submitter: item.submitter, group: item.group, offense_type: { offense_name: item.title } })) as ReportWithNames[] || [];\r\n\r\n    const { data: completedData } = await supabase.rpc('get_all_completed_reports_for_faculty')\r\n    allCompletedReports = completedData?.map((item: any) => ({ \r\n        ...item, \r\n        subject: item.subject, \r\n        submitter: item.submitter, \r\n        group: item.group, \r\n        offense_type: { offense_name: item.title },\r\n        appeal_status: item.appeal_status \r\n    })) as ReportWithNames[] || [];\r\n  } else {\r\n    const { data: statsData } = await supabase.rpc('get_cadet_ledger_stats', { p_cadet_id: user.id }).single<CadetStats>()\r\n    if (statsData) cadetStats = statsData;\r\n  }\r\n    \r\n  // 3. Filter Lists\r\n  const actionItems = allInvolvedReports.filter(report => {\r\n      if (report.status === 'pulled') return false; \r\n      if (report.status === 'pending_approval' && report.current_approver_group_id !== null) return true;\r\n      if (report.status === 'needs_revision' && report.submitted_by === user.id) return true;\r\n      if (report.appeal_status) {\r\n          if (report.subject_cadet_id === user.id) return ['rejected_by_issuer', 'rejected_by_chain'].includes(report.appeal_status);\r\n          return ['pending_issuer', 'pending_chain', 'pending_commandant'].includes(report.appeal_status);\r\n      }\r\n      return false;\r\n  }) || []\r\n\r\n  // ... existing code ...\r\n  const mySubmittedReports = allInvolvedReports.filter(report => report.submitted_by === user.id) || []\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 animate-in fade-in duration-500\">\r\n\r\n      <div className=\"flex justify-between items-center mb-8\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Welcome, {profile?.first_name || user.email}</h1>\r\n          <p className=\"mt-2 text-lg text-gray-600 dark:text-gray-400\">{groupName}</p>\r\n        </div>\r\n        \r\n        {/* --- UPDATED HEADER BUTTONS --- */}\r\n        <div className=\"flex gap-3\">\r\n                  \r\n          {(role_level >= 15) && (\r\n            <Link href=\"/submit\" className=\"py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition-colors\">\r\n              Submit New Report\r\n            </Link>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {!isFaculty && cadetStats && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div className=\"md:col-span-2\"><div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\"><CadetStatsHeader stats={cadetStats} /></div></div>\r\n          <div className=\"bg-sky-300 dark:bg-indigo-900 rounded-lg shadow-sm flex overflow-hidden\">\r\n            <Link href={`/ledger/${user.id}`} className=\"flex-1 flex items-center justify-center p-6 text-lg font-bold text-white hover:bg-sky-500 dark:hover:bg-indigo-600 transition-colors w-full h-full text-center\">\r\n                View Full Record &rarr;\r\n            </Link>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6\">\r\n        \r\n        {/* Only ONE instance of Action Items, wrapped in the ID for the Tour */}\r\n        {(role_level >= 15) && (\r\n            <div id=\"dashboard-action-items\">\r\n                <DashboardSection \r\n                    title=\"Action Items\" \r\n                    items={actionItems} \r\n                    emptyMessage=\"No action items in your queue. Great job!\" \r\n                    showSubject \r\n                    viewAllHref=\"/action-items\"\r\n                />\r\n            </div>\r\n        )}\r\n        \r\n        {isFaculty && canManageAll && (\r\n            <DashboardSection \r\n                title=\"All In-Progress Reports\" \r\n                items={allPendingReports} \r\n                emptyMessage=\"No reports pending approval.\" \r\n                showSubject \r\n                viewAllHref=\"/reports/pending\"\r\n            />\r\n        )}\r\n\r\n        {(role_level >= 15) && (\r\n            <DashboardSection \r\n                title=\"Submitted Reports\" \r\n                items={mySubmittedReports} \r\n                emptyMessage=\"You haven't submitted any reports yet.\" \r\n                showSubject \r\n                viewAllHref=\"/reports/submitted\"\r\n            />\r\n        )}\r\n\r\n        {/* --- UPDATED SECTION: Completed Archive --- */}\r\n        {isFaculty && (\r\n            <DashboardSection \r\n                title=\"Completed Archive\" \r\n                items={allCompletedReports} \r\n                emptyMessage=\"No completed reports found.\" \r\n                showSubject \r\n                viewAllHref=\"/reports/history\" \r\n            />\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n// --- Helper Components (Unchanged) ---\r\n\r\nfunction CadetStatsHeader({ stats }: { stats: CadetStats }) {\r\n  return (\r\n    <>\r\n      <StatCard title=\"Current Term Demerits\" value={stats.term_demerits} />\r\n      <StatCard title=\"Academic Year Demerits\" value={stats.year_demerits} />\r\n      <StatCard title=\"Current Tour Balance\" value={stats.current_tour_balance} />\r\n    </>\r\n  )\r\n}\r\n\r\nfunction StatCard({ title, value }: { title: string, value: string | number }) {\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm\">\r\n      <h3 className=\"text-sm font-medium text-gray-500 dark:text-gray-400\">{title}</h3>\r\n      <p className=\"text-3xl font-bold mt-2 text-gray-900 dark:text-white\">{value}</p>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction DashboardSection({ \r\n    title, \r\n    items, \r\n    emptyMessage, \r\n    showSubject = false, \r\n    showSubmitter = false,\r\n    viewAllHref \r\n}: { \r\n    title: string; \r\n    items: ReportWithNames[]; \r\n    emptyMessage: string; \r\n    showSubject?: boolean; \r\n    showSubmitter?: boolean;\r\n    viewAllHref?: string;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-4 flex flex-col h-full\">\r\n      <div className=\"flex justify-between items-end\">\r\n          <h2 className=\"text-2xl font-semibold text-gray-800 dark:text-gray-100\">\r\n            {/* If a link is provided, wrap the title in it */}\r\n            {viewAllHref ? (\r\n                <Link href={viewAllHref} className=\"hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors\">\r\n                    {title}\r\n                </Link>\r\n            ) : title}\r\n            <span className=\"ml-2 text-lg text-gray-500 font-normal\">({items?.length || 0})</span>\r\n          </h2>\r\n          \r\n          {/* Render the \"View all ->\" link if an href is passed */}\r\n          {viewAllHref && (\r\n            <Link href={viewAllHref} className=\"text-sm font-medium text-indigo-600 dark:text-indigo-400 hover:underline pb-1\">\r\n                View all &rarr;\r\n            </Link>\r\n          )}\r\n      </div>\r\n      \r\n      <div className=\"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm space-y-3 h-96 overflow-y-auto flex-grow\">\r\n        {items && items.length > 0 ? (\r\n            items.map(report => (\r\n                <ReportCard \r\n                    key={report.id} \r\n                    report={report} \r\n                    showSubject={showSubject} \r\n                    showSubmitter={showSubmitter} \r\n                />\r\n            ))\r\n        ) : (\r\n            <p className=\"text-gray-500 dark:text-gray-400 p-4\">{emptyMessage}</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction ReportCard({ report, showSubject, showSubmitter }: { report: ReportWithNames; showSubject?: boolean; showSubmitter?: boolean }) {\r\n  \r\n  const getStatusColor = () => {\r\n    switch (report.status) {\r\n      case 'completed': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100'\r\n      case 'rejected': return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100'\r\n      case 'pending_approval': return 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100'\r\n      case 'needs_revision': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100'\r\n      case 'pulled': return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100'\r\n      default: return 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-100'\r\n    }\r\n  }\r\n\r\n  const formatName = (person: { first_name: string, last_name: string } | null) => person ? `${person.last_name}, ${person.first_name.charAt(0)}.` : 'N/A';\r\n  \r\n  const formatStatus = (status: string) => {\r\n    if (status === 'pulled') return 'Pulled';\r\n    return status.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\r\n  }\r\n  \r\n  const title = report.offense_type?.offense_name || 'Untitled Report';\r\n\r\n  const getAppealBadge = (status: string) => {\r\n      if (status === 'approved') {\r\n          return <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 ml-2\">Appeal Granted</span>\r\n      } else if (status === 'rejected_final') {\r\n          return <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200 ml-2\">Appeal Denied</span>\r\n      } else {\r\n           return <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 ml-2\">Appeal In Progress</span>\r\n      }\r\n  }\r\n\r\n  return (\r\n    <Link \r\n      href={`/report/${report.id}`} \r\n      className=\"block p-4 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\"\r\n    >\r\n      <div className=\"flex justify-between items-center\">\r\n        <div className=\"truncate flex items-center flex-1 mr-2\">\r\n             <span className={`font-medium ${report.status === 'pulled' ? 'text-gray-500 line-through' : 'text-indigo-600 dark:text-indigo-400'}`}>{title}</span>\r\n             {report.appeal_status && getAppealBadge(report.appeal_status)}\r\n        </div>\r\n        <span className={`text-xs font-medium px-2 py-0.5 rounded-full flex-shrink-0 ${getStatusColor()}`}>\r\n          {formatStatus(report.status)}\r\n        </span>\r\n      </div>\r\n      <div className=\"mt-2 text-sm text-gray-500 dark:text-gray-400\">\r\n        {showSubject && <p>Subject: <span className=\"font-medium text-gray-700 dark:text-gray-200\">{formatName(report.subject)}</span></p>}\r\n        {showSubmitter && <p>Submitter: <span className=\"font-medium text-gray-700 dark:text-gray-200\">{formatName(report.submitter)}</span></p>}\r\n        {report.status === 'pending_approval' && <p>Waiting for: <span className=\"font-medium text-gray-700 dark:text-gray-200\">{report.group?.group_name || 'N/A'}</span></p>}\r\n      </div>\r\n    </Link>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 680, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/tour/OnboardingTour.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/components/tour/OnboardingTour.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/tour/OnboardingTour.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA0S,GACvU,wEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 694, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/tour/OnboardingTour.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/components/tour/OnboardingTour.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/components/tour/OnboardingTour.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsR,GACnT,oDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 708, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 716, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/layout.tsx"],"sourcesContent":["import './globals.css'\nimport { Inter } from 'next/font/google'\nimport Link from 'next/link'\nimport { createClient } from '@/utils/supabase/server'\nimport { ThemeProvider } from '@/app/components/ThemeProvider'\nimport HeaderMenu from '@/app/components/HeaderMenu'\nimport OnboardingTour from '@/app/components/tour/OnboardingTour'\n\nimport { SpeedInsights } from \"@vercel/speed-insights/next\"\nimport { Analytics } from \"@vercel/analytics/next\"\n\nconst inter = Inter({ subsets: ['latin'] })\n\nexport const metadata = {\n  title: 'CadetFlow',\n  description: 'Approval workflow application',\n}\n\nexport default async function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n\n  const supabase = createClient()\n  const { data: { user } } = await supabase.auth.getUser()\n  \n  let canManage = false\n  let roleLevel = 0\n  let logoText = \"CadetFlow\";\n  let logoColor = \"text-indigo-600 hover:text-indigo-700\";\n  let isSiteAdmin = false;\n  let hasSeenTour = false;\n\n  if (user) {\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select(`\n        is_site_admin,\n        has_seen_tour,\n        roles(can_manage_own_company_roster, can_manage_all_rosters, role_name, default_role_level),\n        company:companies(company_name)\n      `)\n      .eq('id', user.id)\n      .single()\n    \n    const roles = (profile as any)?.roles\n    const company = (profile as any)?.company \n\n    if (roles) {\n      roleLevel = roles.default_role_level || 0;\n      canManage = roles.can_manage_own_company_roster || roles.can_manage_all_rosters;\n    }\n    \n    // Pull profile-level flags\n    isSiteAdmin = profile?.is_site_admin || false;\n    // If profile is missing or flag is null, default to false (show tour)\n    // If profile exists and has_seen_tour is true, then we don't show it.\n    // Note: If profile doesn't exist yet (onboarding), we might want to suppress until profile is created.\n    // However, the tour is safe to show.\n    hasSeenTour = profile?.has_seen_tour || false;\n\n    // Dynamic Logo Logic\n    if (roleLevel >= 50 || (roles?.role_name && roles.role_name.includes('TAC'))) {\n      logoText = \"TACFlow\";\n      logoColor = \"text-red-600 hover:text-red-700\";\n    } else if (company?.company_name === 'Battalion Staff') { \n      logoText = \"StaffFlow\";\n      logoColor = \"text-yellow-600 hover:text-yellow-700\";\n    }\n  }\n  \n  return (\n    <html lang=\"en\" className=\"dark\" suppressHydrationWarning>\n      <body className={`${inter.className}`}>\n        <ThemeProvider defaultTheme=\"dark\">\n          <header className=\"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700\">\n            <nav className=\"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8\">\n              <div className=\"flex justify-between items-center h-16\">\n                \n                <div className=\"flex-shrink-0\">\n                  <Link \n                    href=\"/\" \n                    className={`text-2xl font-bold ${logoColor} transition-colors`}\n                  >\n                    {logoText}\n                  </Link>\n                </div>\n               \n                <div className=\"flex items-center\">\n                  <HeaderMenu \n                    isLoggedIn={!!user}\n                    canManage={canManage}\n                    showDailyReports={roleLevel >= 50}\n                    isSiteAdmin={isSiteAdmin}\n                  />\n                </div>\n              </div>\n            </nav>\n          </header>\n\n          <main>\n            {/* Inject the Tour Component here. \n                It will only render if user is logged in AND hasn't seen it yet.\n                We pass all permission flags so the tour can customize itself.\n            */}\n            {user && (\n              <OnboardingTour \n                show={!hasSeenTour} \n                canManage={canManage}\n                showDailyReports={roleLevel >= 50}\n                isSiteAdmin={isSiteAdmin}\n                roleLevel={roleLevel}\n                userId={user.id} // <--- ADDED THIS\n              />\n            )}\n            {children}\n          </main>\n        </ThemeProvider>\n        <SpeedInsights/>\n        <Analytics/>\n      </body>\n    </html>\n  )\n}"],"names":[],"mappings":";;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;;;AAIO,MAAM,WAAW;IACtB,OAAO;IACP,aAAa;AACf;AAEe,eAAe,WAAW,EACvC,QAAQ,EAGT;IAEC,MAAM,WAAW,IAAA,2IAAY;IAC7B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAEtD,IAAI,YAAY;IAChB,IAAI,YAAY;IAChB,IAAI,WAAW;IACf,IAAI,YAAY;IAChB,IAAI,cAAc;IAClB,IAAI,cAAc;IAElB,IAAI,MAAM;QACR,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,YACL,MAAM,CAAC,CAAC;;;;;MAKT,CAAC,EACA,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,MAAM,QAAS,SAAiB;QAChC,MAAM,UAAW,SAAiB;QAElC,IAAI,OAAO;YACT,YAAY,MAAM,kBAAkB,IAAI;YACxC,YAAY,MAAM,6BAA6B,IAAI,MAAM,sBAAsB;QACjF;QAEA,2BAA2B;QAC3B,cAAc,SAAS,iBAAiB;QACxC,sEAAsE;QACtE,sEAAsE;QACtE,uGAAuG;QACvG,qCAAqC;QACrC,cAAc,SAAS,iBAAiB;QAExC,qBAAqB;QACrB,IAAI,aAAa,MAAO,OAAO,aAAa,MAAM,SAAS,CAAC,QAAQ,CAAC,QAAS;YAC5E,WAAW;YACX,YAAY;QACd,OAAO,IAAI,SAAS,iBAAiB,mBAAmB;YACtD,WAAW;YACX,YAAY;QACd;IACF;IAEA,qBACE,8OAAC;QAAK,MAAK;QAAK,WAAU;QAAO,wBAAwB;kBACvD,cAAA,8OAAC;YAAK,WAAW,GAAG,oJAAK,CAAC,SAAS,EAAE;;8BACnC,8OAAC,oJAAa;oBAAC,cAAa;;sCAC1B,8OAAC;4BAAO,WAAU;sCAChB,cAAA,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC;oCAAI,WAAU;;sDAEb,8OAAC;4CAAI,WAAU;sDACb,cAAA,8OAAC,0LAAI;gDACH,MAAK;gDACL,WAAW,CAAC,mBAAmB,EAAE,UAAU,kBAAkB,CAAC;0DAE7D;;;;;;;;;;;sDAIL,8OAAC;4CAAI,WAAU;sDACb,cAAA,8OAAC,2IAAU;gDACT,YAAY,CAAC,CAAC;gDACd,WAAW;gDACX,kBAAkB,aAAa;gDAC/B,aAAa;;;;;;;;;;;;;;;;;;;;;;;;;;;sCAOvB,8OAAC;;gCAKE,sBACC,8OAAC,uJAAc;oCACb,MAAM,CAAC;oCACP,WAAW;oCACX,kBAAkB,aAAa;oCAC/B,aAAa;oCACb,WAAW;oCACX,QAAQ,KAAK,EAAE;;;;;;gCAGlB;;;;;;;;;;;;;8BAGL,8OAAC,wLAAa;;;;;8BACd,8OAAC,4KAAS;;;;;;;;;;;;;;;;AAIlB","debugId":null}}]
}