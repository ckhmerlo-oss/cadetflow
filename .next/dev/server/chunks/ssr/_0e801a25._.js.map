{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/admin/actions.ts"],"sourcesContent":["// in app/admin/actions.ts\r\n'use server'\r\n\r\n// We need TWO clients. One to check the user, one to perform the admin task.\r\nimport { createClient as createServerClient } from '@/utils/supabase/server' // Standard server client\r\nimport { createClient } from '@supabase/supabase-js' // Admin client\r\n\r\nexport async function adminResetPassword(prevState: any, formData: FormData) {\r\n  const userId = formData.get('userId') as string\r\n  const newPassword = formData.get('newPassword') as string\r\n\r\n  if (!userId || !newPassword) {\r\n    return { error: 'User ID and New Password are required.', success: false }\r\n  }\r\n\r\n  if (newPassword.length < 6) {\r\n    return { error: 'Password must be at least 6 characters.', success: false }\r\n  }\r\n\r\n  try {\r\n    // === START OF FIX ===\r\n    \r\n    // 1. Create a standard client to check the CALLER'S identity\r\n    const supabase = createServerClient()\r\n\r\n    // 2. Get the currently logged-in user's data\r\n    const { data: { user }, } = await supabase.auth.getUser()\r\n    if (!user) {\r\n      throw new Error('Not authenticated')\r\n    }\r\n\r\n    // 3. Check their role level from the profiles table\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('profiles')\r\n      .select('role_level')\r\n      .eq('id', user.id)\r\n      .single()\r\n\r\n    if (profileError) {\r\n      throw new Error('Could not verify user profile.')\r\n    }\r\n    \r\n    // 4. Enforce security! (Using 105 for \"Admin\" from your roles.json)\r\n    if (profile.role_level < 105) {\r\n      throw new Error('Permission denied: You are not an administrator.')\r\n    }\r\n    \r\n    // === END OF FIX ===\r\n    \r\n    // 5. Only if the check passes, create the admin client\r\n    const supabaseAdmin = createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n    )\r\n\r\n    // 6. Perform the admin action\r\n    const { error } = await supabaseAdmin.auth.admin.updateUserById(userId, {\r\n      password: newPassword,\r\n    })\r\n\r\n    if (error) {\r\n      throw error\r\n    }\r\n\r\n    return { error: null, success: true }\r\n  } catch (error: any) {\r\n    return {\r\n      error: `Failed to reset password: ${error.message}`,\r\n      success: false,\r\n    }\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;IAOsB,qBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/admin/AdminClientComponent.tsx"],"sourcesContent":["// in app/admin-client-component.tsx\r\n'use client';\r\n\r\nimport { createClient } from '@/utils/supabase/client';\r\nimport type { User } from '@supabase/supabase-js';\r\nimport React, { useState, useEffect, useActionState } from 'react'; // Changed: Added useActionState\r\nimport { useFormStatus } from 'react-dom'; // Changed: Removed useFormState\r\nimport { adminResetPassword } from './actions'; // Import the new action\r\n\r\ntype AcademicTerm = {\r\n  id: string;\r\n  term_name: string;\r\n  start_date: string;\r\n  end_date: string;\r\n};\r\n\r\n// --- Helper: Icon Components ---\r\nconst LockIcon = () => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    fill=\"none\"\r\n    viewBox=\"0 0 24 24\"\r\n    strokeWidth={1.5}\r\n    stroke=\"currentColor\"\r\n    className=\"w-12 h-12 text-gray-400\"\r\n  >\r\n    <path\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n      d=\"M16.5 10.5V6.75a4.5 4.5 0 0 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z\"\r\n    />\r\n  </svg>\r\n);\r\nconst UploadIcon = () => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    fill=\"none\"\r\n    viewBox=\"0 0 24 24\"\r\n    strokeWidth={1.5}\r\n    stroke=\"currentColor\"\r\n    className=\"w-6 h-6\"\r\n  >\r\n    <path\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n      d=\"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5\"\r\n    />\r\n  </svg>\r\n);\r\nconst TrashIcon = () => (\r\n  <svg\r\n    xmlns=\"http://www.w3.org/2000/svg\"\r\n    fill=\"none\"\r\n    viewBox=\"0 0 24 24\"\r\n    strokeWidth={1.5}\r\n    stroke=\"currentColor\"\r\n    className=\"w-5 h-5\"\r\n  >\r\n    <path\r\n      strokeLinecap=\"round\"\r\n      strokeLinejoin=\"round\"\r\n      d=\"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12.548 0A48.108 48.108 0 0 1 6.75 5.397m10.5-2.572V3.375c0-.621-.504-1.125-1.125-1.125H8.625c-.621 0-1.125.504-1.125 1.125v2.25\"\r\n    />\r\n  </svg>\r\n);\r\n\r\ntype UploadResult = {\r\n  successes: string[];\r\n  failures: { email: string; reason: string }[];\r\n};\r\n\r\n// --- Client Component ---\r\nexport function AdminSettingsClient({ user }: { user: User }) {\r\n  const supabase = createClient();\r\n  const [isVerified, setIsVerified] = useState(false);\r\n  const [password, setPassword] = useState('');\r\n  const [authError, setAuthError] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  // --- Admin Data State ---\r\n  const [terms, setTerms] = useState<AcademicTerm[]>([]);\r\n  const [dataError, setDataError] = useState<string | null>(null);\r\n  const [isLoadingData, setIsLoadingData] = useState(false);\r\n\r\n  // --- Form State ---\r\n  const [newTermName, setNewTermName] = useState('');\r\n  const [newTermStart, setNewTermStart] = useState('');\r\n  const [newTermEnd, setNewTermEnd] = useState('');\r\n\r\n  // --- Bulk Add State ---\r\n  const [csvFile, setCsvFile] = useState<File | null>(null);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [uploadResult, setUploadResult] = useState<UploadResult | null>(null);\r\n  const [uploadError, setUploadError] = useState<string | null>(null);\r\n\r\n  // 3. ADD THIS HOOK for the new form's state\r\n  // Changed: useFormState -> useActionState\r\n  const [resetState, resetFormAction] = useActionState(adminResetPassword, {\r\n    error: null,\r\n    success: false,\r\n  });\r\n\r\n  // Fetch data *after* verification\r\n  useEffect(() => {\r\n    if (isVerified) {\r\n      fetchAdminData();\r\n    }\r\n  }, [isVerified, supabase]);\r\n\r\n  async function fetchAdminData() {\r\n    setIsLoadingData(true);\r\n    setDataError(null);\r\n    const { data, error } = await supabase.rpc('get_all_academic_terms');\r\n    if (error) {\r\n      setDataError(error.message);\r\n    } else {\r\n      setTerms(data as AcademicTerm[]);\r\n    }\r\n    setIsLoadingData(false);\r\n  }\r\n\r\n  // 2. ADD THIS COMPONENT for the submit button\r\n  function ResetButton() {\r\n    const { pending } = useFormStatus();\r\n    return (\r\n      <button\r\n        type=\"submit\"\r\n        disabled={pending}\r\n        className=\"mt-2 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400\"\r\n      >\r\n        {pending ? 'Resetting...' : 'Set New Password'}\r\n      </button>\r\n    );\r\n  }\r\n\r\n  // Handle the password verification\r\n  const handleVerifyPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setIsLoading(true);\r\n    setAuthError(null);\r\n\r\n    const { error } = await supabase.auth.signInWithPassword({\r\n      email: user.email!,\r\n      password: password,\r\n    });\r\n\r\n    if (error) {\r\n      setAuthError('Incorrect password. Please try again.');\r\n    } else {\r\n      setIsVerified(true);\r\n    }\r\n    setIsLoading(false);\r\n  };\r\n\r\n  // --- Form Handlers ---\r\n  const handleCreateTerm = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newTermName || !newTermStart || !newTermEnd) {\r\n      setDataError('All fields are required.');\r\n      return;\r\n    }\r\n    setIsLoadingData(true);\r\n    const { error } = await supabase.rpc('create_academic_term', {\r\n      p_term_name: newTermName,\r\n      p_start_date: newTermStart,\r\n      p_end_date: newTermEnd,\r\n    });\r\n    if (error) {\r\n      setDataError(error.message);\r\n    } else {\r\n      setNewTermName('');\r\n      setNewTermStart('');\r\n      setNewTermEnd('');\r\n      fetchAdminData(); // Refresh list\r\n    }\r\n    setIsLoadingData(false);\r\n  };\r\n\r\n  const handleDeleteTerm = async (termId: string) => {\r\n    if (!window.confirm('Are you sure you want to delete this term?')) return;\r\n    setIsLoadingData(true);\r\n    const { error } = await supabase.rpc('delete_academic_term', {\r\n      p_term_id: termId,\r\n    });\r\n    if (error) {\r\n      setDataError(error.message);\r\n    } else {\r\n      fetchAdminData(); // Refresh list\r\n    }\r\n    setIsLoadingData(false);\r\n  };\r\n\r\n  // --- Bulk Add Handlers ---\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files && e.target.files.length > 0) {\r\n      setCsvFile(e.target.files[0]);\r\n      setUploadResult(null);\r\n      setUploadError(null);\r\n    }\r\n  };\r\n\r\n  // *** UPDATED FUNCTION WITH BETTER ERROR HANDLING ***\r\n  const handleBulkAddSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!csvFile) {\r\n      setUploadError('Please select a CSV file to upload.');\r\n      return;\r\n    }\r\n\r\n    setIsUploading(true);\r\n    setUploadError(null);\r\n    setUploadResult(null);\r\n\r\n    try {\r\n      const fileText = await csvFile.text();\r\n\r\n      const { data, error } = await supabase.functions.invoke(\r\n        'bulk-create-users',\r\n        {\r\n          body: fileText,\r\n        },\r\n      );\r\n\r\n      if (error) {\r\n        // --- START NEW ERROR HANDLING ---\r\n        // This is the new, more detailed error parsing\r\n        let detailedError = error.message;\r\n\r\n        // Functions often return error details in `error.context`\r\n        // Let's try to parse it as JSON\r\n        if (error.context) {\r\n          try {\r\n            // Deno functions often return a JSON string in the body\r\n            const errorBody = await error.context.json();\r\n            if (errorBody && errorBody.error) {\r\n              detailedError = errorBody.error;\r\n            }\r\n          } catch (parseError) {\r\n            // Not JSON, just use the generic message\r\n            console.warn('Could not parse function error context:', parseError);\r\n          }\r\n        }\r\n\r\n        throw new Error(detailedError);\r\n        // --- END NEW ERROR HANDLING ---\r\n      }\r\n\r\n      // Check for an error *within* a 200 response\r\n      if (data.error) {\r\n        throw new Error(data.error);\r\n      }\r\n\r\n      setUploadResult(data as UploadResult);\r\n    } catch (error: any) {\r\n      console.error('Full error object from function invoke:', error);\r\n      setUploadError(`Upload failed: ${error.message}`); // This will now show the detailed message\r\n    }\r\n\r\n    setIsUploading(false);\r\n  };\r\n\r\n  // --- RENDER LOGIC ---\r\n\r\n  // 1. Password Prompt\r\n  if (!isVerified) {\r\n    return (\r\n      <div className=\"flex min-h-[calc(100vh-64px)] items-center justify-center bg-gray-50 dark:bg-gray-900\">\r\n        <div className=\"w-full max-w-md space-y-8 p-8 bg-white dark:bg-gray-800 shadow-lg rounded-xl\">\r\n          <div className=\"flex flex-col items-center\">\r\n            <LockIcon />\r\n            <h2 className=\"mt-6 text-center text-2xl font-bold tracking-tight text-gray-900 dark:text-white\">\r\n              Admin Access Required\r\n            </h2>\r\n            <p className=\"mt-2 text-center text-sm text-gray-600 dark:text-gray-400\">\r\n              Please re-enter your password to manage site settings.\r\n            </p>\r\n          </div>\r\n          <form className=\"space-y-6\" onSubmit={handleVerifyPassword}>\r\n            <div>\r\n              <label\r\n                htmlFor=\"email\"\r\n                className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\"\r\n              >\r\n                Email\r\n              </label>\r\n              <input\r\n                id=\"email\"\r\n                name=\"email\"\r\n                type=\"email\"\r\n                autoComplete=\"email\"\r\n                value={user.email || ''}\r\n                disabled\r\n                className=\"mt-1 block w-full rounded-md border-gray-300 bg-gray-100 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400 shadow-sm sm:text-sm\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label\r\n                htmlFor=\"password\"\r\n                className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\"\r\n              >\r\n                Password\r\n              </label>\r\n              <input\r\n                id=\"password\"\r\n                name=\"password\"\r\n                type=\"password\"\r\n                autoComplete=\"current-password\"\r\n                required\r\n                autoFocus\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n              />\r\n            </div>\r\n\r\n            {authError && (\r\n              <p className=\"text-sm text-red-600 dark:text-red-400\">\r\n                {authError}\r\n              </p>\r\n            )}\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"flex w-full justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:bg-gray-400\"\r\n              >\r\n                {isLoading ? 'Verifying...' : 'Unlock'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // 2. Verified Admin Panel\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8\">\r\n      <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\r\n        Admin Settings\r\n      </h1>\r\n\r\n      {dataError && (\r\n        <div className=\"p-4 text-red-700 bg-red-100 dark:bg-red-900/30 dark:text-red-400 rounded-md\">\r\n          {dataError}\r\n        </div>\r\n      )}\r\n\r\n      {/* --- Academic Terms Manager --- */}\r\n      <AdminSection title=\"Manage Academic Terms\">\r\n        <form\r\n          onSubmit={handleCreateTerm}\r\n          className=\"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 bg-gray-50 dark:bg-gray-800/50 rounded-lg border dark:border-gray-700\"\r\n        >\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n              Term Name\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"e.g., Fall 2025\"\r\n              value={newTermName}\r\n              onChange={(e) => setNewTermName(e.target.value)}\r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm sm:text-sm\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n              Start Date\r\n            </label>\r\n            <input\r\n              type=\"date\"\r\n              value={newTermStart}\r\n              onChange={(e) => setNewTermStart(e.target.value)}\r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm sm:text-sm\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n              End Date\r\n            </label>\r\n            <input\r\n              type=\"date\"\r\n              value={newTermEnd}\r\n              onChange={(e) => setNewTermEnd(e.target.value)}\r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm sm:text-sm\"\r\n            />\r\n          </div>\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isLoadingData}\r\n            className=\"self-end py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400\"\r\n          >\r\n            {isLoadingData ? '...' : 'Add Term'}\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"mt-4 flow-root\">\r\n          <div className=\"overflow-x-auto border rounded-lg dark:border-gray-700\">\r\n            <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-800\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">\r\n                    Term Name\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">\r\n                    Start Date\r\n                  </th>\r\n                  <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase\">\r\n                    End Date\r\n                  </th>\r\n                  <th className=\"relative px-6 py-3\">\r\n                    <span className=\"sr-only\">Delete</span>\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white dark:bg-gray-800/50 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                {isLoadingData && (\r\n                  <tr>\r\n                    <td\r\n                      colSpan={4}\r\n                      className=\"p-4 text-center text-gray-500\"\r\n                    >\r\n                      Loading...\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n                {terms.map((term) => (\r\n                  <tr key={term.id}>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                      {term.term_name}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300\">\r\n                      {term.start_date}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300\">\r\n                      {term.end_date}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                      <button\r\n                        onClick={() => handleDeleteTerm(term.id)}\r\n                        disabled={isLoadingData}\r\n                        className=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300 disabled:text-gray-400\"\r\n                      >\r\n                        <TrashIcon />\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </AdminSection>\r\n\r\n      {/* --- Bulk User Upload --- */}\r\n      <AdminSection title=\"Bulk User Upload\">\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          Upload a CSV file with columns: `email`, `first_name`, `last_name`.\r\n          The `password` column is optional; if not provided, a secure random\r\n          password will be generated.\r\n        </p>\r\n        <form\r\n          className=\"mt-4 p-6 border dark:border-gray-700 rounded-lg\"\r\n          onSubmit={handleBulkAddSubmit}\r\n        >\r\n          <label\r\n            htmlFor=\"file-upload\"\r\n            className=\"relative flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-700/50\"\r\n          >\r\n            <div className=\"flex flex-col items-center justify-center pt-5 pb-6\">\r\n              <UploadIcon />\r\n              <p className=\"mb-2 text-sm text-gray-500 dark:text-gray-400\">\r\n                {csvFile ? (\r\n                  <span className=\"font-semibold text-green-600 dark:text-green-400\">\r\n                    {csvFile.name}\r\n                  </span>\r\n                ) : (\r\n                  <>\r\n                    <span className=\"font-semibold\">\r\n                      Click to upload a .csv file\r\n                    </span>\r\n                  </>\r\n                )}\r\n              </p>\r\n            </div>\r\n            <input\r\n              id=\"file-upload\"\r\n              name=\"file-upload\"\r\n              type=\"file\"\r\n              className=\"hidden\"\r\n              accept=\".csv\"\r\n              onChange={handleFileChange}\r\n            />\r\n          </label>\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isUploading || !csvFile}\r\n            className=\"mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none disabled:bg-gray-400\"\r\n          >\r\n            {isUploading ? 'Uploading...' : 'Upload and Create Users'}\r\n          </button>\r\n        </form>\r\n\r\n        {/* --- Upload Results --- */}\r\n        {uploadError && (\r\n          <div className=\"mt-4 p-4 text-red-700 bg-red-100 dark:bg-red-900/30 dark:text-red-400 rounded-md\">\r\n            <p className=\"font-bold\">Error</p>\r\n            <p className=\"text-sm\">{uploadError}</p>\r\n          </div>\r\n        )}\r\n        {uploadResult && (\r\n          <div className=\"mt-4 p-4 text-gray-700 bg-gray-100 dark:bg-gray-900/30 dark:text-gray-300 rounded-md\">\r\n            <p className=\"font-bold text-green-600 dark:text-green-400\">\r\n              Upload Complete\r\n            </p>\r\n            <p\r\n              className=\"text-sm\"\r\n            >{`Successfully created ${uploadResult.successes.length} users.`}</p>\r\n            {uploadResult.failures.length > 0 && (\r\n              <div className=\"mt-2\">\r\n                <p className=\"font-bold text-red-600 dark:text-red-400\">\r\n                  Failed to create {uploadResult.failures.length} users:\r\n                </p>\r\n                <ul className=\"list-disc list-inside text-sm text-red-500 dark:text-red-400\">\r\n                  {uploadResult.failures.map((fail, idx) => (\r\n                    <li key={idx}>\r\n                      <strong>{fail.email}:</strong> {fail.reason}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n            {/* --- THIS FORM WAS MOVED --- */}\r\n          </div>\r\n        )}\r\n      </AdminSection>\r\n\r\n      {/* --- NEW SECTION: Manual Password Reset --- */}\r\n      <AdminSection title=\"Manual Password Reset\">\r\n        <p className=\"text-sm text-gray-600 dark:text-gray-400\">\r\n          Manually set a new password for any user. You must know their Auth\r\n          User ID.\r\n        </p>\r\n        <form\r\n          action={resetFormAction}\r\n          className=\"mt-4 space-y-4 bg-gray-50 dark:bg-gray-800/50 p-6 rounded-lg border dark:border-gray-700\"\r\n        >\r\n          <div>\r\n            <label\r\n              htmlFor=\"userId\"\r\n              className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\"\r\n            >\r\n              User ID\r\n            </label>\r\n            <input\r\n              type=\"text\"\r\n              name=\"userId\"\r\n              id=\"userId\"\r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n              placeholder=\"Enter the user's Auth User ID\"\r\n            />\r\n          </div>\r\n          <div>\r\n            <label\r\n              htmlFor=\"newPassword\"\r\n              className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\"\r\n            >\r\n              New Password\r\n            </label>\r\n            <input\r\n              type=\"password\"\r\n              name=\"newPassword\"\r\n              id=\"newPassword\"\r\n              required\r\n              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\r\n              placeholder=\"Min. 6 characters\"\r\n            />\r\n          </div>\r\n\r\n          <ResetButton />\r\n\r\n          {resetState.error && (\r\n            <p className=\"text-sm text-red-600 dark:text-red-400\">\r\n              {resetState.error}\r\n            </p>\r\n          )}\r\n          {resetState.success && (\r\n            <p className=\"text-sm text-green-600 dark:text-green-400\">\r\n              Password reset successful!\r\n            </p>\r\n          )}\r\n        </form>\r\n      </AdminSection>\r\n    </div>\r\n  );\r\n}\r\n\r\n// --- Helper: Section Component ---\r\nfunction AdminSection({\r\n  title,\r\n  children,\r\n}: {\r\n  title: string;\r\n  children: React.ReactNode;\r\n}) {\r\n  return (\r\n    <section className=\"bg-white dark:bg-gray-800 p-6 rounded-lg shadow\">\r\n      <h2 className=\"text-2xl font-semibold text-gray-900 dark:text-white border-b dark:border-gray-700 pb-4 mb-6\">\r\n        {title}\r\n      </h2>\r\n      <div className=\"space-y-4\">{children}</div>\r\n    </section>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1033, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-dom.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactDOM\n"],"names":["module","exports","require","vendored","ReactDOM"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,QAAQ","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 1038, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0],"debugId":null}}]
}