{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/RosterClient.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState, useMemo } from 'react'\r\nimport Link from 'next/link'\r\n\r\n// --- Type Definitions ---\r\ntype RecentReport = {\r\n  id: string;\r\n  offense_name: string;\r\n  status: string;\r\n  created_at: string;\r\n  appeal_status: string | null;\r\n}\r\n\r\nexport type RosterCadet = {\r\n  id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  cadet_rank: string | null;\r\n  company_name: string | null;\r\n  role_name: string | null;\r\n  // These may be null/0 for Faculty\r\n  grade_level?: string | null;\r\n  room_number?: string | null; \r\n  term_demerits?: number;\r\n  year_demerits?: number;\r\n  current_tour_balance?: number;\r\n  has_star_tours?: boolean;\r\n  conduct_status?: string;\r\n  recent_reports?: RecentReport[] | null;\r\n  email?: string; \r\n  role_level?: number; // Added for Admin check\r\n}\r\n\r\ntype Company = { id: string; company_name: string }\r\ntype SortKey = keyof RosterCadet;\r\ntype SortDirection = 'ascending' | 'descending';\r\n\r\ntype RosterClientProps = {\r\n  initialData: RosterCadet[]\r\n  canEditProfiles: boolean\r\n  companies: Company[] \r\n  onReassign: (cadetId: string) => void\r\n  variant?: 'cadet' | 'faculty'\r\n}\r\n\r\nconst CONDUCT_ORDER = ['Exemplary', 'Commendable', 'Satisfactory', 'Deficient', 'Unsatisfactory'];\r\n\r\nexport default function RosterClient({ initialData, canEditProfiles, companies, onReassign, variant = 'cadet' }: RosterClientProps) {\r\n  const [openCadetId, setOpenCadetId] = useState<string | null>(null)\r\n\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterCompany, setFilterCompany] = useState('all');\r\n  const [filterGrade, setFilterGrade] = useState('all');\r\n  const [filterConduct, setFilterConduct] = useState('all');\r\n  const [sortConfig, setSortConfig] = useState<{ key: SortKey, direction: SortDirection }>({ \r\n    key: 'last_name', \r\n    direction: 'ascending' \r\n  });\r\n  \r\n  const handleRowClick = (cadetId: string) => {\r\n    setOpenCadetId(prevId => (prevId === cadetId ? null : cadetId))\r\n  }\r\n\r\n  const filteredAndSortedCadets = useMemo(() => {\r\n    let filteredData = [...initialData];\r\n\r\n    if (searchTerm) {\r\n      const lowerSearch = searchTerm.toLowerCase();\r\n      filteredData = filteredData.filter(item =>\r\n        item.first_name.toLowerCase().includes(lowerSearch) ||\r\n        item.last_name.toLowerCase().includes(lowerSearch) ||\r\n        (item.cadet_rank && item.cadet_rank.toLowerCase().includes(lowerSearch)) ||\r\n        (item.role_name && item.role_name.toLowerCase().includes(lowerSearch)) ||\r\n        (item.email && item.email.toLowerCase().includes(lowerSearch))\r\n      );\r\n    }\r\n\r\n    if (filterCompany !== 'all') {\r\n      filteredData = filteredData.filter(c => c.company_name === filterCompany);\r\n    }\r\n    // Only apply these filters for cadets\r\n    if (variant === 'cadet') {\r\n      if (filterGrade !== 'all') filteredData = filteredData.filter(c => c.grade_level === filterGrade);\r\n      if (filterConduct !== 'all') filteredData = filteredData.filter(c => c.conduct_status === filterConduct);\r\n    }\r\n\r\n    filteredData.sort((a, b) => {\r\n      const aValue = a[sortConfig.key];\r\n      const bValue = b[sortConfig.key];\r\n      if (aValue == null) return 1;\r\n      if (bValue == null) return -1;\r\n      return aValue < bValue \r\n        ? (sortConfig.direction === 'ascending' ? -1 : 1) \r\n        : (aValue > bValue ? (sortConfig.direction === 'ascending' ? 1 : -1) : 0);\r\n    });\r\n\r\n    return filteredData;\r\n  }, [initialData, searchTerm, filterCompany, filterGrade, filterConduct, sortConfig, variant]);\r\n\r\n  const requestSort = (key: SortKey) => {\r\n    let direction: SortDirection = 'ascending';\r\n    if (sortConfig.key === key && sortConfig.direction === 'ascending') direction = 'descending';\r\n    setSortConfig({ key, direction });\r\n  };\r\n  \r\n  const getSortIndicator = (key: SortKey) => (sortConfig.key === key ? (sortConfig.direction === 'ascending' ? ' ▲' : ' ▼') : null);\r\n\r\n  const getConductColor = (status?: string) => {\r\n      if (!status) return 'bg-gray-100 text-gray-800';\r\n      if (status === 'Exemplary') return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';\r\n      if (status === 'Commendable') return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\r\n      if (status === 'Satisfactory') return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\r\n      if (status === 'Deficient') return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200';\r\n      return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';\r\n  }\r\n\r\n  const getAppealBadge = (status: string | null) => {\r\n    if (!status) return null;\r\n    switch (status) {\r\n      case 'approved': return <span className=\"ml-2 px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\">Granted</span>;\r\n      case 'rejected_final': return <span className=\"ml-2 px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\">Denied</span>;\r\n      case 'pending_issuer':\r\n      case 'pending_chain':\r\n      case 'pending_commandant': return <span className=\"ml-2 px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">Pending</span>;\r\n      default: return null;\r\n    }\r\n  }\r\n\r\n  const getRecentReportStatus = (report: RecentReport) => {\r\n    const status = report.status;\r\n    if (status === 'pulled') return <span className=\"text-xs text-gray-500 dark:text-gray-400\">Pulled</span>\r\n    if (status === 'rejected') return <span className=\"text-xs text-red-600 dark:text-red-400\">Rejected</span>\r\n    if (status === 'completed') return <span className=\"text-xs text-green-600 dark:text-green-400\">Approved</span>\r\n    return <span className=\"text-xs text-yellow-600 dark:text-yellow-400\">{status.replace('_', ' ')}</span>\r\n  }\r\n\r\n  const formatTimeAgo = (dateStr: string) => {\r\n    const date = new Date(dateStr)\r\n    const now = new Date()\r\n    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000)\r\n    \r\n    let interval = seconds / 31536000;\r\n    if (interval > 1) return Math.floor(interval) + \"y ago\";\r\n    interval = seconds / 2592000;\r\n    if (interval > 1) return Math.floor(interval) + \"mo ago\";\r\n    interval = seconds / 86400;\r\n    if (interval > 1) return Math.floor(interval) + \"d ago\";\r\n    interval = seconds / 3600;\r\n    if (interval > 1) return Math.floor(interval) + \"h ago\";\r\n    interval = seconds / 60;\r\n    if (interval > 1) return Math.floor(interval) + \"m ago\";\r\n    return Math.floor(seconds) + \"s ago\";\r\n  }\r\n\r\n  const uniqueCompanies = useMemo(() => [...new Set(initialData.map(c => c.company_name).filter(Boolean).sort())], [initialData]);\r\n  const uniqueGrades = useMemo(() => [...new Set(initialData.map(c => c.grade_level).filter(Boolean).sort())], [initialData]);\r\n\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\r\n      \r\n      {/* Filters */}\r\n      <div className=\"p-4 grid grid-cols-1 md:grid-cols-4 gap-4 border-b border-gray-200 dark:border-gray-700 no-print\">\r\n        <input type=\"text\" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder={variant === 'cadet' ? \"Search by name, role, room...\" : \"Search by name, role, email...\"} className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white\" />\r\n        <select value={filterCompany} onChange={(e) => setFilterCompany(e.target.value)} className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white\">\r\n          <option value=\"all\">All Companies</option>\r\n          {uniqueCompanies.map(co => <option key={String(co)} value={String(co)}>{String(co)}</option>)}\r\n        </select>\r\n        \r\n        {variant === 'cadet' && (\r\n          <>\r\n            <select value={filterGrade} onChange={(e) => setFilterGrade(e.target.value)} className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white\">\r\n              <option value=\"all\">All Grades</option>\r\n              {uniqueGrades.map(g => <option key={String(g)} value={String(g)}>{String(g)}</option>)}\r\n            </select>\r\n            <select value={filterConduct} onChange={(e) => setFilterConduct(e.target.value)} className=\"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white\">\r\n              <option value=\"all\">All Conduct</option>\r\n              {CONDUCT_ORDER.map(c => <option key={c} value={c}>{c}</option>)}\r\n            </select>\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700 printable-table\">\r\n        <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n          <tr>\r\n            {variant === 'cadet' ? (\r\n                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('cadet_rank')}>Rank {getSortIndicator('cadet_rank')}</th>\r\n            ) : (\r\n                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('email')}>Email {getSortIndicator('email')}</th>\r\n            )}\r\n            \r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('last_name')}>Name {getSortIndicator('last_name')}</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('company_name')}>Company {getSortIndicator('company_name')}</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('role_name')}>Role {getSortIndicator('role_name')}</th>\r\n            \r\n            {variant === 'cadet' && (\r\n              <>\r\n                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('grade_level')}>Grade {getSortIndicator('grade_level')}</th>\r\n                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('room_number')}>Room # {getSortIndicator('room_number')}</th>\r\n                <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer\" onClick={() => requestSort('conduct_status')}>Conduct {getSortIndicator('conduct_status')}</th>\r\n              </>\r\n            )}\r\n          </tr>\r\n        </thead>\r\n        <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n          {filteredAndSortedCadets.map((person) => {\r\n            // Visual identifier for admins in Faculty view\r\n            const isAdmin = variant === 'faculty' && (person.role_level || 0) >= 90;\r\n            \r\n            return (\r\n            <React.Fragment key={person.id}>\r\n              <tr \r\n                onClick={() => handleRowClick(person.id)} \r\n                className={`\r\n                    hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors\r\n                    ${isAdmin ? 'bg-amber-50/50 dark:bg-amber-900/10 border-l-4 border-amber-400' : ''}\r\n                `}\r\n              >\r\n                {/* Column 1: Rank (Cadet) or Email (Faculty) */}\r\n                {variant === 'cadet' ? (\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200\">{person.cadet_rank || '-'}</td>\r\n                ) : (\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400 font-mono\">{person.email || '-'}</td>\r\n                )}\r\n\r\n                {/* Name Column */}\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {person.last_name}, {person.first_name}\r\n                    {isAdmin && (\r\n                        <span className=\"ml-2 inline-flex items-center px-1.5 py-0.5 rounded text-[10px] font-bold bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200 uppercase tracking-wide\">\r\n                            Admin\r\n                        </span>\r\n                    )}\r\n                </td>\r\n\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{person.company_name || '-'}</td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{person.role_name}</td>\r\n                \r\n                {variant === 'cadet' && (\r\n                  <>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{person.grade_level || '-'}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{person.room_number || '-'}</td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\"><span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${getConductColor(person.conduct_status)}`}>{person.conduct_status}</span></td>\r\n                  </>\r\n                )}\r\n              </tr>\r\n              {openCadetId === person.id && (\r\n                <tr className=\"bg-gray-50 dark:bg-gray-700/30 print-hide\">\r\n                  <td colSpan={variant === 'cadet' ? 7 : 4} className=\"px-6 py-4\">\r\n                    <div className=\"flex flex-col md:flex-row justify-between gap-6\">\r\n                      \r\n                      {/* Left Info Block */}\r\n                      <div className=\"flex-grow space-y-4\">\r\n                        <h4 className=\"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">\r\n                          {variant === 'cadet' ? 'Academic & Disciplinary' : 'Faculty Details'}\r\n                        </h4>\r\n                        {variant === 'cadet' ? (\r\n                          <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\r\n                            <div className=\"p-3 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-center\"><span className=\"block text-xs text-gray-500 uppercase\">Demerits (Term)</span><span className=\"text-lg font-bold\">{person.term_demerits}</span></div>\r\n                            <div className=\"p-3 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-center\"><span className=\"block text-xs text-gray-500 uppercase\">Demerits (Year)</span><span className=\"text-lg font-bold\">{person.year_demerits}</span></div>\r\n                            <div className=\"p-3 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-center\"><span className=\"block text-xs text-gray-500 uppercase\">Tour Balance</span><span className={`text-lg font-bold ${person.has_star_tours ? 'text-red-600' : 'text-gray-900 dark:text-white'}`}>{person.has_star_tours ? '*' : person.current_tour_balance}</span></div>\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"p-4 bg-white dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600\">\r\n                            <p className=\"text-sm text-gray-700 dark:text-gray-200\"><strong>Email:</strong> {person.email || 'No email'}</p>\r\n                            <p className=\"text-sm text-gray-700 dark:text-gray-200 mt-1\"><strong>System ID:</strong> <span className=\"font-mono text-xs text-gray-500\">{person.id}</span></p>\r\n                            {isAdmin && <p className=\"text-xs text-amber-600 dark:text-amber-400 mt-2 font-semibold\">System Administrator (Level {person.role_level})</p>}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Right Actions Block */}\r\n                      <div className=\"flex-shrink-0 md:w-48 space-y-3\">\r\n                        <h4 className=\"text-sm font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wider\">Actions</h4>\r\n                        <div className=\"flex flex-col gap-2\">\r\n                          <Link href={`/profile/${person.id}`} className=\"w-full text-center px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 text-sm font-medium rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors\">View Profile</Link>\r\n                          {variant === 'cadet' && (\r\n                            <Link href={`/ledger/${person.id}`} className=\"w-full text-center px-4 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 text-sm font-medium rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors\">View Ledger</Link>\r\n                          )}\r\n                          {canEditProfiles && (\r\n                            <button onClick={() => onReassign(person.id)} className=\"w-full text-center px-4 py-2 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-700 text-indigo-700 dark:text-indigo-300 text-sm font-medium rounded-md shadow-sm hover:bg-indigo-100 dark:hover:bg-indigo-900/40 transition-colors\">\r\n                              Re-Assign\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </React.Fragment>\r\n          );\r\n          })}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AA8CA,MAAM,gBAAgB;IAAC;IAAa;IAAe;IAAgB;IAAa;CAAiB;AAElF,SAAS,aAAa,EAAE,WAAW,EAAE,eAAe,EAAE,SAAS,EAAE,UAAU,EAAE,UAAU,OAAO,EAAqB;;IAChI,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAgB;IAE9D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAA6C;QACvF,KAAK;QACL,WAAW;IACb;IAEA,MAAM,iBAAiB,CAAC;QACtB,eAAe,CAAA,SAAW,WAAW,UAAU,OAAO;IACxD;IAEA,MAAM,0BAA0B,IAAA,wKAAO;yDAAC;YACtC,IAAI,eAAe;mBAAI;aAAY;YAEnC,IAAI,YAAY;gBACd,MAAM,cAAc,WAAW,WAAW;gBAC1C,eAAe,aAAa,MAAM;qEAAC,CAAA,OACjC,KAAK,UAAU,CAAC,WAAW,GAAG,QAAQ,CAAC,gBACvC,KAAK,SAAS,CAAC,WAAW,GAAG,QAAQ,CAAC,gBACrC,KAAK,UAAU,IAAI,KAAK,UAAU,CAAC,WAAW,GAAG,QAAQ,CAAC,gBAC1D,KAAK,SAAS,IAAI,KAAK,SAAS,CAAC,WAAW,GAAG,QAAQ,CAAC,gBACxD,KAAK,KAAK,IAAI,KAAK,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC;;YAErD;YAEA,IAAI,kBAAkB,OAAO;gBAC3B,eAAe,aAAa,MAAM;qEAAC,CAAA,IAAK,EAAE,YAAY,KAAK;;YAC7D;YACA,sCAAsC;YACtC,IAAI,YAAY,SAAS;gBACvB,IAAI,gBAAgB,OAAO,eAAe,aAAa,MAAM;qEAAC,CAAA,IAAK,EAAE,WAAW,KAAK;;gBACrF,IAAI,kBAAkB,OAAO,eAAe,aAAa,MAAM;qEAAC,CAAA,IAAK,EAAE,cAAc,KAAK;;YAC5F;YAEA,aAAa,IAAI;iEAAC,CAAC,GAAG;oBACpB,MAAM,SAAS,CAAC,CAAC,WAAW,GAAG,CAAC;oBAChC,MAAM,SAAS,CAAC,CAAC,WAAW,GAAG,CAAC;oBAChC,IAAI,UAAU,MAAM,OAAO;oBAC3B,IAAI,UAAU,MAAM,OAAO,CAAC;oBAC5B,OAAO,SAAS,SACX,WAAW,SAAS,KAAK,cAAc,CAAC,IAAI,IAC5C,SAAS,SAAU,WAAW,SAAS,KAAK,cAAc,IAAI,CAAC,IAAK;gBAC3E;;YAEA,OAAO;QACT;wDAAG;QAAC;QAAa;QAAY;QAAe;QAAa;QAAe;QAAY;KAAQ;IAE5F,MAAM,cAAc,CAAC;QACnB,IAAI,YAA2B;QAC/B,IAAI,WAAW,GAAG,KAAK,OAAO,WAAW,SAAS,KAAK,aAAa,YAAY;QAChF,cAAc;YAAE;YAAK;QAAU;IACjC;IAEA,MAAM,mBAAmB,CAAC,MAAkB,WAAW,GAAG,KAAK,MAAO,WAAW,SAAS,KAAK,cAAc,OAAO,OAAQ;IAE5H,MAAM,kBAAkB,CAAC;QACrB,IAAI,CAAC,QAAQ,OAAO;QACpB,IAAI,WAAW,aAAa,OAAO;QACnC,IAAI,WAAW,eAAe,OAAO;QACrC,IAAI,WAAW,gBAAgB,OAAO;QACtC,IAAI,WAAW,aAAa,OAAO;QACnC,OAAO;IACX;IAEA,MAAM,iBAAiB,CAAC;QACtB,IAAI,CAAC,QAAQ,OAAO;QACpB,OAAQ;YACN,KAAK;gBAAY,qBAAO,6LAAC;oBAAK,WAAU;8BAAqH;;;;;;YAC7J,KAAK;gBAAkB,qBAAO,6LAAC;oBAAK,WAAU;8BAAyG;;;;;;YACvJ,KAAK;YACL,KAAK;YACL,KAAK;gBAAsB,qBAAO,6LAAC;oBAAK,WAAU;8BAA6G;;;;;;YAC/J;gBAAS,OAAO;QAClB;IACF;IAEA,MAAM,wBAAwB,CAAC;QAC7B,MAAM,SAAS,OAAO,MAAM;QAC5B,IAAI,WAAW,UAAU,qBAAO,6LAAC;YAAK,WAAU;sBAA2C;;;;;;QAC3F,IAAI,WAAW,YAAY,qBAAO,6LAAC;YAAK,WAAU;sBAAyC;;;;;;QAC3F,IAAI,WAAW,aAAa,qBAAO,6LAAC;YAAK,WAAU;sBAA6C;;;;;;QAChG,qBAAO,6LAAC;YAAK,WAAU;sBAAgD,OAAO,OAAO,CAAC,KAAK;;;;;;IAC7F;IAEA,MAAM,gBAAgB,CAAC;QACrB,MAAM,OAAO,IAAI,KAAK;QACtB,MAAM,MAAM,IAAI;QAChB,MAAM,UAAU,KAAK,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,KAAK,OAAO,EAAE,IAAI;QAE9D,IAAI,WAAW,UAAU;QACzB,IAAI,WAAW,GAAG,OAAO,KAAK,KAAK,CAAC,YAAY;QAChD,WAAW,UAAU;QACrB,IAAI,WAAW,GAAG,OAAO,KAAK,KAAK,CAAC,YAAY;QAChD,WAAW,UAAU;QACrB,IAAI,WAAW,GAAG,OAAO,KAAK,KAAK,CAAC,YAAY;QAChD,WAAW,UAAU;QACrB,IAAI,WAAW,GAAG,OAAO,KAAK,KAAK,CAAC,YAAY;QAChD,WAAW,UAAU;QACrB,IAAI,WAAW,GAAG,OAAO,KAAK,KAAK,CAAC,YAAY;QAChD,OAAO,KAAK,KAAK,CAAC,WAAW;IAC/B;IAEA,MAAM,kBAAkB,IAAA,wKAAO;iDAAC,IAAM;mBAAI,IAAI,IAAI,YAAY,GAAG;6DAAC,CAAA,IAAK,EAAE,YAAY;4DAAE,MAAM,CAAC,SAAS,IAAI;aAAI;gDAAE;QAAC;KAAY;IAC9H,MAAM,eAAe,IAAA,wKAAO;8CAAC,IAAM;mBAAI,IAAI,IAAI,YAAY,GAAG;0DAAC,CAAA,IAAK,EAAE,WAAW;yDAAE,MAAM,CAAC,SAAS,IAAI;aAAI;6CAAE;QAAC;KAAY;IAE1H,qBACE,6LAAC;QAAI,WAAU;;0BAGb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAM,MAAK;wBAAO,OAAO;wBAAY,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;wBAAG,aAAa,YAAY,UAAU,kCAAkC;wBAAkC,WAAU;;;;;;kCACvM,6LAAC;wBAAO,OAAO;wBAAe,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;wBAAG,WAAU;;0CACzF,6LAAC;gCAAO,OAAM;0CAAM;;;;;;4BACnB,gBAAgB,GAAG,CAAC,CAAA,mBAAM,6LAAC;oCAAwB,OAAO,OAAO;8CAAM,OAAO;mCAAvC,OAAO;;;;;;;;;;;oBAGhD,YAAY,yBACX;;0CACE,6LAAC;gCAAO,OAAO;gCAAa,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gCAAG,WAAU;;kDACrF,6LAAC;wCAAO,OAAM;kDAAM;;;;;;oCACnB,aAAa,GAAG,CAAC,CAAA,kBAAK,6LAAC;4CAAuB,OAAO,OAAO;sDAAK,OAAO;2CAArC,OAAO;;;;;;;;;;;0CAE7C,6LAAC;gCAAO,OAAO;gCAAe,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;gCAAG,WAAU;;kDACzF,6LAAC;wCAAO,OAAM;kDAAM;;;;;;oCACnB,cAAc,GAAG,CAAC,CAAA,kBAAK,6LAAC;4CAAe,OAAO;sDAAI;2CAAd;;;;;;;;;;;;;;;;;;;0BAM7C,6LAAC;gBAAM,WAAU;;kCACf,6LAAC;wBAAM,WAAU;kCACf,cAAA,6LAAC;;gCACE,YAAY,wBACT,6LAAC;oCAAG,OAAM;oCAAM,WAAU;oCAAiH,SAAS,IAAM,YAAY;;wCAAe;wCAAM,iBAAiB;;;;;;yDAE5M,6LAAC;oCAAG,OAAM;oCAAM,WAAU;oCAAiH,SAAS,IAAM,YAAY;;wCAAU;wCAAO,iBAAiB;;;;;;;8CAG5M,6LAAC;oCAAG,OAAM;oCAAM,WAAU;oCAAiH,SAAS,IAAM,YAAY;;wCAAc;wCAAM,iBAAiB;;;;;;;8CAC3M,6LAAC;oCAAG,OAAM;oCAAM,WAAU;oCAAiH,SAAS,IAAM,YAAY;;wCAAiB;wCAAS,iBAAiB;;;;;;;8CACjN,6LAAC;oCAAG,OAAM;oCAAM,WAAU;oCAAiH,SAAS,IAAM,YAAY;;wCAAc;wCAAM,iBAAiB;;;;;;;gCAE1M,YAAY,yBACX;;sDACE,6LAAC;4CAAG,OAAM;4CAAM,WAAU;4CAAiH,SAAS,IAAM,YAAY;;gDAAgB;gDAAO,iBAAiB;;;;;;;sDAC9M,6LAAC;4CAAG,OAAM;4CAAM,WAAU;4CAAiH,SAAS,IAAM,YAAY;;gDAAgB;gDAAQ,iBAAiB;;;;;;;sDAC/M,6LAAC;4CAAG,OAAM;4CAAM,WAAU;4CAAiH,SAAS,IAAM,YAAY;;gDAAmB;gDAAS,iBAAiB;;;;;;;;;;;;;;;;;;;;kCAK3N,6LAAC;wBAAM,WAAU;kCACd,wBAAwB,GAAG,CAAC,CAAC;4BAC5B,+CAA+C;4BAC/C,MAAM,UAAU,YAAY,aAAa,CAAC,OAAO,UAAU,IAAI,CAAC,KAAK;4BAErE,qBACA,6LAAC,wKAAK,CAAC,QAAQ;;kDACb,6LAAC;wCACC,SAAS,IAAM,eAAe,OAAO,EAAE;wCACvC,WAAW,CAAC;;oBAER,EAAE,UAAU,oEAAoE,GAAG;gBACvF,CAAC;;4CAGA,YAAY,wBACT,6LAAC;gDAAG,WAAU;0DAAoF,OAAO,UAAU,IAAI;;;;;qEAEvH,6LAAC;gDAAG,WAAU;0DAAkF,OAAO,KAAK,IAAI;;;;;;0DAIpH,6LAAC;gDAAG,WAAU;;oDACT,OAAO,SAAS;oDAAC;oDAAG,OAAO,UAAU;oDACrC,yBACG,6LAAC;wDAAK,WAAU;kEAAsK;;;;;;;;;;;;0DAM9L,6LAAC;gDAAG,WAAU;0DAAwE,OAAO,YAAY,IAAI;;;;;;0DAC7G,6LAAC;gDAAG,WAAU;0DAAwE,OAAO,SAAS;;;;;;4CAErG,YAAY,yBACX;;kEACE,6LAAC;wDAAG,WAAU;kEAAwE,OAAO,WAAW,IAAI;;;;;;kEAC5G,6LAAC;wDAAG,WAAU;kEAAwE,OAAO,WAAW,IAAI;;;;;;kEAC5G,6LAAC;wDAAG,WAAU;kEAAsC,cAAA,6LAAC;4DAAK,WAAW,CAAC,sEAAsE,EAAE,gBAAgB,OAAO,cAAc,GAAG;sEAAG,OAAO,cAAc;;;;;;;;;;;;;;;;;;;oCAInN,gBAAgB,OAAO,EAAE,kBACxB,6LAAC;wCAAG,WAAU;kDACZ,cAAA,6LAAC;4CAAG,SAAS,YAAY,UAAU,IAAI;4CAAG,WAAU;sDAClD,cAAA,6LAAC;gDAAI,WAAU;;kEAGb,6LAAC;wDAAI,WAAU;;0EACb,6LAAC;gEAAG,WAAU;0EACX,YAAY,UAAU,4BAA4B;;;;;;4DAEpD,YAAY,wBACX,6LAAC;gEAAI,WAAU;;kFACb,6LAAC;wEAAI,WAAU;;0FAAgG,6LAAC;gFAAK,WAAU;0FAAwC;;;;;;0FAAsB,6LAAC;gFAAK,WAAU;0FAAqB,OAAO,aAAa;;;;;;;;;;;;kFACtP,6LAAC;wEAAI,WAAU;;0FAAgG,6LAAC;gFAAK,WAAU;0FAAwC;;;;;;0FAAsB,6LAAC;gFAAK,WAAU;0FAAqB,OAAO,aAAa;;;;;;;;;;;;kFACtP,6LAAC;wEAAI,WAAU;;0FAAgG,6LAAC;gFAAK,WAAU;0FAAwC;;;;;;0FAAmB,6LAAC;gFAAK,WAAW,CAAC,kBAAkB,EAAE,OAAO,cAAc,GAAG,iBAAiB,iCAAiC;0FAAG,OAAO,cAAc,GAAG,MAAM,OAAO,oBAAoB;;;;;;;;;;;;;;;;;qFAGxW,6LAAC;gEAAI,WAAU;;kFACb,6LAAC;wEAAE,WAAU;;0FAA2C,6LAAC;0FAAO;;;;;;4EAAe;4EAAE,OAAO,KAAK,IAAI;;;;;;;kFACjG,6LAAC;wEAAE,WAAU;;0FAAgD,6LAAC;0FAAO;;;;;;4EAAmB;0FAAC,6LAAC;gFAAK,WAAU;0FAAmC,OAAO,EAAE;;;;;;;;;;;;oEACpJ,yBAAW,6LAAC;wEAAE,WAAU;;4EAAgE;4EAA6B,OAAO,UAAU;4EAAC;;;;;;;;;;;;;;;;;;;kEAM9I,6LAAC;wDAAI,WAAU;;0EACb,6LAAC;gEAAG,WAAU;0EAA8E;;;;;;0EAC5F,6LAAC;gEAAI,WAAU;;kFACb,6LAAC,0KAAI;wEAAC,MAAM,CAAC,SAAS,EAAE,OAAO,EAAE,EAAE;wEAAE,WAAU;kFAAyO;;;;;;oEACvR,YAAY,yBACX,6LAAC,0KAAI;wEAAC,MAAM,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE;wEAAE,WAAU;kFAAyO;;;;;;oEAExR,iCACC,6LAAC;wEAAO,SAAS,IAAM,WAAW,OAAO,EAAE;wEAAG,WAAU;kFAAkQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;+BAtErT,OAAO,EAAE;;;;;wBAmFhC;;;;;;;;;;;;;;;;;;AAKV;GA3PwB;KAAA","debugId":null}},
    {"offset": {"line": 820, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/profile/constants.ts"],"sourcesContent":["export const CADET_RANKS = [\r\n  'c/PVT', 'c/PV2', 'c/PFC', 'c/CPL', 'c/SGT', 'c/SSG', 'c/SFC', 'c/MSG', 'c/1SG', 'c/SGM', 'c/CSM', \r\n  'c/2LT', 'c/1LT', 'c/CPT', 'c/MAJ', 'c/LTC', 'c/COL'\r\n];\r\n\r\nexport const FALL_SPORTS = [\r\n  'None', 'JV Football','Varsity Football', 'JV Soccer', 'Varsity Soccer', 'Cross Country', 'Swimming (Off Season)', 'PG Lacross', 'PG Basketball', 'PG Football', 'PT'\r\n];\r\n\r\nexport const WINTER_SPORTS = [\r\n  'None', 'JV Basketball', 'Varsity Basketball', 'Wrestling', 'Swimming', 'Indoor Track', 'PG Lacrosse', 'PG Basketball', 'PT' \r\n];\r\n\r\nexport const SPRING_SPORTS = [\r\n  'None', 'Baseball', 'Varsity Lacrosse', 'Track & Field', 'Tennis', 'Golf', 'PG Basketball', 'PG Lacrosse', \r\n];\r\n\r\nexport const CONDUCT_STATUSES = [\r\n  'Exemplary',\r\n  'Commendable',\r\n  'Satisfactory',\r\n  'Deficient',\r\n  'Unsatisfactory'\r\n];\r\n\r\nexport const PROBATION_STATUSES = [\r\n  'None',\r\n  'Academic',\r\n  'Disciplinary',\r\n  'Honor',\r\n  'Physical'\r\n];\r\n\r\nexport const GRADE_LEVELS = [\r\n  '7th', '8th', '9th', '10th', '11th', '12th', 'PG'\r\n];\r\n\r\n// Roles authorized to EDIT profiles\r\nexport const EDIT_AUTHORIZED_ROLES = [\r\n  'S1', \r\n  'Command Sergeant Major', \r\n  'TAC Officer', \r\n  'Deputy Commandant', \r\n  'Commandant', \r\n  'Admin'\r\n];\r\n\r\n// Roles authorized to manage Star Tours\r\nexport const STAR_TOUR_AUTHORIZED_ROLES = [\r\n  'Commandant', \r\n  'Deputy Commandant', \r\n  'Admin'\r\n];"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAO,MAAM,cAAc;IACzB;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAAS;IAC1F;IAAS;IAAS;IAAS;IAAS;IAAS;CAC9C;AAEM,MAAM,cAAc;IACzB;IAAQ;IAAc;IAAoB;IAAa;IAAkB;IAAiB;IAAyB;IAAc;IAAiB;IAAe;CAClK;AAEM,MAAM,gBAAgB;IAC3B;IAAQ;IAAiB;IAAsB;IAAa;IAAY;IAAgB;IAAe;IAAiB;CACzH;AAEM,MAAM,gBAAgB;IAC3B;IAAQ;IAAY;IAAoB;IAAiB;IAAU;IAAQ;IAAiB;CAC7F;AAEM,MAAM,mBAAmB;IAC9B;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,qBAAqB;IAChC;IACA;IACA;IACA;IACA;CACD;AAEM,MAAM,eAAe;IAC1B;IAAO;IAAO;IAAO;IAAQ;IAAQ;IAAQ;CAC9C;AAGM,MAAM,wBAAwB;IACnC;IACA;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,6BAA6B;IACxC;IACA;IACA;CACD","debugId":null}},
    {"offset": {"line": 936, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\n// Helper: Check if user is authorized (Staff/Admin/TAC)\r\nasync function checkPermissions(supabase: any) {\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return false\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select('role:role_id (default_role_level, role_name)')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  const level = (profile?.role as any)?.default_role_level || 0\r\n  const name = (profile?.role as any)?.role_name || ''\r\n  \r\n  // Allow Staff (50+), or specific roles like Admin/TAC\r\n  return level >= 50 || name === 'Admin' || name.includes('TAC')\r\n}\r\n\r\nexport async function updateUserRole(userId: string, roleId: string | null) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .eq('id', userId)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}\r\n\r\n// --- NEW BULK ACTIONS ---\r\n\r\nexport async function bulkAssignCompany(userIds: string[], companyId: string) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ company_id: companyId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}\r\n\r\nexport async function bulkAssignRole(userIds: string[], roleId: string) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}"],"names":[],"mappings":";;;;;;;IA2CsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 951, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\n// Helper: Check if user is authorized (Staff/Admin/TAC)\r\nasync function checkPermissions(supabase: any) {\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return false\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select('role:role_id (default_role_level, role_name)')\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  const level = (profile?.role as any)?.default_role_level || 0\r\n  const name = (profile?.role as any)?.role_name || ''\r\n  \r\n  // Allow Staff (50+), or specific roles like Admin/TAC\r\n  return level >= 50 || name === 'Admin' || name.includes('TAC')\r\n}\r\n\r\nexport async function updateUserRole(userId: string, roleId: string | null) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .eq('id', userId)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}\r\n\r\n// --- NEW BULK ACTIONS ---\r\n\r\nexport async function bulkAssignCompany(userIds: string[], companyId: string) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ company_id: companyId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}\r\n\r\nexport async function bulkAssignRole(userIds: string[], roleId: string) {\r\n  const supabase = createClient()\r\n  \r\n  if (!await checkPermissions(supabase)) {\r\n    return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  return { success: true }\r\n}"],"names":[],"mappings":";;;;;;;IA6DsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 966, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport { useState, useEffect, useCallback, useMemo } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport RosterClient, { RosterCadet } from './RosterClient' \r\nimport { EDIT_AUTHORIZED_ROLES } from '@/app/profile/constants' \r\nimport { bulkAssignCompany, bulkAssignRole } from './actions'\r\n\r\n// --- Types ---\r\ntype Company = { id: string; company_name: string }\r\ntype Role = { id: string; role_name: string; default_role_level: number; company_id: string | null }\r\n\r\ntype UnassignedUser = {\r\n  user_id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  created_at: string;\r\n  company_id: string | null;\r\n  company_name: string | null;\r\n  role_id: string | null;\r\n  role_name: string | null;\r\n}\r\n\r\n// Sort Configuration\r\ntype SortKey = 'name' | 'created_at' | 'company' | 'role'\r\ntype SortDirection = 'asc' | 'desc'\r\n\r\nexport default function ManagePage() {\r\n  const supabase = createClient()\r\n  const router = useRouter()\r\n  \r\n  // Added 'faculty' to tab state\r\n  const [activeTab, setActiveTab] = useState<'roster' | 'faculty' | 'unassigned'>('roster')\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n\r\n  // Data State\r\n  const [companies, setCompanies] = useState<Company[]>([])\r\n  const [roles, setRoles] = useState<Role[]>([])\r\n  const [unassigned, setUnassigned] = useState<UnassignedUser[]>([]) \r\n  const [rosterData, setRosterData] = useState<RosterCadet[]>([])\r\n  const [facultyData, setFacultyData] = useState<RosterCadet[]>([]) // New State\r\n  \r\n  // Permissions\r\n  const [canEditProfiles, setCanEditProfiles] = useState(false)\r\n  const [isAdmin, setIsAdmin] = useState(false) // New State for 90+ check\r\n\r\n  // Selection State\r\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set())\r\n  \r\n  // Sorting State\r\n  const [sortConfig, setSortConfig] = useState<{ key: SortKey; direction: SortDirection }>({ \r\n    key: 'created_at', \r\n    direction: 'desc' \r\n  })\r\n  \r\n  // Modal State\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n  const [targetCompanyId, setTargetCompanyId] = useState('')\r\n  const [targetRoleId, setTargetRoleId] = useState('')\r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n\r\n  // --- 1. Extract Data Fetching Logic ---\r\n  const fetchData = useCallback(async () => {\r\n    setLoading(true)\r\n    setError(null)\r\n\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser()\r\n      if (!user) {\r\n        setLoading(false)\r\n        setError(\"You must be logged in.\")\r\n        return\r\n      }\r\n\r\n      const { data: viewerProfile } = await supabase\r\n        .from('profiles')\r\n        .select('role:role_id (role_name, default_role_level)')\r\n        .eq('id', user.id)\r\n        .single()\r\n      \r\n      const roleName = (viewerProfile?.role as any)?.role_name || ''\r\n      const roleLevel = (viewerProfile?.role as any)?.default_role_level || 0\r\n      \r\n      const isSiteAdmin = roleName === 'Admin' || roleLevel >= 90;\r\n      setIsAdmin(isSiteAdmin);\r\n      setCanEditProfiles(EDIT_AUTHORIZED_ROLES.includes(roleName) || roleName.includes('TAC') || isSiteAdmin)\r\n\r\n      // Build Promise Array\r\n      const promises = [\r\n        supabase.from('companies').select('*').order('company_name'),\r\n        supabase.from('roles').select('*').order('default_role_level', { ascending: false }),\r\n        supabase.rpc('get_unassigned_users'), \r\n        supabase.rpc('get_full_roster') \r\n      ]\r\n\r\n      // Only fetch faculty if admin\r\n      if (isSiteAdmin) {\r\n        promises.push(supabase.rpc('get_faculty_roster'))\r\n      }\r\n\r\n      const results = await Promise.all(promises)\r\n      \r\n      const companiesRes = results[0]\r\n      const rolesRes = results[1]\r\n      const unassignedRes = results[2]\r\n      const fullRosterRes = results[3]\r\n      const facultyRes = isSiteAdmin ? results[4] : { data: [], error: null }\r\n\r\n      if (companiesRes.data) setCompanies(companiesRes.data)\r\n      if (rolesRes.data) setRoles(rolesRes.data)\r\n      \r\n      if (fullRosterRes.error) console.error(\"Error fetching roster:\", fullRosterRes.error.message)\r\n      else setRosterData(fullRosterRes.data as RosterCadet[])\r\n\r\n      if (unassignedRes.error) console.error(\"Error fetching unassigned:\", unassignedRes.error.message)\r\n      else setUnassigned(unassignedRes.data as UnassignedUser[])\r\n\r\n      if (facultyRes.error) console.error(\"Error fetching faculty:\", facultyRes.error.message)\r\n      else setFacultyData(facultyRes.data as RosterCadet[])\r\n\r\n    } catch (err: any) {\r\n      setError(err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [supabase])\r\n\r\n  useEffect(() => {\r\n    fetchData()\r\n  }, [fetchData])\r\n\r\n  // --- Sorting Logic ---\r\n  const sortedUnassigned = useMemo(() => {\r\n    const sorted = [...unassigned]\r\n    sorted.sort((a, b) => {\r\n      let valA: any = ''\r\n      let valB: any = ''\r\n\r\n      switch (sortConfig.key) {\r\n        case 'name': valA = `${a.last_name}, ${a.first_name}`; valB = `${b.last_name}, ${b.first_name}`; break;\r\n        case 'created_at': valA = new Date(a.created_at).getTime(); valB = new Date(b.created_at).getTime(); break;\r\n        case 'company': valA = a.company_name || ''; valB = b.company_name || ''; break;\r\n        case 'role': valA = a.role_name || ''; valB = b.role_name || ''; break;\r\n      }\r\n\r\n      if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1\r\n      if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1\r\n      return 0\r\n    })\r\n    return sorted\r\n  }, [unassigned, sortConfig])\r\n\r\n  const handleSort = (key: SortKey) => {\r\n    setSortConfig(current => ({\r\n      key,\r\n      direction: current.key === key && current.direction === 'asc' ? 'desc' : 'asc'\r\n    }))\r\n  }\r\n\r\n  const SortIcon = ({ column }: { column: SortKey }) => {\r\n    if (sortConfig.key !== column) return <span className=\"text-gray-300 ml-1\">⇅</span>\r\n    return <span className=\"text-indigo-600 dark:text-indigo-400 ml-1\">{sortConfig.direction === 'asc' ? '↑' : '↓'}</span>\r\n  }\r\n\r\n  // --- Handlers ---\r\n\r\n  const handlePrintRoster = () => window.print()\r\n\r\n  const handleSelectRow = (id: string) => {\r\n    const newSet = new Set(selectedIds)\r\n    if (newSet.has(id)) newSet.delete(id); else newSet.add(id);\r\n    setSelectedIds(newSet)\r\n  }\r\n\r\n  const handleSelectAll = () => {\r\n    if (selectedIds.size === unassigned.length) {\r\n      setSelectedIds(new Set())\r\n    } else {\r\n      setSelectedIds(new Set(unassigned.map(u => u.user_id)))\r\n    }\r\n  }\r\n\r\n  const handleReassign = (cadetId: string) => {\r\n    setSelectedIds(new Set([cadetId]))\r\n    openModal()\r\n  }\r\n\r\n  const openModal = () => {\r\n    setTargetCompanyId('')\r\n    setTargetRoleId('')\r\n    setModalOpen(true)\r\n  }\r\n\r\n  const availableRoles = useMemo(() => {\r\n    if (!targetCompanyId) return roles;\r\n    return roles.filter(r => r.company_id === targetCompanyId || r.company_id === null)\r\n  }, [roles, targetCompanyId])\r\n\r\n  const handleRoleChange = (newRoleId: string) => {\r\n    setTargetRoleId(newRoleId);\r\n    if (!newRoleId) return;\r\n    const selectedRole = roles.find(r => r.id === newRoleId);\r\n    if (selectedRole && selectedRole.company_id) {\r\n      setTargetCompanyId(selectedRole.company_id);\r\n    }\r\n  }\r\n\r\n  const handleSubmitAssignment = async () => {\r\n    if (!targetCompanyId && !targetRoleId) {\r\n      alert(\"Please select at least a Company OR a Role to assign.\")\r\n      return\r\n    }\r\n    if (selectedIds.size === 0) return\r\n\r\n    setIsSubmitting(true)\r\n    const idsToUpdate = Array.from(selectedIds)\r\n    \r\n    const promises = []\r\n    if (targetCompanyId) promises.push(bulkAssignCompany(idsToUpdate, targetCompanyId))\r\n    if (targetRoleId) promises.push(bulkAssignRole(idsToUpdate, targetRoleId))\r\n\r\n    const results = await Promise.all(promises)\r\n    const errors = results.filter(r => r.error).map(r => r.error)\r\n\r\n    if (errors.length > 0) {\r\n      alert(`One or more errors occurred:\\n${errors.join('\\n')}`)\r\n    } else {\r\n      setSelectedIds(new Set())\r\n      setModalOpen(false)\r\n      await fetchData() \r\n    }\r\n    setIsSubmitting(false)\r\n  }\r\n\r\n  if (loading && unassigned.length === 0 && rosterData.length === 0) {\r\n    return <div className=\"max-w-7xl mx-auto p-8 text-center text-gray-500\">Loading roster data...</div>\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <style jsx global>{`\r\n        @media print {\r\n          body { background-color: white !important; color: black !important; }\r\n          header, .no-print, div[aria-label=\"Tabs\"] { display: none !important; }\r\n          #printable-roster { display: block !important; visibility: visible !important; }\r\n          body > div, body > main { display: block !important; visibility: visible !important; }\r\n        }\r\n      `}</style>\r\n    \r\n      <div className=\"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8\">\r\n        \r\n        <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 no-print\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Roster Management</h1>\r\n            <p className=\"text-gray-500 dark:text-gray-400 mt-1\">Assign cadets to roles.</p>\r\n          </div>\r\n\r\n          <Link href=\"/manage/roles\" className=\"flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors font-medium shadow-sm\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\r\n            </svg>\r\n            Configure Chain of Command\r\n          </Link>\r\n        </div>\r\n        \r\n        <div className=\"mb-6 border-b border-gray-200 dark:border-gray-700 no-print\">\r\n          <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n            <button onClick={() => setActiveTab('roster')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'roster' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'}`}>\r\n              Cadet Roster\r\n            </button>\r\n            \r\n            {/* ADMIN ONLY TAB */}\r\n            {isAdmin && (\r\n              <button onClick={() => setActiveTab('faculty')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'faculty' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'}`}>\r\n                Faculty & Staff\r\n              </button>\r\n            )}\r\n\r\n            <button onClick={() => setActiveTab('unassigned')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${activeTab === 'unassigned' ? 'border-indigo-500 text-indigo-600 dark:text-indigo-400' : 'border-transparent text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300'}`}>\r\n              Unassigned \r\n              <span className=\"ml-1.5 inline-block py-0.5 px-2 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200\">{unassigned.length}</span>\r\n            </button>\r\n          </nav>\r\n        </div>\r\n        \r\n        {error && <div className=\"mb-6 p-4 text-center text-red-600 bg-red-50 rounded-lg border border-red-200\">Error: {error}</div>}\r\n\r\n        {/* --- TAB 1: ROSTER --- */}\r\n        <div id=\"printable-roster\" className={activeTab === 'roster' ? '' : 'hidden'}>\r\n          <div className=\"flex justify-end mb-4 no-print\">\r\n            <button onClick={handlePrintRoster} className=\"text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 underline\">Print Roster</button>\r\n          </div>\r\n          <RosterClient initialData={rosterData} canEditProfiles={canEditProfiles} companies={companies} onReassign={handleReassign} variant=\"cadet\" />\r\n        </div>\r\n\r\n        {/* --- TAB 2: FACULTY (ADMIN ONLY) --- */}\r\n        {isAdmin && (\r\n          <div className={activeTab === 'faculty' ? '' : 'hidden'}>\r\n             <div className=\"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md\">\r\n                <p className=\"text-sm text-blue-800 dark:text-blue-200\">\r\n                  <strong>Restricted View:</strong> You are viewing the Faculty & Staff roster. This data is only visible to role level 90+.\r\n                </p>\r\n             </div>\r\n             <RosterClient initialData={facultyData} canEditProfiles={canEditProfiles} companies={companies} onReassign={handleReassign} variant=\"faculty\" />\r\n          </div>\r\n        )}\r\n\r\n        {/* --- TAB 3: UNASSIGNED --- */}\r\n        <div className={`no-print ${activeTab === 'unassigned' ? '' : 'hidden'}`}>\r\n          <div className=\"bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\r\n            <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4 bg-gray-50 dark:bg-gray-900/50\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <input type=\"checkbox\" className=\"rounded border-gray-300 dark:border-gray-600\" checked={unassigned.length > 0 && selectedIds.size === unassigned.length} onChange={handleSelectAll} />\r\n                <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">{selectedIds.size} selected</span>\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <button onClick={openModal} disabled={selectedIds.size === 0} className=\"px-4 py-2 bg-indigo-600 text-white rounded-md text-sm font-medium hover:bg-indigo-700 disabled:opacity-50 shadow-sm flex items-center gap-2\"><span>Assign Selected...</span></button>\r\n              </div>\r\n            </div>\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n                <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n                  <tr>\r\n                    <th scope=\"col\" className=\"w-12 px-6 py-3\"></th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600\" onClick={() => handleSort('name')}>Name <SortIcon column=\"name\"/></th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600\" onClick={() => handleSort('created_at')}>Date Joined <SortIcon column=\"created_at\"/></th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600\" onClick={() => handleSort('company')}>Company <SortIcon column=\"company\"/></th>\r\n                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600\" onClick={() => handleSort('role')}>Role <SortIcon column=\"role\"/></th>\r\n                    <th scope=\"col\" className=\"px-6 py-3\"><span className=\"sr-only\">Action</span></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n                  {sortedUnassigned.length > 0 ? sortedUnassigned.map(u => (\r\n                    <tr key={u.user_id} onClick={() => router.push(`/profile/${u.user_id}`)} className=\"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer\">\r\n                      <td className=\"px-6 py-4 whitespace-nowrap\" onClick={(e) => e.stopPropagation()}>\r\n                        <input type=\"checkbox\" className=\"rounded border-gray-300 dark:border-gray-600 h-4 w-4 text-indigo-600\" checked={selectedIds.has(u.user_id)} onChange={() => handleSelectRow(u.user_id)} onClick={(e) => e.stopPropagation()} />\r\n                      </td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">{u.last_name}, {u.first_name}</td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">{new Date(u.created_at).toLocaleDateString()}</td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{u.company_name ? <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\">{u.company_name}</span> : <span className=\"text-red-500 dark:text-red-400 text-xs italic\">Unassigned</span>}</td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{u.role_name ? <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\">{u.role_name}</span> : <span className=\"text-red-500 dark:text-red-400 text-xs italic\">Unassigned</span>}</td>\r\n                      <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\"><button onClick={(e) => { e.stopPropagation(); setSelectedIds(new Set([u.user_id])); openModal() }} className=\"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200\">Edit</button></td>\r\n                    </tr>\r\n                  )) : <tr><td colSpan={6} className=\"px-6 py-10 text-center text-sm text-gray-500 dark:text-gray-400\">No unassigned profiles found.</td></tr>}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {/* --- ASSIGNMENT MODAL --- */}\r\n      {modalOpen && (\r\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n            <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" onClick={() => setModalOpen(false)}></div>\r\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n            <div className=\"relative inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full\">\r\n              <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                <div className=\"sm:flex sm:items-start mb-4\">\r\n                  <div className=\"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left\">\r\n                    <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white\" id=\"modal-title\">Bulk Assignment</h3>\r\n                    <div className=\"mt-2\"><p className=\"text-sm text-gray-500 dark:text-gray-400\">Assigning {selectedIds.size} users. Leave a field blank to keep it unchanged.</p></div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"space-y-4 px-4 sm:px-0\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Company</label>\r\n                    <select value={targetCompanyId} onChange={(e) => setTargetCompanyId(e.target.value)} className=\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\">\r\n                      <option value=\"\">-- No Change --</option>\r\n                      {companies.map(c => <option key={c.id} value={c.id}>{c.company_name}</option>)}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Role</label>\r\n                    <select value={targetRoleId} onChange={(e) => handleRoleChange(e.target.value)} className=\"block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md\">\r\n                      <option value=\"\">-- No Change --</option>\r\n                      {availableRoles.map(r => <option key={r.id} value={r.id}>{r.role_name} (Lvl {r.default_role_level})</option>)}\r\n                    </select>\r\n                    {targetCompanyId && <p className=\"mt-1 text-xs text-gray-500\">Showing only roles available for this company (and global roles).</p>}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-gray-50 dark:bg-gray-700/30 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\r\n                <button type=\"button\" disabled={isSubmitting} onClick={handleSubmitAssignment} className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50\">{isSubmitting ? 'Saving...' : 'Save Assignments'}</button>\r\n                <button type=\"button\" onClick={() => setModalOpen(false)} className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\">Cancel</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}