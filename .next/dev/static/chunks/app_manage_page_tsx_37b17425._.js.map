{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/page.tsx"],"sourcesContent":["// in app/manage/page.tsx\r\n'use client'\r\n\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport { useState, useEffect, useMemo } from 'react'\r\nimport Link from 'next/link'\r\n\r\n// --- Data Types ---\r\ntype Company = { id: string; company_name: string }\r\ntype Group = { id: string, group_name: string }\r\ntype SimpleRole = { id: string; role_name: string; default_role_level: number }\r\ntype Role = {\r\n  role_id: string;\r\n  role_name: string;\r\n  company_id: string | null;\r\n  company_name: string | null;\r\n  approval_group_id: string | null;\r\n  approval_group_name: string | null;\r\n  default_role_level: number;\r\n  can_manage_own_company_roster: boolean;\r\n  can_manage_all_rosters: boolean;\r\n}\r\ntype RosterUser = {\r\n  user_id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  role_id: string | null;\r\n  role_name: string | null;\r\n  role_level: number;\r\n}\r\ntype UnassignedUser = {\r\n  user_id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  role_level: number;\r\n}\r\ntype SearchUser = {\r\n  user_id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  company_name: string | null;\r\n  role_name: string | null;\r\n  role_level: number;\r\n}\r\ntype Permissions = { can_manage_own: boolean; can_manage_all: boolean }\r\ntype CompanyData = { roster: RosterUser[]; roles: SimpleRole[] }\r\ntype View = 'company' | 'unassigned' | 'search' | 'roles'\r\n// Removed 'setLevel'\r\ntype ModalMode = 'assignCompany' | 'assignRole' | 'deleteUser' | 'createRole' | 'editRole' | 'deleteRole'\r\ntype ModalUser = RosterUser | UnassignedUser | SearchUser\r\n\r\n// --- Helper: Tab Button Component ---\r\nfunction TabButton({ text, active, onClick }: { text: string, active: boolean, onClick: () => void }) {\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className={`-mb-px border-b-2 px-4 py-3 text-sm font-medium ${\r\n        active\r\n          ? 'border-indigo-600 text-indigo-600 dark:text-indigo-400 dark:border-indigo-400'\r\n          : 'border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300'\r\n      }`}\r\n    >\r\n      {text}\r\n    </button>\r\n  )\r\n}\r\n\r\n// --- Main Page Component ---\r\nexport default function ManageRosterPage() {\r\n  const supabase = createClient()\r\n  \r\n  // --- State ---\r\n  const [permissions, setPermissions] = useState<Permissions | null>(null)\r\n  const [myLevel, setMyLevel] = useState<number>(0)\r\n  const [view, setView] = useState<View>('company')\r\n  \r\n  const [manageableCompanies, setManageableCompanies] = useState<Company[]>([])\r\n  const [allCompanies, setAllCompanies] = useState<Company[]>([])\r\n  const [allGroups, setAllGroups] = useState<Group[]>([])\r\n  const [allRoles, setAllRoles] = useState<Role[]>([])\r\n  \r\n  const [selectedCompanyId, setSelectedCompanyId] = useState<string>('')\r\n  const [companyRoster, setCompanyRoster] = useState<RosterUser[]>([])\r\n  const [companyRoles, setCompanyRoles] = useState<SimpleRole[]>([])\r\n  \r\n  const [unassignedList, setUnassignedList] = useState<UnassignedUser[]>([])\r\n  \r\n  const [allProfiles, setAllProfiles] = useState<SearchUser[]>([])\r\n  const [profileFilter, setProfileFilter] = useState('')\r\n  const [roleFilter, setRoleFilter] = useState('')\r\n  \r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  \r\n  // Modal State\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n  const [modalMode, setModalMode] = useState<ModalMode>('assignRole')\r\n  const [modalUser, setModalUser] = useState<ModalUser | null>(null)\r\n  const [modalRole, setModalRole] = useState<Role | null>(null)\r\n  const [isSaving, setIsSaving] = useState(false)\r\n  \r\n  // Modal Form State\r\n  const [newCompanyId, setNewCompanyId] = useState('')\r\n  const [newRoleId, setNewRoleId] = useState('')\r\n  const [roleFormData, setRoleFormData] = useState<Partial<Role>>({})\r\n\r\n  // --- Data Fetching ---\r\n  useEffect(() => {\r\n    type ManageableCompany = { company_id: string, company_name: string }\r\n\r\n    async function getInitialData() {\r\n      setLoading(true)\r\n      \r\n      // 1. Get permissions AND my role level\r\n      const [permsRes, levelRes] = await Promise.all([\r\n        supabase.rpc('get_my_manage_permissions').single<Permissions>(),\r\n        supabase.rpc('get_my_role_level')\r\n      ])\r\n      \r\n      if (permsRes.error) return setError(permsRes.error.message)\r\n      setPermissions(permsRes.data)\r\n\r\n      if (levelRes.data) setMyLevel(levelRes.data as number)\r\n\r\n      // 2. Get companies I can manage\r\n      const { data: companiesData, error: companiesError } = await supabase.rpc('get_manageable_companies')\r\n      if (companiesError) return setError(companiesError.message)\r\n\r\n      if (companiesData && companiesData.length > 0) {\r\n        const mappedCompanies = companiesData.map((c: ManageableCompany) => ({ id: c.company_id, company_name: c.company_name }))\r\n        setManageableCompanies(mappedCompanies)\r\n        setSelectedCompanyId(companiesData[0].company_id)\r\n      }\r\n\r\n      // 3. If global admin, fetch everything and set default view to 'search'\r\n      if (permsRes.data.can_manage_all) {\r\n        setView('search')\r\n        const [unassignedRes, allCompanyRes, allRolesRes, allProfilesRes] = await Promise.all([\r\n          supabase.rpc('get_unassigned_roster'),\r\n          supabase.rpc('get_all_companies_and_groups_for_admin'),\r\n          supabase.rpc('get_all_roles_for_admin'),\r\n          supabase.rpc('get_all_searchable_profiles')\r\n        ])\r\n\r\n        if (unassignedRes.error) return setError(unassignedRes.error.message)\r\n        setUnassignedList(unassignedRes.data as UnassignedUser[])\r\n\r\n        if (allCompanyRes.error) return setError(allCompanyRes.error.message)\r\n        setAllCompanies((allCompanyRes.data as any).companies)\r\n        setAllGroups((allCompanyRes.data as any).approval_groups)\r\n\r\n        if (allRolesRes.error) return setError(allRolesRes.error.message)\r\n        setAllRoles(allRolesRes.data as Role[])\r\n        \r\n        if (allProfilesRes.error) return setError(allProfilesRes.error.message)\r\n        setAllProfiles(allProfilesRes.data as SearchUser[])\r\n      }\r\n    }\r\n    getInitialData().finally(() => setLoading(false))\r\n  }, [supabase])\r\n\r\n  // Get roster when company changes\r\n  useEffect(() => {\r\n    if (view !== 'company' || !selectedCompanyId) return\r\n    async function getRoster() {\r\n      setLoading(true)\r\n      setError(null)\r\n      const { data, error } = await supabase.rpc('get_roster_for_company', { p_company_id: selectedCompanyId })\r\n      if (error) setError(error.message)\r\n      else {\r\n        const companyData = data as CompanyData\r\n        setCompanyRoster(companyData.roster || [])\r\n        setCompanyRoles(companyData.roles || [])\r\n      }\r\n      setLoading(false)\r\n    }\r\n    getRoster()\r\n  }, [selectedCompanyId, view, supabase])\r\n\r\n  // Client-side filters\r\n  const filteredProfiles = useMemo(() => {\r\n    if (!profileFilter) return allProfiles\r\n    return allProfiles.filter(profile => \r\n      `${profile.first_name} ${profile.last_name}`.toLowerCase().includes(profileFilter.toLowerCase())\r\n    )\r\n  }, [allProfiles, profileFilter])\r\n\r\n  const filteredRoles = useMemo(() => {\r\n    if (!roleFilter) return allRoles\r\n    return allRoles.filter(role => \r\n      role.role_name.toLowerCase().includes(roleFilter.toLowerCase()) ||\r\n      role.company_name?.toLowerCase().includes(roleFilter.toLowerCase())\r\n    )\r\n  }, [allRoles, roleFilter])\r\n\r\n  \r\n  // --- Modal Control ---\r\n  function closeModal() {\r\n    setModalOpen(false)\r\n    setModalUser(null)\r\n    setModalRole(null)\r\n    setIsSaving(false)\r\n    setError(null)\r\n  }\r\n\r\n  function openUserModal(user: ModalUser, mode: 'assignCompany' | 'assignRole' | 'deleteUser') {\r\n    setModalRole(null) // *** FIX: Ensure role state is clear ***\r\n    setModalUser(user)\r\n    setModalMode(mode)\r\n    if (mode === 'assignCompany') setNewCompanyId('')\r\n    if (mode === 'assignRole' && 'role_id' in user) setNewRoleId(user.role_id || '')\r\n    setModalOpen(true)\r\n  }\r\n\r\n  function openRoleModal(mode: 'createRole' | 'editRole' | 'deleteRole', role: Role | null = null) {\r\n    setModalUser(null) // *** FIX: Ensure user state is clear ***\r\n    setModalRole(role)\r\n    setModalMode(mode)\r\n    if (mode === 'createRole') {\r\n      setRoleFormData({\r\n        role_name: '', company_id: '', approval_group_id: '',\r\n        default_role_level: 10, can_manage_own_company_roster: false, can_manage_all_rosters: false,\r\n      })\r\n    } else if (role) {\r\n      setRoleFormData(role)\r\n    }\r\n    setModalOpen(true)\r\n  }\r\n  \r\n  function handleRoleFormChange(e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) {\r\n    const { name, value, type } = e.target\r\n    if (type === 'checkbox') {\r\n      const { checked } = e.target as HTMLInputElement\r\n      setRoleFormData(prev => ({ ...prev, [name]: checked }))\r\n    } else {\r\n      setRoleFormData(prev => ({ ...prev, [name]: value }))\r\n    }\r\n  }\r\n\r\n  // --- Save Handlers ---\r\n  async function onSave() {\r\n    setIsSaving(true)\r\n    setError(null)\r\n    let rpcError = null\r\n\r\n    try {\r\n      if (modalUser) {\r\n        if (modalMode === 'assignCompany') {\r\n          const { error } = await supabase.rpc('assign_user_company', { p_user_id: modalUser.user_id, p_new_company_id: newCompanyId || null })\r\n          rpcError = error\r\n          const { data } = await supabase.rpc('get_unassigned_roster')\r\n          setUnassignedList(data as UnassignedUser[])\r\n\r\n        } else if (modalMode === 'assignRole') {\r\n          const { error } = await supabase.rpc('update_user_role', { p_user_id: modalUser.user_id, p_new_role_id: newRoleId })\r\n          rpcError = error\r\n        } else if (modalMode === 'deleteUser') {\r\n          const { error } = await supabase.rpc('delete_user_by_id', { p_user_id: modalUser.user_id })\r\n          rpcError = error\r\n          setUnassignedList(unassignedList.filter(u => u.user_id !== modalUser.user_id))\r\n          setCompanyRoster(companyRoster.filter(u => u.user_id !== modalUser.user_id))\r\n          setAllProfiles(allProfiles.filter(u => u.user_id !== modalUser.user_id))\r\n        }\r\n      } \r\n      else if (modalRole || modalMode === 'createRole') {\r\n         if (modalMode === 'createRole') {\r\n           const { error } = await supabase.rpc('create_role', {\r\n             p_role_name: roleFormData.role_name, p_company_id: roleFormData.company_id || null, p_approval_group_id: roleFormData.approval_group_id || null,\r\n             p_default_role_level: roleFormData.default_role_level, p_can_manage_own: roleFormData.can_manage_own_company_roster, p_can_manage_all: roleFormData.can_manage_all_rosters\r\n           })\r\n           rpcError = error\r\n         } else if (modalMode === 'editRole') {\r\n           const { error } = await supabase.rpc('update_role', {\r\n             p_role_id: roleFormData.role_id, p_role_name: roleFormData.role_name, p_company_id: roleFormData.company_id || null,\r\n             p_approval_group_id: roleFormData.approval_group_id || null, p_default_role_level: roleFormData.default_role_level,\r\n             p_can_manage_own: roleFormData.can_manage_own_company_roster, p_can_manage_all: roleFormData.can_manage_all_rosters\r\n           })\r\n           rpcError = error\r\n         } else if (modalMode === 'deleteRole' && modalRole) {\r\n           const { error } = await supabase.rpc('delete_role', { p_role_id: modalRole.role_id })\r\n           rpcError = error\r\n         }\r\n      }\r\n\r\n      if (rpcError) throw rpcError\r\n      \r\n      // Refresh data\r\n      if (view === 'company' && selectedCompanyId) {\r\n          const { data } = await supabase.rpc('get_roster_for_company', { p_company_id: selectedCompanyId })\r\n          const companyData = data as CompanyData\r\n          setCompanyRoster(companyData.roster || [])\r\n      }\r\n      if (permissions?.can_manage_all) {\r\n          if (view === 'search') {\r\n             const { data } = await supabase.rpc('get_all_searchable_profiles')\r\n             setAllProfiles(data as SearchUser[])\r\n          }\r\n          if (view === 'roles' || ['createRole', 'editRole', 'deleteRole'].includes(modalMode)) {\r\n            const { data } = await supabase.rpc('get_all_roles_for_admin')\r\n            setAllRoles(data as Role[])\r\n          }\r\n      }\r\n\r\n      closeModal()\r\n    } catch (err: any) {\r\n      setError(err.message || 'An unknown error occurred.')\r\n      setIsSaving(false)\r\n    }\r\n  }\r\n\r\n  // --- Render ---\r\n  if (loading) return <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Loading...</div>\r\n  if (error && !isSaving) return <div className=\"p-8 text-center text-red-600 dark:text-red-400\">{error}</div>\r\n  if (!permissions) return <div className=\"p-8 text-center dark:text-gray-400\">Loading permissions...</div>\r\n\r\n  return (\r\n    <>\r\n      <div className=\"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Roster Management</h1>\r\n        \r\n        <div className=\"mt-4 border-b border-gray-200 dark:border-gray-700\">\r\n          <nav className=\"flex -mb-px space-x-6\" aria-label=\"Tabs\">\r\n            {permissions.can_manage_all && <TabButton text=\"Search All\" active={view === 'search'} onClick={() => setView('search')} />}\r\n            <TabButton text=\"Company Rosters\" active={view === 'company'} onClick={() => setView('company')} />\r\n            {permissions.can_manage_all && (\r\n               <>\r\n                 <TabButton text=\"Unassigned\" active={view === 'unassigned'} onClick={() => setView('unassigned')} />\r\n                 <TabButton text=\"Manage Roles\" active={view === 'roles'} onClick={() => setView('roles')} />\r\n               </>\r\n            )}\r\n          </nav>\r\n        </div>\r\n\r\n        <div className=\"mt-6\">\r\n          {error && isSaving && <div className=\"p-4 mb-4 text-red-700 bg-red-100 dark:bg-red-900/30 dark:text-red-400 rounded-md\">{error}</div>}\r\n\r\n          {/* --- View: Search All --- */}\r\n          {view === 'search' && (\r\n            <div>\r\n              <input type=\"text\" placeholder=\"Search by first or last name...\" value={profileFilter} onChange={e => setProfileFilter(e.target.value)} className=\"block w-full max-w-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\" />\r\n              <RosterTable loading={loading}>\r\n                {filteredProfiles.map(user => (\r\n                  <tr key={user.user_id}>\r\n                    <td className=\"py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-gray-100 sm:pl-6\">{user.last_name}, {user.first_name}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{user.company_name || <span className=\"text-red-500 italic\">Unassigned</span>}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{user.role_name || 'N/A'}</td>\r\n                    <td className=\"py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-4\">\r\n                      <Link href={`/ledger/${user.user_id}`} className=\"text-blue-600 dark:text-blue-400 hover:text-blue-900 dark:hover:text-blue-300 mr-4\">Ledger</Link>\r\n                      <button onClick={() => openUserModal(user, 'assignCompany')} className=\"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300\">Assign Company...</button>\r\n                      <button onClick={() => openUserModal(user, 'deleteUser')} className=\"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300\">Delete</button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </RosterTable>\r\n            </div>\r\n          )}\r\n\r\n          {/* --- View: Company Roster --- */}\r\n          {view === 'company' && (\r\n            <div>\r\n              <label htmlFor=\"company\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Select Company</label>\r\n              <select id=\"company\" value={selectedCompanyId} onChange={e => setSelectedCompanyId(e.target.value)} className=\"mt-1 block w-full max-w-xs rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm\" disabled={manageableCompanies.length === 0}>\r\n                {manageableCompanies.map(c => (<option key={c.id} value={c.id}>{c.company_name}</option>))}\r\n              </select>\r\n              <RosterTable loading={loading}>\r\n                {companyRoster.map(user => (\r\n                  <tr key={user.user_id}>\r\n                    <td className=\"py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-gray-100 sm:pl-6\">{user.last_name}, {user.first_name}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{user.role_name || <span className=\"text-red-500 italic\">Unassigned Role</span>}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{user.role_level}</td>\r\n                    <td className=\"py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-4\">\r\n                      {user.role_level < myLevel && (\r\n                         <>\r\n                           <button onClick={() => openUserModal(user, 'assignRole')} className=\"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300\">Assign Role</button>\r\n                           {permissions?.can_manage_all && <button onClick={() => openUserModal(user, 'deleteUser')} className=\"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300\">Delete</button>}\r\n                         </>\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </RosterTable>\r\n            </div>\r\n          )}\r\n\r\n          {/* --- View: Unassigned Roster --- */}\r\n          {view === 'unassigned' && (\r\n            <div>\r\n              <h2 className=\"text-2xl font-semibold text-gray-800 dark:text-gray-200\">Unassigned Personnel</h2>\r\n              <RosterTable loading={loading}>\r\n                {unassignedList.map(user => (\r\n                  <tr key={user.user_id}>\r\n                    <td className=\"py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-gray-100 sm:pl-6\">{user.last_name}, {user.first_name}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 italic dark:text-gray-400\">Unassigned</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 italic dark:text-gray-400\">N/A</td>\r\n                    <td className=\"py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-4\">\r\n                      <button onClick={() => openUserModal(user, 'assignCompany')} className=\"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300\">Assign Company...</button>\r\n                      <button onClick={() => openUserModal(user, 'deleteUser')} className=\"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300\">Delete</button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </RosterTable>\r\n            </div>\r\n          )}\r\n\r\n          {/* --- View: Manage Roles --- */}\r\n          {view === 'roles' && (\r\n            <div>\r\n              <div className=\"flex justify-between items-center\">\r\n                <h2 className=\"text-2xl font-semibold text-gray-800 dark:text-white\">Manage Roles</h2>\r\n                <button onClick={() => openRoleModal('createRole')} className=\"py-2 px-4 rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700\">Create New Role</button>\r\n              </div>\r\n              <input type=\"text\" placeholder=\"Search by role or company...\" value={roleFilter} onChange={e => setRoleFilter(e.target.value)} className=\"mt-4 block w-full max-w-sm rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm sm:text-sm\" />\r\n              <RoleTable loading={loading}>\r\n                {filteredRoles.map(role => (\r\n                  <tr key={role.role_id}>\r\n                    <td className=\"py-4 pl-4 pr-3 text-sm font-medium text-gray-900 dark:text-gray-100 sm:pl-6\">{role.role_name}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{role.company_name || 'N/A'}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{role.approval_group_name || 'N/A'}</td>\r\n                    <td className=\"px-3 py-4 text-sm text-gray-500 dark:text-gray-400\">{role.default_role_level}</td>\r\n                    <td className=\"relative py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 space-x-4\">\r\n                      <button onClick={() => openRoleModal('editRole', role)} className=\"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300\">Edit</button>\r\n                      <button onClick={() => openRoleModal('deleteRole', role)} className=\"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300\">Delete</button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </RoleTable>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* --- Modals --- */}\r\n      {modalOpen && (\r\n        <div className=\"relative z-10\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity\"></div>\r\n          <div className=\"fixed inset-0 z-10 overflow-y-auto\">\r\n            <div className=\"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\">\r\n              <div className=\"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg\">\r\n                \r\n                {/* --- Roster User Modals --- */}\r\n                {modalUser && (\r\n                  <>\r\n                    <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                      <h3 className=\"text-lg font-medium leading-6 text-gray-900 dark:text-white\" id=\"modal-title\">\r\n                        {modalMode === 'deleteUser' ? 'Delete User' : `Edit: ${modalUser.last_name}, ${modalUser.first_name}`}\r\n                      </h3>\r\n                      <div className=\"mt-4 space-y-4\">\r\n                        {modalMode === 'assignCompany' && (\r\n                          <div>\r\n                            <label htmlFor=\"company\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Assign to Company</label>\r\n                            <select id=\"company\" value={newCompanyId} onChange={e => setNewCompanyId(e.target.value)}\r\n                              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm\">\r\n                              <option value=\"\">Unassign (move to Unassigned)</option>\r\n                              {allCompanies.map(c => ( <option key={c.id} value={c.id}>{c.company_name}</option> ))}\r\n                            </select>\r\n                          </div>\r\n                        )}\r\n                        {modalMode === 'assignRole' && (\r\n                          <div>\r\n                            <label htmlFor=\"role\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Assign New Role</label>\r\n                            <select id=\"role\" value={newRoleId} onChange={e => setNewRoleId(e.target.value)}\r\n                              className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm\">\r\n                              <option value=\"\">Unassign Role</option>\r\n                              {companyRoles.filter(r => r.default_role_level < myLevel).map(r => ( <option key={r.id} value={r.id}>{r.role_name}</option> ))}\r\n                            </select>\r\n                          </div>\r\n                        )}\r\n                        {modalMode === 'deleteUser' && (\r\n                          <div className=\"text-sm text-red-700 dark:text-red-400\">\r\n                            <p>Are you sure you want to permanently delete this user?</p>\r\n                            <p className=\"font-medium\">User: {modalUser.first_name} {modalUser.last_name}</p>\r\n                            <p className=\"mt-2\">This action is irreversible.</p>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\">\r\n                      <button type=\"button\" disabled={isSaving} onClick={onSave} className={`inline-flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-base font-medium text-white shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm disabled:bg-gray-400 ${modalMode === 'deleteUser' ? 'bg-red-600 hover:bg-red-700 focus:ring-red-500' : 'bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500'}`}>{isSaving ? 'Saving...' : (modalMode === 'deleteUser' ? 'Delete User' : 'Save Changes')}</button>\r\n                      <button type=\"button\" onClick={closeModal} className=\"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600\">Cancel</button>\r\n                    </div>\r\n                  </>\r\n                )}\r\n\r\n                {/* --- Role Management Modals --- */}\r\n                {(modalMode === 'createRole' || modalMode === 'editRole' || modalMode === 'deleteRole') && (\r\n                  <>\r\n                    {modalMode === 'deleteRole' ? (\r\n                      <>\r\n                        <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                          <h3 className=\"text-lg font-medium leading-6 text-gray-900 dark:text-white\">Delete Role</h3>\r\n                          <div className=\"mt-4 text-sm text-red-700 dark:text-red-400\">\r\n                            <p>Are you sure you want to delete this role?</p>\r\n                            <p className=\"font-medium\">{modalRole?.role_name}</p>\r\n                            <p className=\"mt-2\">This action cannot be undone.</p>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\">\r\n                          <button type=\"button\" disabled={isSaving} onClick={onSave} className=\"inline-flex w-full justify-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 sm:ml-3 sm:w-auto sm:text-sm disabled:bg-gray-400\">{isSaving ? 'Deleting...' : 'Delete Role'}</button>\r\n                          <button type=\"button\" onClick={closeModal} className=\"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600\">Cancel</button>\r\n                        </div>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                          <h3 className=\"text-lg font-medium leading-6 text-gray-900 dark:text-white\">{modalMode === 'createRole' ? 'Create New Role' : 'Edit Role'}</h3>\r\n                          <div className=\"mt-4 space-y-4 max-h-[60vh] overflow-y-auto pr-2\">\r\n                            <div>\r\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Role Name</label>\r\n                              <input type=\"text\" name=\"role_name\" value={roleFormData.role_name || ''} onChange={handleRoleFormChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm sm:text-sm\" />\r\n                            </div>\r\n                            <div>\r\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Company</label>\r\n                              <select name=\"company_id\" value={roleFormData.company_id || ''} onChange={handleRoleFormChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm sm:text-sm\">\r\n                                <option value=\"\">(None)</option>\r\n                                {allCompanies.map(c => <option key={c.id} value={c.id}>{c.company_name}</option>)}\r\n                              </select>\r\n                            </div>\r\n                            <div>\r\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Approval Group</label>\r\n                              <select name=\"approval_group_id\" value={roleFormData.approval_group_id || ''} onChange={handleRoleFormChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm sm:text-sm\">\r\n                                <option value=\"\">(None)</option>\r\n                                {allGroups.map(g => <option key={g.id} value={g.id}>{g.group_name}</option>)}\r\n                              </select>\r\n                            </div>\r\n                            <div>\r\n                              <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Default Role Level</label>\r\n                              <input type=\"number\" name=\"default_role_level\" value={roleFormData.default_role_level || 0} onChange={handleRoleFormChange} className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-gray-100 shadow-sm sm:text-sm\" />\r\n                            </div>\r\n                            <fieldset className=\"space-y-2\">\r\n                              <legend className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Permissions</legend>\r\n                              <div className=\"relative flex items-start\">\r\n                                <div className=\"flex h-5 items-center\"><input id=\"can_manage_own\" name=\"can_manage_own_company_roster\" type=\"checkbox\" checked={roleFormData.can_manage_own_company_roster || false} onChange={handleRoleFormChange} className=\"h-4 w-4 rounded border-gray-300 text-indigo-600\" /></div>\r\n                                <div className=\"ml-3 text-sm\"><label htmlFor=\"can_manage_own\" className=\"font-medium text-gray-700 dark:text-gray-300\">Can Manage Own Company Roster</label></div>\r\n                              </div>\r\n                              <div className=\"relative flex items-start\">\r\n                                <div className=\"flex h-5 items-center\"><input id=\"can_manage_all\" name=\"can_manage_all_rosters\" type=\"checkbox\" checked={roleFormData.can_manage_all_rosters || false} onChange={handleRoleFormChange} className=\"h-4 w-4 rounded border-gray-300 text-indigo-600\" /></div>\r\n                                <div className=\"ml-3 text-sm\"><label htmlFor=\"can_manage_all\" className=\"font-medium text-gray-700 dark:text-gray-300\">Can Manage ALL Rosters (Admin)</label></div>\r\n                              </div>\r\n                            </fieldset>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\">\r\n                          <button type=\"button\" disabled={isSaving} onClick={onSave} className=\"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white sm:ml-3 sm:w-auto sm:text-sm disabled:bg-gray-400\">{isSaving ? 'Saving...' : 'Save Role'}</button>\r\n                          <button type=\"button\" onClick={closeModal} className=\"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-600\">Cancel</button>\r\n                        </div>\r\n                      </>\r\n                    )}\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n\r\nfunction RosterTable({ loading, children }: { loading: boolean, children: React.ReactNode }) {\r\n  return (\r\n    <div className=\"mt-4 flow-root\">\r\n      <div className=\"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8\">\r\n        <div className=\"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8\">\r\n          <div className=\"overflow-hidden shadow ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 sm:rounded-lg\">\r\n            <table className=\"min-w-full divide-y divide-gray-300 dark:divide-gray-700\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-800\">\r\n                <tr>\r\n                  <th className=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-white sm:pl-6\">Name</th>\r\n                  <th className=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white\">Affiliation</th>\r\n                  <th className=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white\">Role</th>\r\n                  <th className=\"relative py-3.5 pl-3 pr-4 sm:pr-6\"><span className=\"sr-only\">Actions</span></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800/50\">\r\n                {loading ? <tr><td colSpan={4} className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Loading...</td></tr> : children}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction RoleTable({ loading, children }: { loading: boolean, children: React.ReactNode }) {\r\n  return (\r\n    <div className=\"mt-4 flow-root\">\r\n      <div className=\"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8\">\r\n        <div className=\"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8\">\r\n          <div className=\"overflow-hidden shadow ring-1 ring-black ring-opacity-5 dark:ring-white dark:ring-opacity-10 sm:rounded-lg\">\r\n            <table className=\"min-w-full divide-y divide-gray-300 dark:divide-gray-700\">\r\n              <thead className=\"bg-gray-50 dark:bg-gray-800\">\r\n                <tr>\r\n                  <th className=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 dark:text-white sm:pl-6\">Role Name</th>\r\n                  <th className=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white\">Company</th>\r\n                  <th className=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white\">Group</th>\r\n                  <th className=\"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 dark:text-white\">Level</th>\r\n                  <th className=\"relative py-3.5 pl-3 pr-4 sm:pr-6\"><span className=\"sr-only\">Actions</span></th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700 bg-white dark:bg-gray-800/50\">\r\n                {loading ? <tr><td colSpan={5} className=\"p-8 text-center text-gray-500 dark:text-gray-400\">Loading...</td></tr> : children}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}