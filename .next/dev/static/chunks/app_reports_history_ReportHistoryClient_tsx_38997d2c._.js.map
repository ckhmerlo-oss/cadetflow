{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/reports/history/ReportHistoryClient.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState, useMemo } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport { HistoryReport } from './page'\r\n\r\n// Helper to format names\r\nconst formatName = (person: { first_name: string, last_name: string } | null) => {\r\n  if (!person) return 'Unknown'\r\n  return `${person.last_name}, ${person.first_name}`\r\n}\r\n\r\nconst STATUS_COLORS: Record<string, string> = {\r\n  completed: 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',\r\n  rejected: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',\r\n  pulled: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',\r\n}\r\n\r\nexport default function ReportHistoryClient({ initialReports }: { initialReports: HistoryReport[] }) {\r\n  const router = useRouter()\r\n\r\n  // --- STATE ---\r\n  const [searchTerm, setSearchTerm] = useState('')\r\n  const [statusFilter, setStatusFilter] = useState<'all' | 'completed' | 'rejected' | 'pulled'>('all')\r\n  const [sortKey, setSortKey] = useState<'date' | 'subject'>('date')\r\n  \r\n  const [expandedId, setExpandedId] = useState<string | null>(null)\r\n\r\n  // --- FILTERING & SORTING ---\r\n  const filteredReports = useMemo(() => {\r\n    return initialReports\r\n      .filter(r => {\r\n        // 1. Status Filter\r\n        if (statusFilter !== 'all' && r.status !== statusFilter) return false\r\n        \r\n        // 2. Search Filter (Name, Offense, Submitter)\r\n        const lowerSearch = searchTerm.toLowerCase()\r\n        if (!lowerSearch) return true\r\n        \r\n        return (\r\n          formatName(r.subject).toLowerCase().includes(lowerSearch) ||\r\n          formatName(r.submitter).toLowerCase().includes(lowerSearch) ||\r\n          r.offense_type.offense_name.toLowerCase().includes(lowerSearch)\r\n        )\r\n      })\r\n      .sort((a, b) => {\r\n        if (sortKey === 'date') {\r\n          return new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\r\n        } else {\r\n          return formatName(a.subject).localeCompare(formatName(b.subject))\r\n        }\r\n      })\r\n  }, [initialReports, searchTerm, statusFilter, sortKey])\r\n\r\n\r\n  // --- RENDER ---\r\n  return (\r\n    <div className=\"bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700\">\r\n      \r\n      {/* TOOLBAR */}\r\n      <div className=\"p-4 grid grid-cols-1 md:grid-cols-12 gap-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/20\">\r\n        \r\n        {/* Search */}\r\n        <div className=\"md:col-span-5\">\r\n          <label className=\"block text-xs font-medium text-gray-500 uppercase mb-1\">Search</label>\r\n          <input \r\n            type=\"text\" \r\n            placeholder=\"Search cadet, submitter, or offense...\" \r\n            className=\"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white shadow-sm sm:text-sm py-2 px-3\" \r\n            value={searchTerm} \r\n            onChange={e => setSearchTerm(e.target.value)} \r\n          />\r\n        </div>\r\n\r\n        {/* Status Filter */}\r\n        <div className=\"md:col-span-3\">\r\n          <label className=\"block text-xs font-medium text-gray-500 uppercase mb-1\">Status</label>\r\n          <select \r\n            value={statusFilter} \r\n            onChange={e => setStatusFilter(e.target.value as any)}\r\n            className=\"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white shadow-sm sm:text-sm py-2 px-3\"\r\n          >\r\n            <option value=\"all\">All Statuses</option>\r\n            <option value=\"completed\">Approved</option>\r\n            <option value=\"rejected\">Rejected</option>\r\n            <option value=\"pulled\">Pulled</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* Sort */}\r\n        <div className=\"md:col-span-3\">\r\n          <label className=\"block text-xs font-medium text-gray-500 uppercase mb-1\">Sort By</label>\r\n          <select \r\n            value={sortKey} \r\n            onChange={e => setSortKey(e.target.value as any)}\r\n            className=\"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-800 dark:text-white shadow-sm sm:text-sm py-2 px-3\"\r\n          >\r\n            <option value=\"date\">Date (Newest First)</option>\r\n            <option value=\"subject\">Subject Name (A-Z)</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* Refresh */}\r\n        <div className=\"md:col-span-1 flex items-end\">\r\n          <button \r\n            onClick={() => router.refresh()} \r\n            className=\"w-full py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors\"\r\n            title=\"Refresh Data\"\r\n          >\r\n            â†»\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* TABLE */}\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n          <thead className=\"bg-gray-50 dark:bg-gray-800\">\r\n            <tr>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Status</th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Subject</th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Offense</th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Demerits</th>\r\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">Date</th>\r\n              <th className=\"relative px-6 py-3\"><span className=\"sr-only\">View</span></th>\r\n            </tr>\r\n          </thead>\r\n          <tbody className=\"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700\">\r\n            {filteredReports.length > 0 ? filteredReports.map(report => (\r\n              <React.Fragment key={report.id}>\r\n                <tr \r\n                  onClick={() => setExpandedId(expandedId === report.id ? null : report.id)}\r\n                  className={`cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${expandedId === report.id ? 'bg-gray-50 dark:bg-gray-700/50' : ''}`}\r\n                >\r\n                  <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${STATUS_COLORS[report.status] || 'bg-gray-100 text-gray-800'}`}>\r\n                      {report.status === 'completed' ? 'Approved' : report.status.charAt(0).toUpperCase() + report.status.slice(1)}\r\n                    </span>\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                    {formatName(report.subject)}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300\">\r\n                    {report.offense_type.offense_name}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm font-bold text-red-600 dark:text-red-400\">\r\n                    {report.demerits_effective}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\r\n                    {new Date(report.created_at).toLocaleDateString()}\r\n                  </td>\r\n                  <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                    <span className=\"text-indigo-600 dark:text-indigo-400\">\r\n                      {expandedId === report.id ? 'Close' : 'View'}\r\n                    </span>\r\n                  </td>\r\n                </tr>\r\n\r\n                {/* EXPANDED DETAILS */}\r\n                {expandedId === report.id && (\r\n                  <tr className=\"bg-gray-50 dark:bg-gray-900/30 shadow-inner\">\r\n                    <td colSpan={6} className=\"px-6 py-4\">\r\n                      <div className=\"flex flex-col md:flex-row justify-between items-start gap-6\">\r\n                        <div className=\"flex-grow space-y-2\">\r\n                            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\r\n                                <strong>Submitted By:</strong> {formatName(report.submitter)}\r\n                            </p>\r\n                            <p className=\"text-sm text-gray-700 dark:text-gray-300\">\r\n                                <strong>Date of Offense:</strong> {new Date(report.date_of_offense).toLocaleString()}\r\n                            </p>\r\n                            <div className=\"mt-2 p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md\">\r\n                                <p className=\"text-xs font-semibold text-gray-500 uppercase mb-1\">Notes</p>\r\n                                <p className=\"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap\">\r\n                                    {report.notes || 'No notes provided.'}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        \r\n                        <div className=\"flex-shrink-0 flex flex-col gap-3\">\r\n                            <Link \r\n                                href={`/report/${report.id}`}\r\n                                className=\"inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm\"\r\n                            >\r\n                                Open Full Report Page &rarr;\r\n                            </Link>\r\n                            <p className=\"text-xs text-center text-gray-500 max-w-[200px]\">\r\n                                Go to the full page to view approval logs, appeals, or to <strong>Pull (Revoke)</strong> this report.\r\n                            </p>\r\n                        </div>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                )}\r\n              </React.Fragment>\r\n            )) : (\r\n              <tr>\r\n                <td colSpan={6} className=\"px-6 py-10 text-center text-sm text-gray-500 dark:text-gray-400\">\r\n                  No reports found. Try adjusting your filters.\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      \r\n      <div className=\"p-3 bg-gray-50 dark:bg-gray-900/20 border-t border-gray-200 dark:border-gray-700 text-xs text-center text-gray-500\">\r\n        Showing up to 300 most recent archived reports.\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}