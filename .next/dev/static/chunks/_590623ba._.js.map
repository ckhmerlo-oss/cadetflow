{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/ThemeProvider.tsx"],"sourcesContent":["// in app/components/ThemeProvider.tsx\r\n'use client'\r\n\r\nimport { createContext, useContext, useState, useEffect } from 'react'\r\n\r\ntype Theme = 'light' | 'dark'\r\n\r\ntype ThemeProviderState = {\r\n  theme: Theme\r\n  setTheme: (theme: Theme) => void\r\n}\r\n\r\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined)\r\n\r\nexport function ThemeProvider({\r\n  children,\r\n  defaultTheme = 'dark', // Your default\r\n}: {\r\n  children: React.ReactNode\r\n  defaultTheme?: Theme\r\n}) {\r\n  // 1. Initialize state *only* with the default theme.\r\n  // This ensures the server and client initial render are identical.\r\n  const [theme, setTheme] = useState<Theme>(defaultTheme)\r\n\r\n  useEffect(() => {\r\n    // 2. On client mount, check local storage and update state if it exists.\r\n    // This runs *after* hydration, avoiding the mismatch.\r\n    const storedTheme = window.localStorage.getItem('theme') as Theme | null\r\n    if (storedTheme) {\r\n      setTheme(storedTheme)\r\n    }\r\n  }, []) // Empty dependency array ensures this runs only once on mount\r\n\r\n  useEffect(() => {\r\n    // 3. This effect syncs any theme change (from mount or toggle)\r\n    // back to the <html> tag and local storage.\r\n    const root = window.document.documentElement\r\n    \r\n    root.classList.remove('light', 'dark')\r\n    root.classList.add(theme)\r\n    \r\n    // Save the choice to local storage\r\n    window.localStorage.setItem('theme', theme)\r\n  }, [theme]) // Runs whenever the theme state changes\r\n\r\n  const value = {\r\n    theme,\r\n    setTheme,\r\n  }\r\n\r\n  return (\r\n    <ThemeProviderContext.Provider value={value}>\r\n      {children}\r\n    </ThemeProviderContext.Provider>\r\n  )\r\n}\r\n\r\n// Custom hook to easily use the theme\r\nexport const useTheme = () => {\r\n  const context = useContext(ThemeProviderContext)\r\n  if (context === undefined) {\r\n    throw new Error('useTheme must be used within a ThemeProvider')\r\n  }\r\n  return context\r\n}"],"names":[],"mappings":"AAAA,sCAAsC;;;;;;;;AAGtC;;;AAFA;;AAWA,MAAM,qCAAuB,IAAA,8KAAa,EAAiC;AAEpE,SAAS,cAAc,EAC5B,QAAQ,EACR,eAAe,MAAM,EAItB;;IACC,qDAAqD;IACrD,mEAAmE;IACnE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAQ;IAE1C,IAAA,0KAAS;mCAAC;YACR,yEAAyE;YACzE,sDAAsD;YACtD,MAAM,cAAc,OAAO,YAAY,CAAC,OAAO,CAAC;YAChD,IAAI,aAAa;gBACf,SAAS;YACX;QACF;kCAAG,EAAE,GAAE,8DAA8D;IAErE,IAAA,0KAAS;mCAAC;YACR,+DAA+D;YAC/D,4CAA4C;YAC5C,MAAM,OAAO,OAAO,QAAQ,CAAC,eAAe;YAE5C,KAAK,SAAS,CAAC,MAAM,CAAC,SAAS;YAC/B,KAAK,SAAS,CAAC,GAAG,CAAC;YAEnB,mCAAmC;YACnC,OAAO,YAAY,CAAC,OAAO,CAAC,SAAS;QACvC;kCAAG;QAAC;KAAM,GAAE,wCAAwC;IAEpD,MAAM,QAAQ;QACZ;QACA;IACF;IAEA,qBACE,6LAAC,qBAAqB,QAAQ;QAAC,OAAO;kBACnC;;;;;;AAGP;GA1CgB;KAAA;AA6CT,MAAM,WAAW;;IACtB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa","debugId":null}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/utils/supabase/client.ts"],"sourcesContent":["// in utils/supabase/client.ts\r\nimport { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport function createClient() {\r\n  return createBrowserClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n  )\r\n}"],"names":[],"mappings":"AAAA,8BAA8B;;;;;AAK1B;AAJJ;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,oMAAmB;AAI5B","debugId":null}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/ThemeToggleButton.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useTheme } from './ThemeProvider'\r\n\r\n// Simple Sun/Moon icons\r\nconst SunIcon = () => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\r\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386 1.591-1.591M3 12H.75m.386-6.364 1.591 1.591\" />\r\n  </svg>\r\n)\r\n\r\nconst MoonIcon = () => (\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-6 h-6\">\r\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M21.752 15.002A9.718 9.718 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25c0 5.385 4.365 9.75 9.75 9.75 2.671 0 5.117-.991 6.992-2.61a.75.75 0 0 1 .01-1.06Z\" />\r\n  </svg>\r\n)\r\n\r\nexport default function ThemeToggleButton() {\r\n  const { theme, setTheme } = useTheme()\r\n\r\n  return (\r\n    <button\r\n      onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}\r\n      // UPDATED: Fixed w-10 h-10 ensures a perfect circle.\r\n      className=\"flex items-center justify-center w-10 h-10 rounded-full text-gray-500 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\r\n      aria-label=\"Toggle theme\"\r\n    >\r\n      {theme === 'light' ? <MoonIcon /> : <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth=\"1.5\" stroke=\"currentColor\" className=\"size-6\">\r\n        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z\" />\r\n      </svg>}\r\n    </button>\r\n  )\r\n}"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAIA,wBAAwB;AACxB,MAAM,UAAU,kBACd,6LAAC;QAAI,OAAM;QAA6B,MAAK;QAAO,SAAQ;QAAY,aAAa;QAAK,QAAO;QAAe,WAAU;kBACxH,cAAA,6LAAC;YAAK,eAAc;YAAQ,gBAAe;YAAQ,GAAE;;;;;;;;;;;KAFnD;AAMN,MAAM,WAAW,kBACf,6LAAC;QAAI,OAAM;QAA6B,MAAK;QAAO,SAAQ;QAAY,aAAa;QAAK,QAAO;QAAe,WAAU;kBACxH,cAAA,6LAAC;YAAK,eAAc;YAAQ,gBAAe;YAAQ,GAAE;;;;;;;;;;;MAFnD;AAMS,SAAS;;IACtB,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,kJAAQ;IAEpC,qBACE,6LAAC;QACC,SAAS,IAAM,SAAS,UAAU,SAAS,UAAU;QACrD,qDAAqD;QACrD,WAAU;QACV,cAAW;kBAEV,UAAU,wBAAU,6LAAC;;;;iCAAc,6LAAC;YAAI,OAAM;YAA6B,MAAK;YAAO,SAAQ;YAAY,aAAY;YAAM,QAAO;YAAe,WAAU;sBAC5J,cAAA,6LAAC;gBAAK,eAAc;gBAAQ,gBAAe;gBAAQ,GAAE;;;;;;;;;;;;;;;;AAI7D;GAfwB;;QACM,kJAAQ;;;MADd","debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/FeedbackButton.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport { usePathname } from 'next/navigation'\r\nimport { useState } from 'react'\r\n\r\ntype FeedbackButtonProps = {\r\n  variant?: 'icon' | 'text'\r\n}\r\n\r\nexport default function FeedbackButton({ variant = 'icon' }: FeedbackButtonProps) {\r\n  const supabase = createClient()\r\n  const pathname = usePathname()\r\n\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n  const [feedbackType, setFeedbackType] = useState('bug')\r\n  const [content, setContent] = useState('')\r\n  \r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const [success, setSuccess] = useState(false)\r\n\r\n  const handleOpen = () => {\r\n    setError(null)\r\n    setSuccess(false)\r\n    setContent('')\r\n    setFeedbackType('bug')\r\n    setModalOpen(true)\r\n  }\r\n\r\n  const handleClose = () => {\r\n    setModalOpen(false)\r\n  }\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    setIsSubmitting(true)\r\n    setError(null)\r\n    setSuccess(false)\r\n\r\n    const { error } = await supabase.from('feedback').insert({\r\n      feedback_type: feedbackType,\r\n      page_url: pathname,\r\n      content: content,\r\n    })\r\n\r\n    setIsSubmitting(false)\r\n\r\n    if (error) {\r\n      setError(error.message)\r\n    } else {\r\n      setSuccess(true)\r\n      setContent('')\r\n      setTimeout(() => {\r\n        setModalOpen(false)\r\n      }, 2000)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        id=\"nav-feedback\" // Added for Tour\r\n        onClick={handleOpen}\r\n        className={variant === 'icon' \r\n          ? \"text-gray-500 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-white p-2 rounded-full transition-colors\"\r\n          : \"block w-full text-left text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\" // Mobile styling matches menu items\r\n        }\r\n        title=\"Send Feedback\"\r\n      >\r\n        {variant === 'icon' ? (\r\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z\" />\r\n          </svg>\r\n        ) : (\r\n          \"Feedback\"\r\n        )}\r\n      </button>\r\n\r\n      {modalOpen && (\r\n        <div className=\"relative z-[100]\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity\" onClick={handleClose}></div>\r\n          <div className=\"fixed inset-0 z-10 overflow-y-auto\">\r\n            <div className=\"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0\">\r\n              <div className=\"relative transform overflow-hidden rounded-lg bg-white dark:bg-gray-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg\">\r\n                <form onSubmit={handleSubmit}>\r\n                  <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                    <h3 className=\"text-lg font-medium leading-6 text-gray-900 dark:text-white\" id=\"modal-title\">\r\n                      Submit Feedback\r\n                    </h3>\r\n                    <div className=\"mt-4 space-y-4\">\r\n                      <fieldset>\r\n                        <legend className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Feedback Type</legend>\r\n                        <div className=\"mt-2 space-y-2\">\r\n                          <div className=\"flex gap-4 flex-wrap\"> \r\n                            <label className=\"flex items-center\">\r\n                              <input type=\"radio\" name=\"feedback-type\" value=\"bug\" checked={feedbackType === 'bug'} onChange={() => setFeedbackType('bug')} className=\"h-4 w-4 text-indigo-600 border-gray-300 dark:border-gray-600\" />\r\n                              <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">Bug Report</span>\r\n                            </label>\r\n                            <label className=\"flex items-center\">\r\n                              <input type=\"radio\" name=\"feedback-type\" value=\"feature request\" checked={feedbackType === 'feature request'} onChange={() => setFeedbackType('feature request')} className=\"h-4 w-4 text-indigo-600 border-gray-300 dark:border-gray-600\" />\r\n                              <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">Feature Request</span>\r\n                            </label>\r\n                            <label className=\"flex items-center\">\r\n                              <input type=\"radio\" name=\"feedback-type\" value=\"comment/complaint\" checked={feedbackType === 'comment/complaint'} onChange={() => setFeedbackType('comment/complaint')} className=\"h-4 w-4 text-indigo-600 border-gray-300 dark:border-gray-600\" />\r\n                              <span className=\"ml-2 text-sm text-gray-700 dark:text-gray-300\">Comment / Complaint</span>\r\n                            </label>\r\n                          </div>\r\n                        </div>\r\n                      </fieldset>\r\n                      <div>\r\n                        <label htmlFor=\"content\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">Details</label>\r\n                        <textarea id=\"content\" value={content} onChange={(e) => setContent(e.target.value)} rows={4} required className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white p-2\" placeholder=\"Please provide specific details...\" />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  {success && <div className=\"px-6 py-2\"><p className=\"text-sm text-green-600 dark:text-green-400\">Thank you! Submitting feedback...</p></div>}\r\n                  {error && <div className=\"px-6 py-2\"><p className=\"text-sm text-red-600 dark:text-red-400\">Error: {error}</p></div>}\r\n                  <div className=\"bg-gray-50 dark:bg-gray-800/50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6\">\r\n                    <button type=\"submit\" disabled={isSubmitting || success} className=\"inline-flex w-full justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm disabled:bg-gray-400\">{isSubmitting ? 'Submitting...' : 'Submit Feedback'}</button>\r\n                    <button type=\"button\" onClick={handleClose} className=\"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 px-4 py-2 text-base font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-600 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\">Cancel</button>\r\n                  </div>\r\n                </form>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 603, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/HeaderMenu.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter, usePathname } from 'next/navigation'\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport ThemeToggleButton from './ThemeToggleButton'\r\nimport FeedbackButton from './FeedbackButton'\r\n\r\ntype HeaderMenuProps = {\r\n  canManage: boolean\r\n  showDailyReports: boolean\r\n  isLoggedIn: boolean\r\n  isSiteAdmin: boolean\r\n  roleLevel: number \r\n}\r\n\r\n// Icons\r\nconst HamburgerIcon = () => (\r\n  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16m-7 6h7\" />\r\n  </svg>\r\n)\r\nconst CloseIcon = () => (\r\n  <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n  </svg>\r\n)\r\n\r\nexport default function HeaderMenu({ isLoggedIn, canManage, showDailyReports, isSiteAdmin, roleLevel }: HeaderMenuProps) {\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false)\r\n  \r\n  const supabase = createClient()\r\n  const router = useRouter()\r\n  const pathname = usePathname()\r\n\r\n  useEffect(() => {\r\n    setIsMobileMenuOpen(false)\r\n  }, [pathname])\r\n\r\n  const handleSignOut = async () => {\r\n    await supabase.auth.signOut()\r\n    router.push('/login')\r\n    router.refresh()\r\n  }\r\n\r\n  return (\r\n    <>\r\n      {/* --- DESKTOP MENU --- */}\r\n      <div className=\"hidden md:flex items-center justify-end space-x-3\">\r\n        {roleLevel >= 15 && (\r\n            <Link href=\"/\" id=\"nav-dashboard\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Dashboard\r\n            </Link>\r\n        )}\r\n        \r\n        {isLoggedIn && roleLevel >= 15 && (\r\n            <Link href=\"/submit\" id=\"nav-submit\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Submit Report\r\n            </Link>\r\n        )}\r\n\r\n        {isLoggedIn && roleLevel >= 50 && (\r\n            <Link href=\"/reports/history\" id=\"nav-reports\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Report History\r\n            </Link>\r\n        )}\r\n\r\n        {showDailyReports && (\r\n             <Link href=\"/reports/daily\" id=\"nav-daily\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Green Sheet\r\n            </Link>\r\n        )}\r\n\r\n        {canManage && (\r\n            <>\r\n             {/* UPDATED LINK */}\r\n             <Link href=\"/action-items\" id=\"nav-approval\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Action Items\r\n            </Link>\r\n            <Link href=\"/manage\" id=\"nav-roster\" className=\"text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors\">\r\n                Roster\r\n            </Link>\r\n            </>\r\n        )}\r\n\r\n        {isSiteAdmin && (\r\n            <Link href=\"/admin\" id=\"nav-admin\" className=\"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 px-3 py-2 rounded-md text-sm font-bold transition-colors border border-red-100 dark:border-red-900\">\r\n                Admin\r\n            </Link>\r\n        )}\r\n\r\n        <ThemeToggleButton />\r\n\r\n        {isLoggedIn ? (\r\n          <div className=\"flex items-center gap-2 ml-3\">\r\n             <FeedbackButton variant=\"icon\" />\r\n             <button id=\"nav-signout\" onClick={handleSignOut} className=\"bg-indigo-50 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 px-3 py-1.5 rounded-md text-sm font-medium transition-colors\">\r\n                Sign Out\r\n             </button>\r\n          </div>\r\n        ) : (\r\n             <Link href=\"/login\" className=\"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium\">Login</Link>\r\n        )}\r\n      </div>\r\n\r\n      {/* --- MOBILE MENU --- */}\r\n      <div className=\"-mr-2 flex md:hidden\">\r\n         <ThemeToggleButton />\r\n        <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className=\"bg-white dark:bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none ml-2\">\r\n          {isMobileMenuOpen ? <CloseIcon /> : <HamburgerIcon />}\r\n        </button>\r\n      </div>\r\n\r\n      {isMobileMenuOpen && (\r\n        <div className=\"md:hidden absolute top-16 inset-x-0 z-50 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-lg\">\r\n          <div className=\"px-2 pt-2 pb-3 space-y-1 sm:px-3\">\r\n            {roleLevel >= 15 && ( <Link href=\"/\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Dashboard</Link> )}\r\n            {isLoggedIn && roleLevel >= 15 && ( <Link href=\"/submit\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Submit Report</Link> )}\r\n            {isLoggedIn && roleLevel >= 50 && ( <Link href=\"/reports/history\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Report History</Link> )}\r\n            {showDailyReports && ( <Link href=\"/reports/daily\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Green Sheet</Link> )}\r\n            {canManage && (\r\n                <>\r\n                {/* UPDATED LINK */}\r\n                <Link href=\"/action-items\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Action Items</Link>\r\n                <Link href=\"/manage\" className=\"block px-3 py-2 rounded-md text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700\">Roster</Link>\r\n                </>\r\n            )}\r\n            {isSiteAdmin && ( <Link href=\"/admin\" className=\"block px-3 py-2 rounded-md text-base font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20\">Admin</Link> )}\r\n          </div>\r\n\r\n          {isLoggedIn ? (\r\n            <div className=\"pt-4 pb-4 border-t border-gray-200 dark:border-gray-700\">\r\n              <div className=\"px-2 space-y-1\">\r\n                <div className=\"px-3 py-2\">\r\n                    <FeedbackButton variant=\"text\" />\r\n                </div>\r\n                <button onClick={handleSignOut} className=\"block w-full text-left px-3 py-2 rounded-md text-base font-medium text-red-600 dark:text-red-400 hover:bg-gray-50 dark:hover:bg-gray-700\">Sign out</button>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n             <div className=\"px-5 pb-4\">\r\n                 <Link href=\"/login\" className=\"block w-full text-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700\">Login</Link>\r\n             </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 999, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/tour/TourConfig.ts"],"sourcesContent":["export type TourStep = {\r\n  id: string;\r\n  path: string;\r\n  targetId: string;\r\n  title: string;\r\n  content: string;\r\n  placement: 'top' | 'bottom' | 'left' | 'right';\r\n  shouldShow: (permissions: UserPermissions) => boolean;\r\n  disableScroll?: boolean;\r\n}\r\n\r\nexport type UserPermissions = {\r\n  roleLevel: number;\r\n  canManage: boolean;\r\n  isSiteAdmin: boolean;\r\n  showDailyReports: boolean;\r\n  userId: string;\r\n}\r\n\r\nexport const TOUR_STEPS: TourStep[] = [\r\n  // ... (All previous steps remain the same) ...\r\n  // --- LEVEL 10 SPECIFIC TOUR (Ledger Only) ---\r\n  {\r\n    id: 'ledger-intro',\r\n    path: '/ledger/::userId::', \r\n    targetId: 'ledger-header',\r\n    title: 'Your Disciplinary Record',\r\n    content: 'This is your personal ledger. It tracks every demerit you have received and every tour you have served.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.roleLevel === 10\r\n  },\r\n  {\r\n    id: 'ledger-stats',\r\n    path: '/ledger/::userId::',\r\n    targetId: 'ledger-stats-grid',\r\n    title: 'Current Standing',\r\n    content: 'Keep an eye on these numbers. Your \"Current Tour Balance\" tells you how many penalty tours you currently owe.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.roleLevel === 10\r\n  },\r\n  {\r\n    id: 'ledger-history',\r\n    path: '/ledger/::userId::',\r\n    targetId: 'ledger-history-list',\r\n    title: 'Report History',\r\n    content: 'This list shows all reports filed against you. Click any report title to view the full details or file an appeal.',\r\n    placement: 'top',\r\n    shouldShow: (p) => p.roleLevel === 10\r\n  },\r\n\r\n  // --- STANDARD TOUR (Level 15+) ---\r\n  {\r\n    id: 'dashboard-intro',\r\n    path: '/',\r\n    targetId: 'nav-dashboard',\r\n    title: 'Dashboard',\r\n    content: 'This is your command center.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.roleLevel >= 15\r\n  },\r\n  {\r\n    id: 'dashboard-action-items',\r\n    path: '/',\r\n    targetId: 'dashboard-action-items',\r\n    title: 'Action Items',\r\n    content: 'This is the most important section. Reports waiting for your approval, revision, or attention will appear here.',\r\n    placement: 'right', \r\n    shouldShow: (p) => p.roleLevel >= 15,\r\n    disableScroll: true\r\n  },\r\n  {\r\n    id: 'nav-submit',\r\n    path: '/',\r\n    targetId: 'dashboard-submit-btn', \r\n    title: 'Submit Report',\r\n    content: 'Click here to file a new demerit report.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.roleLevel >= 15,\r\n    disableScroll: true\r\n  },\r\n  \r\n  // --- STAFF (Level 50+) ---\r\n  {\r\n    id: 'green-sheet',\r\n    path: '/', \r\n    targetId: 'nav-daily',\r\n    title: 'Green & Tour Sheet',\r\n    content: 'Access the Daily Disciplinary Report and Punishment Log here.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.showDailyReports\r\n  },\r\n  {\r\n    id: 'daily-tabs', \r\n    path: '/reports/daily',\r\n    targetId: 'daily-tabs',\r\n    title: 'Toggle Views',\r\n    content: 'Switch between the \"Green Sheet\" (Daily Summary) and the \"Tour Sheet\" (Ledger) using these tabs.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.showDailyReports\r\n  },\r\n  {\r\n    id: 'tour-logging', \r\n    path: '/reports/daily',\r\n    targetId: 'daily-content-area', \r\n    title: 'Logging Tours',\r\n    content: 'TAC Officers: Switch to the Tour Sheet tab. Select cadets and use the \"Bulk Log\" button to record served tours.',\r\n    placement: 'top',\r\n    shouldShow: (p) => p.showDailyReports\r\n  },\r\n  \r\n  // --- ADMIN / MANAGE ---\r\n  {\r\n    id: 'roster-manage',\r\n    path: '/manage',\r\n    targetId: 'roster-controls',\r\n    title: 'Roster Management',\r\n    content: 'Search for cadets, assign roles, or move them between companies using these filters.',\r\n    placement: 'bottom',\r\n    shouldShow: (p) => p.canManage\r\n  },\r\n\r\n  // --- FEEDBACK & FINISH (Everyone) ---\r\n  {\r\n    id: 'nav-feedback',\r\n    path: '/', // Back to dashboard\r\n    targetId: 'nav-feedback',\r\n    title: 'Send Feedback',\r\n    content: 'Have a suggestion or found a bug? Let us know directly using this button.',\r\n    placement: 'left',\r\n    shouldShow: (p) => p.roleLevel >= 15\r\n  },\r\n  {\r\n    id: 'finish-logout',\r\n    path: '/', \r\n    targetId: 'nav-signout', \r\n    title: 'Sign Out',\r\n    content: 'When you are done, use this button to log out.',\r\n    placement: 'left',\r\n    shouldShow: (p) => p.roleLevel >= 15,\r\n    disableScroll: true\r\n  },\r\n  {\r\n    id: 'finish-logout-l10',\r\n    path: '/ledger/::userId::', \r\n    targetId: 'nav-signout', \r\n    title: 'Sign Out',\r\n    content: 'Use this button to log out.',\r\n    placement: 'left',\r\n    shouldShow: (p) => p.roleLevel === 10,\r\n    disableScroll: true\r\n  }\r\n];"],"names":[],"mappings":";;;;AAmBO,MAAM,aAAyB;IACpC,+CAA+C;IAC/C,+CAA+C;IAC/C;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,KAAK;IACrC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,KAAK;IACrC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,KAAK;IACrC;IAEA,oCAAoC;IACpC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,IAAI;IACpC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,IAAI;QAClC,eAAe;IACjB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,IAAI;QAClC,eAAe;IACjB;IAEA,4BAA4B;IAC5B;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,gBAAgB;IACvC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,gBAAgB;IACvC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,gBAAgB;IACvC;IAEA,yBAAyB;IACzB;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS;IAChC;IAEA,uCAAuC;IACvC;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,IAAI;IACpC;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,IAAI;QAClC,eAAe;IACjB;IACA;QACE,IAAI;QACJ,MAAM;QACN,UAAU;QACV,OAAO;QACP,SAAS;QACT,WAAW;QACX,YAAY,CAAC,IAAM,EAAE,SAAS,KAAK;QACnC,eAAe;IACjB;CACD","debugId":null}},
    {"offset": {"line": 1139, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/components/tour/OnboardingTour.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect, useMemo } from 'react'\r\nimport { useRouter, usePathname } from 'next/navigation'\r\nimport { createClient } from '@/utils/supabase/client'\r\nimport { TOUR_STEPS, UserPermissions } from './TourConfig'\r\n\r\nexport default function OnboardingTour(permissions: UserPermissions & { show: boolean }) {\r\n  const [isOpen, setIsOpen] = useState(false)\r\n  const [currentStepIndex, setCurrentStepIndex] = useState(0)\r\n  const [rect, setRect] = useState<DOMRect | null>(null)\r\n  \r\n  // --- NEW: Mobile Detection State ---\r\n  const [isMobile, setIsMobile] = useState(false)\r\n  \r\n  const router = useRouter()\r\n  const pathname = usePathname()\r\n  const supabase = createClient()\r\n\r\n  // 1. Filter and Process steps\r\n  const activeSteps = useMemo(() => {\r\n    return TOUR_STEPS\r\n      .filter(step => step.shouldShow(permissions))\r\n      .map(step => ({\r\n        ...step,\r\n        path: step.path.replace('::userId::', permissions.userId)\r\n      }))\r\n  }, [permissions.roleLevel, permissions.canManage, permissions.isSiteAdmin, permissions.showDailyReports, permissions.userId])\r\n\r\n  const currentStep = activeSteps[currentStepIndex]\r\n\r\n  // 2. Start Tour logic\r\n  useEffect(() => {\r\n    if (permissions.show && activeSteps.length > 0) {\r\n        setTimeout(() => setIsOpen(true), 1500)\r\n    }\r\n  }, [permissions.show, activeSteps.length])\r\n\r\n  // --- NEW: Handle Mobile Resize ---\r\n  useEffect(() => {\r\n    const checkMobile = () => {\r\n        setIsMobile(window.innerWidth < 768)\r\n    }\r\n    checkMobile()\r\n    window.addEventListener('resize', checkMobile)\r\n    return () => window.removeEventListener('resize', checkMobile)\r\n  }, [])\r\n\r\n  // 3. Navigation & Positioning Engine\r\n  useEffect(() => {\r\n    if (!isOpen || !currentStep) return\r\n\r\n    if (pathname !== currentStep.path) {\r\n      router.push(currentStep.path)\r\n      return \r\n    }\r\n\r\n    const findAndHighlight = () => {\r\n      const element = document.getElementById(currentStep.targetId)\r\n      if (element) {\r\n        const r = element.getBoundingClientRect()\r\n        if (r.width > 0 && r.height > 0) {\r\n          setRect(r)\r\n          // Only auto-scroll if NOT disabled AND NOT on mobile\r\n          if (!currentStep.disableScroll && !isMobile) {\r\n            element.scrollIntoView({ behavior: 'smooth', block: 'center' })\r\n          }\r\n        } else {\r\n            setRect({ top: window.innerHeight/2, left: window.innerWidth/2, width: 0, height: 0 } as DOMRect)\r\n        }\r\n      } else {\r\n        setTimeout(findAndHighlight, 500)\r\n      }\r\n    }\r\n\r\n    const timer = setTimeout(findAndHighlight, 500)\r\n    window.addEventListener('resize', findAndHighlight)\r\n    return () => {\r\n        clearTimeout(timer)\r\n        window.removeEventListener('resize', findAndHighlight)\r\n    }\r\n  }, [currentStepIndex, currentStep, isOpen, pathname, router, isMobile])\r\n\r\n  const handleNext = () => {\r\n    if (currentStepIndex < activeSteps.length - 1) {\r\n      setCurrentStepIndex(prev => prev + 1)\r\n    } else {\r\n      handleFinish()\r\n    }\r\n  }\r\n\r\n  const handleBack = () => {\r\n    if (currentStepIndex > 0) {\r\n      setCurrentStepIndex(prev => prev - 1)\r\n    }\r\n  }\r\n\r\n  const handleFinish = async () => {\r\n    // 1. Optimistic Close: Remove UI immediately so mobile users don't feel stuck\r\n    setIsOpen(false)\r\n    setRect(null)\r\n\r\n    // 2. Persist in background\r\n    try {\r\n        await supabase.rpc('complete_onboarding_tour') \r\n        router.refresh()\r\n    } catch (err) {\r\n        console.error(\"Failed to save tour completion\", err)\r\n    }\r\n  }\r\n\r\n  if (!isOpen || !currentStep) return null\r\n\r\n  // --- Helper for popover styles ---\r\n  const getPopoverStyle = () => {\r\n    // MOBILE OVERRIDE: Force Center\r\n    if (isMobile) {\r\n        return {\r\n            top: '50%',\r\n            left: '50%',\r\n            transform: 'translate(-50%, -50%)',\r\n            position: 'fixed',\r\n            width: '90vw',\r\n            maxWidth: '320px',\r\n            zIndex: 10002\r\n        } as React.CSSProperties\r\n    }\r\n\r\n    // DESKTOP LOGIC\r\n    if (!rect) return { top: '50%', left: '50%', transform: 'translate(-50%, -50%)' }\r\n    \r\n    const gap = 15\r\n    const width = 320\r\n    \r\n    switch (currentStep.placement) {\r\n      case 'right': return { top: rect.top, left: rect.right + gap, width }\r\n      case 'left': return { top: rect.top, left: rect.left - width - gap, width }\r\n      case 'top': return { top: rect.top - gap - 200, left: rect.left, width } \r\n      case 'bottom': default: return { top: rect.bottom + gap, left: rect.left, width }\r\n    }\r\n  }\r\n\r\n  const style = getPopoverStyle()\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[9999] pointer-events-none\">\r\n      \r\n      {/* Backdrop */}\r\n      <div \r\n        className=\"absolute transition-all duration-500 ease-in-out rounded-md pointer-events-auto bg-transparent\"\r\n        style={{\r\n          top: rect ? rect.top - 5 : '50%',\r\n          left: rect ? rect.left - 5 : '50%',\r\n          width: rect ? rect.width + 10 : 0,\r\n          height: rect ? rect.height + 10 : 0,\r\n          boxShadow: '0 0 0 9999px rgba(0, 0, 0, 0.7)', \r\n        }}\r\n      />\r\n\r\n      {/* Popover Card */}\r\n      <div \r\n        className=\"absolute pointer-events-auto transition-all duration-500 ease-out flex flex-col bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden\"\r\n        style={style}\r\n      >\r\n        <div className=\"bg-indigo-600 px-4 py-3 flex justify-between items-center\">\r\n          <span className=\"text-xs font-bold text-indigo-100 uppercase tracking-wider\">\r\n            Step {currentStepIndex + 1} of {activeSteps.length}\r\n          </span>\r\n          <button onClick={handleFinish} className=\"text-indigo-200 hover:text-white text-xs font-semibold\">\r\n            Skip\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-5\">\r\n          <h3 className=\"text-lg font-bold text-gray-900 dark:text-white mb-2\">\r\n            {currentStep.title}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-600 dark:text-gray-300 leading-relaxed\">\r\n            {currentStep.content}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"bg-gray-50 dark:bg-gray-900/50 px-5 py-3 flex justify-between items-center\">\r\n          <button\r\n            onClick={handleBack}\r\n            disabled={currentStepIndex === 0}\r\n            className=\"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 disabled:opacity-30\"\r\n          >\r\n            Back\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleNext}\r\n            className=\"bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium px-4 py-2 rounded-lg shadow-sm transition-colors\"\r\n          >\r\n            {currentStepIndex === activeSteps.length - 1 ? 'Finish' : 'Next'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}