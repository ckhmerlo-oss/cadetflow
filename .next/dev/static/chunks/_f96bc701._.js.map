{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\n// --- HELPER ---\r\nasync function getActorWithPermissions(supabase: any) {\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select(`\r\n      id, \r\n      company_id, \r\n      role:role_id (\r\n        role_name, \r\n        default_role_level, \r\n        can_manage_all_rosters, \r\n        can_manage_own_company_roster\r\n      )\r\n    `)\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (!profile || !profile.role) return null\r\n\r\n  const role = profile.role as any\r\n  return {\r\n    userId: profile.id,\r\n    companyId: profile.company_id,\r\n    roleLevel: role.default_role_level || 0,\r\n    canManageAll: role.can_manage_all_rosters || false,\r\n    canManageOwn: role.can_manage_own_company_roster || false,\r\n    roleName: role.role_name\r\n  }\r\n}\r\n\r\n// --- ACTIONS ---\r\n\r\nexport async function updateUserRole(userId: string, roleId: string | null) {\r\n  // If clearing a role (null), we treat it as assigning roleId \"\" or similar\r\n  // But bulkAssignRole expects a string.\r\n  // If roleId is null, we are essentially unassigning.\r\n  // Let's handle null separately or ensure bulkAssignRole handles it.\r\n  if (!roleId) {\r\n      // Unassign logic could be separate, or we pass a special flag?\r\n      // For now, let's assume roleId is required for assignment.\r\n      // To unassign, we might need a separate action or allow null.\r\n      // Let's keep it simple: This action is for ASSIGNING.\r\n      return { error: \"Role ID is required.\" }\r\n  }\r\n  return bulkAssignRole([userId], roleId)\r\n}\r\n\r\nexport async function bulkAssignRole(userIds: string[], roleId: string) {\r\n  const supabase = createClient()\r\n  const actor = await getActorWithPermissions(supabase)\r\n  \r\n  if (!actor) return { error: \"Unauthorized\" }\r\n\r\n  // 1. FETCH TARGET ROLE DETAILS\r\n  const { data: targetRole } = await supabase\r\n    .from('roles')\r\n    .select('default_role_level, company_id')\r\n    .eq('id', roleId)\r\n    .single()\r\n    \r\n  if (!targetRole) return { error: \"Role not found.\" }\r\n\r\n  const targetRoleLevel = targetRole.default_role_level || 0\r\n  \r\n  // 2. HIERARCHY CHECK\r\n  // You cannot assign a role that is equal to or higher than your own.\r\n  if (targetRoleLevel >= actor.roleLevel) {\r\n    return { error: `Permission Denied: You cannot assign a role of level ${targetRoleLevel} (your level is ${actor.roleLevel}).` }\r\n  }\r\n\r\n  // 3. SCOPE CHECK\r\n  if (actor.canManageAll) {\r\n    // Allowed globally\r\n  } else if (actor.canManageOwn) {\r\n    // a) Role must belong to the actor's company (or be generic/global if that's allowed, but usually specific)\r\n    // Strict mode: Role must be in actor's company\r\n    if (targetRole.company_id && targetRole.company_id !== actor.companyId) {\r\n        return { error: \"Permission Denied: You cannot assign roles from another company.\" }\r\n    }\r\n\r\n    // b) Target Users must be in actor's company OR unassigned\r\n    const { data: targets } = await supabase\r\n      .from('profiles')\r\n      .select('id, company_id')\r\n      .in('id', userIds)\r\n\r\n    if (!targets) return { error: \"Could not verify targets.\" }\r\n\r\n    const allValid = targets.every(t => t.company_id === actor.companyId || t.company_id === null)\r\n    \r\n    if (!allValid) {\r\n      return { error: \"Permission Denied: You can only manage cadets within your own company or claim unassigned cadets.\" }\r\n    }\r\n  } else {\r\n    return { error: \"Unauthorized: You do not have roster management permissions.\" }\r\n  }\r\n\r\n  // 4. EXECUTE\r\n  // We use the standard client because we assume the RLS policy (from 5_roster_permissions_and_rls.sql) \r\n  // correctly allows updates if (can_manage_own AND (target.company = my_company OR target.company IS NULL))\r\n  \r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: `Database Error: ${error.message}` }\r\n\r\n  revalidatePath('/manage')\r\n  revalidatePath('/roster')\r\n  return { success: true }\r\n}\r\n\r\nexport async function bulkAssignCompany(userIds: string[], companyId: string) {\r\n  const supabase = createClient()\r\n  const actor = await getActorWithPermissions(supabase)\r\n  \r\n  if (!actor) return { error: \"Unauthorized\" }\r\n\r\n  // 1. SCOPE CHECK\r\n  if (actor.canManageAll) {\r\n     // Global allowed\r\n  } else if (actor.canManageOwn) {\r\n     // Can only move TO own company\r\n     if (companyId !== actor.companyId) {\r\n        return { error: \"Permission Denied: You can only assign cadets to your own company.\" }\r\n     }\r\n\r\n     // Verify targets are Unassigned or in Own Company\r\n     const { data: targets } = await supabase\r\n       .from('profiles')\r\n       .select('company_id')\r\n       .in('id', userIds)\r\n\r\n     if (!targets) return { error: \"Could not verify targets.\" }\r\n\r\n     const allValid = targets.every(t => t.company_id === actor.companyId || t.company_id === null)\r\n     if (!allValid) {\r\n         return { error: \"Permission Denied: You can only claim unassigned cadets or move cadets already in your company.\" }\r\n     }\r\n  } else {\r\n     return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  // 2. EXECUTE\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ company_id: companyId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  revalidatePath('/roster')\r\n  return { success: true }\r\n}"],"names":[],"mappings":";;;;;;;IAuDsB,iBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/manage/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/utils/supabase/server'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\n// --- HELPER ---\r\nasync function getActorWithPermissions(supabase: any) {\r\n  const { data: { user } } = await supabase.auth.getUser()\r\n  if (!user) return null\r\n\r\n  const { data: profile } = await supabase\r\n    .from('profiles')\r\n    .select(`\r\n      id, \r\n      company_id, \r\n      role:role_id (\r\n        role_name, \r\n        default_role_level, \r\n        can_manage_all_rosters, \r\n        can_manage_own_company_roster\r\n      )\r\n    `)\r\n    .eq('id', user.id)\r\n    .single()\r\n\r\n  if (!profile || !profile.role) return null\r\n\r\n  const role = profile.role as any\r\n  return {\r\n    userId: profile.id,\r\n    companyId: profile.company_id,\r\n    roleLevel: role.default_role_level || 0,\r\n    canManageAll: role.can_manage_all_rosters || false,\r\n    canManageOwn: role.can_manage_own_company_roster || false,\r\n    roleName: role.role_name\r\n  }\r\n}\r\n\r\n// --- ACTIONS ---\r\n\r\nexport async function updateUserRole(userId: string, roleId: string | null) {\r\n  // If clearing a role (null), we treat it as assigning roleId \"\" or similar\r\n  // But bulkAssignRole expects a string.\r\n  // If roleId is null, we are essentially unassigning.\r\n  // Let's handle null separately or ensure bulkAssignRole handles it.\r\n  if (!roleId) {\r\n      // Unassign logic could be separate, or we pass a special flag?\r\n      // For now, let's assume roleId is required for assignment.\r\n      // To unassign, we might need a separate action or allow null.\r\n      // Let's keep it simple: This action is for ASSIGNING.\r\n      return { error: \"Role ID is required.\" }\r\n  }\r\n  return bulkAssignRole([userId], roleId)\r\n}\r\n\r\nexport async function bulkAssignRole(userIds: string[], roleId: string) {\r\n  const supabase = createClient()\r\n  const actor = await getActorWithPermissions(supabase)\r\n  \r\n  if (!actor) return { error: \"Unauthorized\" }\r\n\r\n  // 1. FETCH TARGET ROLE DETAILS\r\n  const { data: targetRole } = await supabase\r\n    .from('roles')\r\n    .select('default_role_level, company_id')\r\n    .eq('id', roleId)\r\n    .single()\r\n    \r\n  if (!targetRole) return { error: \"Role not found.\" }\r\n\r\n  const targetRoleLevel = targetRole.default_role_level || 0\r\n  \r\n  // 2. HIERARCHY CHECK\r\n  // You cannot assign a role that is equal to or higher than your own.\r\n  if (targetRoleLevel >= actor.roleLevel) {\r\n    return { error: `Permission Denied: You cannot assign a role of level ${targetRoleLevel} (your level is ${actor.roleLevel}).` }\r\n  }\r\n\r\n  // 3. SCOPE CHECK\r\n  if (actor.canManageAll) {\r\n    // Allowed globally\r\n  } else if (actor.canManageOwn) {\r\n    // a) Role must belong to the actor's company (or be generic/global if that's allowed, but usually specific)\r\n    // Strict mode: Role must be in actor's company\r\n    if (targetRole.company_id && targetRole.company_id !== actor.companyId) {\r\n        return { error: \"Permission Denied: You cannot assign roles from another company.\" }\r\n    }\r\n\r\n    // b) Target Users must be in actor's company OR unassigned\r\n    const { data: targets } = await supabase\r\n      .from('profiles')\r\n      .select('id, company_id')\r\n      .in('id', userIds)\r\n\r\n    if (!targets) return { error: \"Could not verify targets.\" }\r\n\r\n    const allValid = targets.every(t => t.company_id === actor.companyId || t.company_id === null)\r\n    \r\n    if (!allValid) {\r\n      return { error: \"Permission Denied: You can only manage cadets within your own company or claim unassigned cadets.\" }\r\n    }\r\n  } else {\r\n    return { error: \"Unauthorized: You do not have roster management permissions.\" }\r\n  }\r\n\r\n  // 4. EXECUTE\r\n  // We use the standard client because we assume the RLS policy (from 5_roster_permissions_and_rls.sql) \r\n  // correctly allows updates if (can_manage_own AND (target.company = my_company OR target.company IS NULL))\r\n  \r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ role_id: roleId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: `Database Error: ${error.message}` }\r\n\r\n  revalidatePath('/manage')\r\n  revalidatePath('/roster')\r\n  return { success: true }\r\n}\r\n\r\nexport async function bulkAssignCompany(userIds: string[], companyId: string) {\r\n  const supabase = createClient()\r\n  const actor = await getActorWithPermissions(supabase)\r\n  \r\n  if (!actor) return { error: \"Unauthorized\" }\r\n\r\n  // 1. SCOPE CHECK\r\n  if (actor.canManageAll) {\r\n     // Global allowed\r\n  } else if (actor.canManageOwn) {\r\n     // Can only move TO own company\r\n     if (companyId !== actor.companyId) {\r\n        return { error: \"Permission Denied: You can only assign cadets to your own company.\" }\r\n     }\r\n\r\n     // Verify targets are Unassigned or in Own Company\r\n     const { data: targets } = await supabase\r\n       .from('profiles')\r\n       .select('company_id')\r\n       .in('id', userIds)\r\n\r\n     if (!targets) return { error: \"Could not verify targets.\" }\r\n\r\n     const allValid = targets.every(t => t.company_id === actor.companyId || t.company_id === null)\r\n     if (!allValid) {\r\n         return { error: \"Permission Denied: You can only claim unassigned cadets or move cadets already in your company.\" }\r\n     }\r\n  } else {\r\n     return { error: \"Unauthorized.\" }\r\n  }\r\n\r\n  // 2. EXECUTE\r\n  const { error } = await supabase\r\n    .from('profiles')\r\n    .update({ company_id: companyId })\r\n    .in('id', userIds)\r\n\r\n  if (error) return { error: error.message }\r\n\r\n  revalidatePath('/manage')\r\n  revalidatePath('/roster')\r\n  return { success: true }\r\n}"],"names":[],"mappings":";;;;;;;IAyHsB,oBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA","debugId":null}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/app/roster/RosterClient.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { bulkAssignRole, bulkAssignCompany } from '@/app/manage/actions' // Reuse actions\r\nimport { useRouter } from 'next/navigation'\r\n\r\n// Re-defining types for this component context\r\ntype RosterCadet = {\r\n  id: string;\r\n  first_name: string;\r\n  last_name: string;\r\n  cadet_rank: string | null;\r\n  company_name: string | null;\r\n  grade_level: string | null;\r\n  term_demerits: number;\r\n  year_demerits: number;\r\n  current_tour_balance: number;\r\n  has_star_tours: boolean;\r\n  conduct_status: string;\r\n  recent_reports: {\r\n    id: string;\r\n    offense_name: string;\r\n    status: string;\r\n    created_at: string;\r\n  }[] | null;\r\n}\r\n\r\ntype Company = { id: string; company_name: string }\r\ntype Role = { id: string; role_name: string; default_role_level: number; company_id: string | null }\r\n\r\ntype RosterClientProps = {\r\n  initialData: RosterCadet[]\r\n  canEditProfiles: boolean\r\n  // NEW PROPS for Assignment Modal\r\n  canManage: boolean\r\n  companies: Company[]\r\n  roles: Role[]\r\n}\r\n\r\nexport default function RosterClient({ initialData, canEditProfiles, canManage, companies, roles }: RosterClientProps) {\r\n  const [openCadetId, setOpenCadetId] = useState<string | null>(null)\r\n  const router = useRouter()\r\n\r\n  // --- MODAL STATE ---\r\n  const [modalOpen, setModalOpen] = useState(false)\r\n  const [targetCadet, setTargetCadet] = useState<RosterCadet | null>(null)\r\n  const [targetCompanyId, setTargetCompanyId] = useState('')\r\n  const [targetRoleId, setTargetRoleId] = useState('')\r\n  const [isSubmitting, setIsSubmitting] = useState(false)\r\n  \r\n  const handleRowClick = (cadetId: string) => {\r\n    setOpenCadetId(prevId => (prevId === cadetId ? null : cadetId))\r\n  }\r\n\r\n  const handleReassignClick = (cadet: RosterCadet) => {\r\n      setTargetCadet(cadet)\r\n      // Reset form\r\n      setTargetCompanyId('')\r\n      setTargetRoleId('')\r\n      setModalOpen(true)\r\n  }\r\n\r\n  const handleSubmitAssignment = async () => {\r\n    if (!targetCadet) return;\r\n    if (!targetCompanyId && !targetRoleId) {\r\n      alert(\"Please select a Company or Role to update.\")\r\n      return\r\n    }\r\n\r\n    setIsSubmitting(true)\r\n    const ids = [targetCadet.id]\r\n    const promises = []\r\n    if (targetCompanyId) promises.push(bulkAssignCompany(ids, targetCompanyId))\r\n    if (targetRoleId) promises.push(bulkAssignRole(ids, targetRoleId))\r\n\r\n    const results = await Promise.all(promises)\r\n    const errors = results.filter(r => r.error).map(r => r.error)\r\n\r\n    setIsSubmitting(false)\r\n\r\n    if (errors.length > 0) {\r\n      alert(`Error: ${errors.join('\\n')}`)\r\n    } else {\r\n      alert(\"Update successful.\")\r\n      setModalOpen(false)\r\n      router.refresh()\r\n    }\r\n  }\r\n\r\n  // Filter roles for the selected company in the modal\r\n  const availableRoles = roles.filter(r => r.company_id === targetCompanyId || r.company_id === null)\r\n\r\n  const handleRoleChange = (newRoleId: string) => {\r\n    setTargetRoleId(newRoleId);\r\n    if (!newRoleId) return;\r\n    const selectedRole = roles.find(r => r.id === newRoleId);\r\n    if (selectedRole && selectedRole.company_id) {\r\n      setTargetCompanyId(selectedRole.company_id);\r\n    }\r\n  }\r\n\r\n  // --- HELPERS ---\r\n  const getConductColor = (status: string) => {\r\n      if (status === 'Exemplary') return 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200';\r\n      if (status === 'Commendable') return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\r\n      if (status === 'Satisfactory') return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\r\n      if (status === 'Deficient') return 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200';\r\n      return 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'; \r\n  }\r\n\r\n  const formatTimeAgo = (dateStr: string) => {\r\n    const date = new Date(dateStr)\r\n    const now = new Date()\r\n    const diff = Math.floor((now.getTime() - date.getTime()) / 1000)\r\n    if (diff < 60) return 'Just now';\r\n    if (diff < 3600) return `${Math.floor(diff/60)}m ago`;\r\n    if (diff < 86400) return `${Math.floor(diff/3600)}h ago`;\r\n    return `${Math.floor(diff/86400)}d ago`;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden\">\r\n      <table className=\"min-w-full divide-y divide-gray-200 dark:divide-gray-700\">\r\n        <thead className=\"bg-gray-50 dark:bg-gray-700/50\">\r\n          <tr>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Rank</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Name</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Company</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Grade</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Conduct</th>\r\n            <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-bold text-gray-600 dark:text-gray-300 uppercase tracking-wider\">Tour Balance</th>\r\n            <th scope=\"col\" className=\"relative px-6 py-3\"><span className=\"sr-only\">Expand</span></th>\r\n          </tr>\r\n        </thead>\r\n        <tbody className=\"divide-y divide-gray-200 dark:divide-gray-700\">\r\n          {initialData.map((cadet) => (\r\n            <React.Fragment key={cadet.id}>\r\n              <tr \r\n                onClick={() => handleRowClick(cadet.id)}\r\n                className={`hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors ${openCadetId === cadet.id ? 'bg-gray-50 dark:bg-gray-700/50' : ''}`}\r\n              >\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-gray-200\">{cadet.cadet_rank || '-'}</td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">{cadet.last_name}, {cadet.first_name}</td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{cadet.company_name || '-'}</td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400\">{cadet.grade_level || '-'}</td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${getConductColor(cadet.conduct_status)}`}>\r\n                    {cadet.conduct_status}\r\n                  </span>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-bold\">\r\n                  <span className={cadet.has_star_tours || cadet.current_tour_balance > 0 ? 'text-red-600 dark:text-red-400' : 'text-gray-900 dark:text-white'}>\r\n                    {cadet.has_star_tours ? '*' : cadet.current_tour_balance}\r\n                  </span>\r\n                </td>\r\n                <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                  <span className=\"text-indigo-600 dark:text-indigo-400\">\r\n                    {openCadetId === cadet.id ? 'Hide' : 'Details'}\r\n                  </span>\r\n                </td>\r\n              </tr>\r\n              \r\n              {openCadetId === cadet.id && (\r\n                <tr className=\"bg-gray-50 dark:bg-gray-700/30\">\r\n                  <td colSpan={7} className=\"px-6 py-6\">\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                      \r\n                      {/* Key Metrics */}\r\n                      <div className=\"space-y-3\">\r\n                        <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider\">Key Metrics</h4>\r\n                        <div className=\"flex justify-between p-3 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600\">\r\n                          <span className=\"text-sm text-gray-600 dark:text-gray-400\">Term Demerits</span>\r\n                          <span className=\"text-sm font-bold text-gray-900 dark:text-white\">{cadet.term_demerits}</span>\r\n                        </div>\r\n                        <div className=\"flex justify-between p-3 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600\">\r\n                          <span className=\"text-sm text-gray-600 dark:text-gray-400\">Year Demerits</span>\r\n                          <span className=\"text-sm font-bold text-gray-900 dark:text-white\">{cadet.year_demerits}</span>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Recent Reports - NOW RESTORED */}\r\n                      <div className=\"space-y-3\">\r\n                        <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider\">Recent Activity</h4>\r\n                        {cadet.recent_reports && cadet.recent_reports.length > 0 ? (\r\n                          <div className=\"bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600 divide-y divide-gray-100 dark:divide-gray-700\">\r\n                            {cadet.recent_reports.map(report => (\r\n                              <div key={report.id} className=\"p-2.5 flex justify-between items-center text-sm\">\r\n                                <div>\r\n                                  <p className=\"font-medium text-gray-800 dark:text-gray-200 truncate w-32\">{report.offense_name}</p>\r\n                                  <p className=\"text-[10px] text-gray-400 uppercase\">{report.status.replace('_', ' ')}</p>\r\n                                </div>\r\n                                <span className=\"text-xs text-gray-500\">{formatTimeAgo(report.created_at)}</span>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        ) : (\r\n                          <div className=\"p-4 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-600 text-center text-sm text-gray-400 italic\">\r\n                            No recent reports.\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      {/* Actions */}\r\n                      <div className=\"space-y-3\">\r\n                        <h4 className=\"text-xs font-bold text-gray-500 uppercase tracking-wider\">Actions</h4>\r\n                        <div className=\"flex flex-col gap-2\">\r\n                          <Link href={`/profile/${cadet.id}`} className=\"block w-full text-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 text-sm font-medium rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n                            View Profile\r\n                          </Link>\r\n                          <Link href={`/ledger/${cadet.id}`} className=\"block w-full text-center px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 text-sm font-medium rounded hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors\">\r\n                            View Ledger\r\n                          </Link>\r\n                          \r\n                          {/* NEW: Re-Assign Button (if Manager) */}\r\n                          {canManage && (\r\n                            <button \r\n                                onClick={() => handleReassignClick(cadet)}\r\n                                className=\"block w-full text-center px-4 py-2 bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-700 text-indigo-700 dark:text-indigo-300 text-sm font-medium rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-colors\"\r\n                            >\r\n                                Re-Assign\r\n                            </button>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              )}\r\n            </React.Fragment>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    {/* --- ASSIGNMENT MODAL --- */}\r\n    {modalOpen && targetCadet && (\r\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\" aria-labelledby=\"modal-title\" role=\"dialog\" aria-modal=\"true\">\r\n          <div className=\"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0\">\r\n            <div className=\"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity\" onClick={() => setModalOpen(false)}></div>\r\n            <span className=\"hidden sm:inline-block sm:align-middle sm:h-screen\" aria-hidden=\"true\">&#8203;</span>\r\n            <div className=\"relative inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg w-full\">\r\n              <div className=\"bg-white dark:bg-gray-800 px-4 pt-5 pb-4 sm:p-6 sm:pb-4\">\r\n                <h3 className=\"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-2\">\r\n                    Re-Assign {targetCadet.last_name}\r\n                </h3>\r\n                <div className=\"space-y-4 mt-4\">\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Company</label>\r\n                    <select value={targetCompanyId} onChange={(e) => setTargetCompanyId(e.target.value)} className=\"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white p-2\">\r\n                      <option value=\"\">-- No Change --</option>\r\n                      {companies.map(c => <option key={c.id} value={c.id}>{c.company_name}</option>)}\r\n                    </select>\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\">Role</label>\r\n                    <select value={targetRoleId} onChange={(e) => handleRoleChange(e.target.value)} className=\"block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white p-2\">\r\n                      <option value=\"\">-- No Change --</option>\r\n                      {availableRoles.map(r => <option key={r.id} value={r.id}>{r.role_name} (Lvl {r.default_role_level})</option>)}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div className=\"bg-gray-50 dark:bg-gray-700/30 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse\">\r\n                <button type=\"button\" disabled={isSubmitting} onClick={handleSubmitAssignment} className=\"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50\">Save</button>\r\n                <button type=\"button\" onClick={() => setModalOpen(false)} className=\"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm\">Cancel</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  )\r\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 760, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ckhme/my-workflow-app/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0],"debugId":null}}]
}